## ソースコードルール

### 基本原則
- 必要以上に長ったらしい名前（関数、変数）は使わないこと
- なるべくならコードは短く書くこと
- わかりやすく簡潔に書くこと
- 必ず関数などにはドキュメントコメントを記述すること
- Rustの文化を尊重すること
- ソースはモダンな書き方をすること。なるべく新しい書き方で（その方が簡潔なコードになると思うから）

### テスト・品質
- ソースコードは必ずテストすること
- ビルド時に警告が出たら対応してほしい

### 設計・拡張性
- あとから拡張しやすくすること
- 共通化できるものは共通化すること
- プログラミング言語実装のセオリーはなるべく守り、実装の学習もしやすくすること

### 並行処理
- 並列、並行をネイティブを第一級としているため、スレッドセーフは常に意識すること

### 依存関係
- クレートはよほどのことがない限りPure Rustのものを使用すること(C/C++のライブラリやコンパイルが必要なものは使用しないこと)

### 言語仕様との整合性
- SPEC.mdにかかれている言語仕様を元に作成すること
- SPEC.mdにかかれている言語の文化は守ること
- SPEC.md はソースコードが変わった場合、更新が必要なら更新すること
- README.md はソースコードが変わった場合、更新が必要なら更新すること
- TUTORIAL.md はソースコードが変わった場合、更新が必要なら更新すること

## i18nルール（重要）

ユーザー向けのメッセージは必ずi18n化すること。以下のルールを厳守すること：

### 基本原則
- **すべてのエラーメッセージ・UIメッセージはi18n化する**
- プログラムが出力するものは多言語対応すること(今は英語と日本語のみでいい)
- ハードコードされた文字列でErrやformat!を書かない
- `Err("...")`や`format!("...")`の代わりに`fmt_msg(MsgKey::XxxError, &[...])`を使う
- `map_err(|e| format!("...", e))`も`map_err(|e| fmt_msg(MsgKey::XxxError, &[&e.to_string()]))`に変換する

### メッセージの分類
- **MsgKey**: エラーメッセージ用（fmt_msg関数で使用）
  - パーサーエラー、ランタイムエラー、I/Oエラー、HTTPエラーなど
  - 例: `MsgKey::FileNotFound`, `MsgKey::InvalidArgument`
- **UiMsg**: UIメッセージ用（ui_msg/fmt_ui_msg関数で使用）
  - ヘルプメッセージ、バージョン情報、プロンプトなど
  - 例: `UiMsg::Version`, `UiMsg::HelpUsage`

### i18n.rsへの追加手順
1. **MsgKey enumに新しいキーを追加**（コメントで英語の例を書く）
2. **英語メッセージを追加**（`Lang::En`セクション）
3. **日本語メッセージを追加**（`Lang::Ja`セクション）
4. **重複チェック**: 既存のキーで代用できないか確認する
5. **まとめられるか検討**: 似たようなメッセージは共通化できないか考える

### パラメータ埋め込み
- プレースホルダー（`{0}`, `{1}`, `{2}`など）の使用を推奨
- 例: `fmt_msg(MsgKey::FileNotFound, &["/path/to/file"])`
- ただし、パラメータの使用は必須ではない（固定メッセージもOK）

### 例外
- **HTTPサーバーのレスポンスメッセージ**: 英語のままでOK
  - クライアントに返すエラーレスポンスなど
  - 例: `"Not Found"`, `"Internal Server Error"`などはハードコード可
- **テストコードのpanic!やassert!**: i18n化不要

### 実装例
```rust
// ❌ 悪い例
Err("File not found".to_string())
.map_err(|e| format!("Failed to read: {}", e))

// ✅ 良い例
Err(fmt_msg(MsgKey::FileNotFound, &[path]))
.map_err(|e| fmt_msg(MsgKey::FailedToRead, &[&e.to_string()]))
```

## ドキュメント

- TUTORIAL.md は Rust、プログラミング言語実装、Lisp系初心者向けに書くこと。これらの学習ドキュメントでもある。qi-langを通じてこれらも学習する
- TUTORIAL.md は qiの実装されている内容を理解できるようにする。またqi言語に対しても覚えられるようにする

## チャット

- 出力は日本語で行うこと
