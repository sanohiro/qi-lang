;; 正規表現Phase 1機能のテスト

(println "=== 正規表現Phase 1機能のテスト ===")

;; ========================================
;; str/re-match-groups - グループキャプチャ
;; ========================================
(println "\n1. str/re-match-groups - 基本的なグループキャプチャ")
(def date-result (str/re-match-groups "(\\d{4})-(\\d{2})-(\\d{2})" "2025-01-13"))
(println "日付のマッチ:" date-result)
(println "  - 全体マッチ:" (get date-result "match"))
(println "  - グループ:" (get date-result "groups"))

(println "\n2. str/re-match-groups - メールアドレスのキャプチャ")
(def email-result (str/re-match-groups "(\\w+)@(\\w+\\.\\w+)" "alice@example.com"))
(println "メールアドレスのマッチ:" email-result)
(println "  - 全体マッチ:" (get email-result "match"))
(def groups (get email-result "groups"))
(println "  - ユーザー名:" (nth groups 0))
(println "  - ドメイン:" (nth groups 1))

(println "\n3. str/re-match-groups - マッチしない場合")
(def no-match (str/re-match-groups "\\d+" "hello"))
(println "マッチなし:" no-match)

(println "\n4. str/re-match-groups - URLのパース")
(def url-result (str/re-match-groups "(https?)://([^/]+)(/.*)?" "https://example.com/path/to/page"))
(println "URLのマッチ:" url-result)
(def url-groups (get url-result "groups"))
(println "  - プロトコル:" (nth url-groups 0))
(println "  - ホスト:" (nth url-groups 1))
(println "  - パス:" (nth url-groups 2))

;; ========================================
;; str/re-split - 正規表現分割
;; ========================================
(println "\n5. str/re-split - 空白文字で分割")
(def words (str/re-split "\\s+" "hello  world\t\ntest"))
(println "空白分割:" words)

(println "\n6. str/re-split - カンマとオプショナルな空白で分割")
(def items (str/re-split ",\\s*" "apple, orange,banana, grape"))
(println "CSV分割:" items)

(println "\n7. str/re-split - 分割数を制限")
(def limited (str/re-split "\\s+" "a b c d e" 3))
(println "3分割まで:" limited)

(println "\n8. str/re-split - 複数の区切り文字")
(def multi-sep (str/re-split "[,;:]" "a,b;c:d"))
(println "複数区切り:" multi-sep)

(println "\n9. str/re-split - 数字で分割")
(def by-digits (str/re-split "\\d+" "abc123def456ghi"))
(println "数字で分割:" by-digits)

;; ========================================
;; 実用例
;; ========================================
(println "\n10. 実用例: ログ行のパース")
(def log-line "2025-01-13 14:30:45 [ERROR] Database connection failed")
(def log-result (str/re-match-groups "(\\d{4}-\\d{2}-\\d{2}) (\\d{2}:\\d{2}:\\d{2}) \\[(\\w+)\\] (.*)" log-line))
(println "ログ行のマッチ:" log-result)
(def log-groups (get log-result "groups"))
(println "  - 日付:" (nth log-groups 0))
(println "  - 時刻:" (nth log-groups 1))
(println "  - レベル:" (nth log-groups 2))
(println "  - メッセージ:" (nth log-groups 3))

(println "\n11. 実用例: パス文字列の分割")
(def path-parts (str/re-split "/" "/usr/local/bin"))
(println "パス分割:" path-parts)

(println "\n12. 実用例: バージョン番号の解析")
(def version "v1.2.3-beta")
(def ver-result (str/re-match-groups "v(\\d+)\\.(\\d+)\\.(\\d+)(-\\w+)?" version))
(println "バージョン解析:" ver-result)
(def ver-groups (get ver-result "groups"))
(println "  - メジャー:" (nth ver-groups 0))
(println "  - マイナー:" (nth ver-groups 1))
(println "  - パッチ:" (nth ver-groups 2))
(println "  - サフィックス:" (nth ver-groups 3))

(println "\n=== テスト完了 ===")
