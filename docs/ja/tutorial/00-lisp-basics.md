# Lisp系言語の基礎

Qiは**Lisp系言語**です。このチュートリアルでは、Lisp系言語に初めて触れる方向けに、括弧の読み方や基本的な考え方を説明します。

## 目次

- [Lisp系言語とは](#lisp系言語とは)
- [括弧の読み方](#括弧の読み方)
- [関数呼び出し](#関数呼び出し)
- [他の言語との比較](#他の言語との比較)
- [ネストした式](#ネストした式)
- [なぜこの書き方なのか](#なぜこの書き方なのか)
- [次のステップ](#次のステップ)

---

## Lisp系言語とは

Lisp（List Processing）は、1958年に生まれた歴史あるプログラミング言語ファミリーです。

**特徴:**
- **括弧で式を囲む**: すべてがリスト（括弧で囲まれた式）
- **前置記法**: 演算子が先頭に来る
- **シンプルな文法**: 覚えることが少ない
- **コードとデータが同じ**: プログラム自体がデータ構造

**代表的なLisp系言語:**
- Common Lisp
- Scheme
- Clojure（JVM上のLisp）
- Racket
- そして、**Qi**！

---

## 括弧の読み方

### 基本ルール

```qi
(関数名 引数1 引数2 引数3)
```

括弧の中の**最初の要素が関数名**、残りが**引数**です。

### 例: 足し算

```qi
(+ 1 2 3)
;; => 6
```

これは「1と2と3を足す」という意味です。

**他の言語との比較:**

| 言語 | 書き方 |
|------|--------|
| JavaScript | `1 + 2 + 3` |
| Python | `1 + 2 + 3` |
| **Qi (Lisp)** | `(+ 1 2 3)` |

---

## 関数呼び出し

### 単純な例

```qi
;; 掛け算
(* 2 3)
;; => 6

;; 割り算
(/ 10 2)
;; => 5

;; 文字列を出力
(println "Hello, World!")
;; => Hello, World!
```

### 複数の引数

Lispでは、多くの関数が**複数の引数**を取れます。

```qi
;; 複数の数を足す
(+ 1 2 3 4 5)
;; => 15

;; 複数の数を掛ける
(* 2 3 4)
;; => 24

;; 最大値を求める
(max 10 5 8 20 3)
;; => 20
```

---

## 他の言語との比較

### 例1: 足し算

**JavaScript:**
```javascript
1 + 2 + 3
```

**Python:**
```python
1 + 2 + 3
```

**Qi:**
```qi
(+ 1 2 3)
```

### 例2: 関数呼び出し

**JavaScript:**
```javascript
Math.max(10, 5, 8)
```

**Python:**
```python
max(10, 5, 8)
```

**Qi:**
```qi
(max 10 5 8)
```

Qiでは**カンマが不要**です！

---

## ネストした式

括弧の中に括弧を入れることができます（ネスト）。

### 例: 計算のネスト

```qi
(+ 1 (* 2 3))
;; => 7
```

**読み方:**
1. 内側から読む: `(* 2 3)` → `6`
2. 外側を計算: `(+ 1 6)` → `7`

**他の言語との比較:**

| 言語 | 書き方 |
|------|--------|
| JavaScript/Python | `1 + (2 * 3)` |
| **Qi (Lisp)** | `(+ 1 (* 2 3))` |

### もう少し複雑な例

```qi
(* (+ 1 2) (+ 3 4))
;; => 21
```

**読み方:**
1. `(+ 1 2)` → `3`
2. `(+ 3 4)` → `7`
3. `(* 3 7)` → `21`

**他の言語との比較:**

| 言語 | 書き方 |
|------|--------|
| JavaScript/Python | `(1 + 2) * (3 + 4)` |
| **Qi (Lisp)** | `(* (+ 1 2) (+ 3 4))` |

---

## なぜこの書き方なのか

### メリット

#### 1. **一貫性**
すべてが同じパターン: `(関数 引数...)`

```qi
(+ 1 2)           ;; 演算子
(println "Hi")    ;; 関数
(if true 1 2)     ;; 条件分岐
(def x 10)        ;; 変数定義
```

すべて同じ書き方です！

#### 2. **拡張しやすい**
新しい演算子を追加しても、文法は変わりません。

```qi
;; 既存の演算子
(+ 1 2 3)

;; カスタム演算子（仮）
(my-operator 1 2 3)
```

#### 3. **括弧があいまいさを消す**
演算子の優先順位を覚える必要がありません。

**他の言語（曖昧）:**
```
1 + 2 * 3  ;; 7? 9? どっち？
```

**Qi（明確）:**
```qi
(+ 1 (* 2 3))  ;; 7
(* (+ 1 2) 3)  ;; 9
```

#### 4. **強力なマクロ**
コードがデータなので、コードを生成するコードが書きやすい（上級者向け）。

---

## 実践: REPLで試してみよう

REPLを起動して、実際に試してみましょう：

```bash
qi
```

### 基本的な計算

```qi
qi:1> (+ 1 2)
3

qi:2> (* 5 6)
30

qi:3> (+ 1 (* 2 3))
7
```

### 変数を定義

```qi
qi:4> (def x 10)
10

qi:5> (def y 5)
5

qi:6> (+ x y)
15

qi:7> (* x y)
50
```

### 関数を定義

```qi
qi:8> (defn square [n] (* n n))
Function(square)

qi:9> (square 5)
25

qi:10> (square 10)
100
```

### ネストした計算

```qi
qi:11> (square (+ 2 3))
25

qi:12> (+ (square 3) (square 4))
25
```

---

## よくある質問

### Q: 括弧が多すぎませんか？

**A:** 最初は多く感じるかもしれませんが、すぐに慣れます！エディタの括弧対応機能を使えば問題ありません。

また、Qiには**パイプライン演算子**があるので、括弧を減らせます：

```qi
;; 括弧が多い
(reduce + 0 (filter (fn [x] (> x 5)) (map (fn [x] (* x 2)) [1 2 3 4 5 6 7 8 9 10])))

;; パイプラインでスッキリ
([1 2 3 4 5 6 7 8 9 10]
 |> (map (fn [x] (* x 2)))
 |> (filter (fn [x] (> x 5)))
 |> (reduce + 0))
```

### Q: なぜ `+` が前にあるのですか？

**A:** これを**前置記法（prefix notation）**と言います。メリットは：

1. **複数の引数を自然に書ける**: `(+ 1 2 3 4 5)`
2. **優先順位が明確**: 括弧で囲まれているので
3. **一貫性**: 関数も演算子も同じルール

### Q: カンマはどこですか？

**A:** Lispでは**カンマが不要**です。スペースで十分です。

```qi
;; ✓ OK
(max 10 5 8)

;; ✗ カンマは書かない
(max 10, 5, 8)  ;; エラーではないが、カンマが変数名として解釈される
```

---

## まとめ

Lisp系言語の基本を理解しました：

- ✅ 括弧で式を囲む: `(関数 引数...)`
- ✅ 前置記法: 演算子が先頭
- ✅ ネスト: 括弧の中に括弧
- ✅ 一貫性: すべて同じパターン
- ✅ カンマ不要: スペースで区切る

慣れると、この一貫性が心地よくなります！

---

## 次のステップ

Lisp系言語の基本を理解したら、Qiを実際に使ってみましょう：

➡️ **[チュートリアル: Qiをはじめよう](01-getting-started.md)**

---

## 参考: 他のLisp系言語

興味があれば、他のLisp系言語も試してみてください：

- **Clojure** - JVM上で動くモダンなLisp、Web開発に人気
- **Racket** - 教育向けに設計されたLisp、優れたドキュメント
- **Common Lisp** - 古典的なLisp、強力だが学習曲線が急
- **Scheme** - シンプルで美しいLisp、学術的に人気

QiはこれらのLispから影響を受けつつ、**パイプライン**と**並行処理**に特化した独自の進化を遂げています。

---

Happy Lisping with Qi! 🚀
