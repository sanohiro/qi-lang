; args_torture_test.qi
; コマンドライン引数関数（4個）の torture test
;
; args/all, args/get, args/parse, args/count
;
; 注意: これらの関数は実行時の環境に依存するため、
;       基本的な動作確認のみを行います

(println "========================================")
(println "コマンドライン引数関数 Torture Test 開始")
(println "========================================")

; ========================================
; Section 1: args/count
; ========================================

(println "\n--- Section 1: args/count ---")

; 1.1 基本動作
(println "\n[1.1] count - 基本動作")
(def count-basic-pass
  (let [count (args/count)]
    (and
      (integer? count)
      (>= count 1))))  ;; 最低でもプログラム名がある

(if count-basic-pass
  (println "✓ countの基本動作は正しく動作した")
  (println "✗ countの基本動作に問題がある"))

; ========================================
; Section 2: args/all
; ========================================

(println "\n--- Section 2: args/all ---")

; 2.1 基本動作
(println "\n[2.1] all - 基本動作")
(def all-basic-pass
  (let [args (args/all)]
    (and
      (list? args)
      (>= (len args) 1))))  ;; 最低でもプログラム名がある

(if all-basic-pass
  (println "✓ allの基本動作は正しく動作した")
  (println "✗ allの基本動作に問題がある"))

; 2.2 要素の型
(println "\n[2.2] all - 要素の型")
(def all-types-pass
  (let [args (args/all)]
    (list/every? string? args)))

(if all-types-pass
  (println "✓ allの要素の型は正しく動作した")
  (println "✗ allの要素の型に問題がある"))

; ========================================
; Section 3: args/get
; ========================================

(println "\n--- Section 3: args/get ---")

; 3.1 プログラム名の取得
(println "\n[3.1] get - プログラム名")
(def get-prog-pass
  (let [prog (args/get 0)]
    (string? prog)))

(if get-prog-pass
  (println "✓ getのプログラム名取得は正しく動作した")
  (println "✗ getのプログラム名取得に問題がある"))

; 3.2 デフォルト値
(println "\n[3.2] get - デフォルト値")
(def get-default-pass
  (let [large-index 9999
        result (args/get large-index "default")]
    (= result "default")))

(if get-default-pass
  (println "✓ getのデフォルト値は正しく動作した")
  (println "✗ getのデフォルト値に問題がある"))

; 3.3 範囲外アクセス（デフォルトなし）
(println "\n[3.3] get - 範囲外アクセス")
(def get-out-of-range-pass
  (let [large-index 9999
        result (args/get large-index)]
    (nil? result)))

(if get-out-of-range-pass
  (println "✓ getの範囲外アクセスは正しく動作した")
  (println "✗ getの範囲外アクセスに問題がある"))

; ========================================
; Section 4: args/parse
; ========================================

(println "\n--- Section 4: args/parse ---")

; 4.1 基本動作
(println "\n[4.1] parse - 基本動作")
(def parse-basic-pass
  (let [result (args/parse)]
    (and
      (map? result)
      (some? (get result ":flags"))
      (some? (get result ":options"))
      (some? (get result ":positional")))))

(if parse-basic-pass
  (println "✓ parseの基本動作は正しく動作した")
  (println "✗ parseの基本動作に問題がある"))

; 4.2 各フィールドの型
(println "\n[4.2] parse - フィールドの型")
(def parse-types-pass
  (let [result (args/parse)
        flags (get result ":flags")
        options (get result ":options")
        positional (get result ":positional")]
    (and
      (list? flags)
      (map? options)
      (list? positional))))

(if parse-types-pass
  (println "✓ parseのフィールドの型は正しく動作した")
  (println "✗ parseのフィールドの型に問題がある"))

; ========================================
; Section 5: 統合テスト
; ========================================

(println "\n--- Section 5: 統合テスト ---")

; 5.1 count と all の整合性
(println "\n[5.1] count と all の整合性")
(def integration-pass
  (= (args/count) (len (args/all))))

(if integration-pass
  (println "✓ count と all の整合性は正しい")
  (println "✗ count と all の整合性に問題がある"))

; 5.2 get と all の整合性
(println "\n[5.2] get と all の整合性")
(def get-all-pass
  (let [all-args (args/all)
        first-arg (args/get 0)]
    (= first-arg (first all-args))))

(if get-all-pass
  (println "✓ get と all の整合性は正しい")
  (println "✗ get と all の整合性に問題がある"))

; ========================================
; 最終結果
; ========================================

(println "\n========================================")
(println "コマンドライン引数関数 Torture Test 完了")
(println "========================================")
(println "\n全セクションが実行されました。")
(println "各セクションのチェックマーク (✓/✗) を確認してください。")
(println "\n注意: このテストは実行時の環境に依存します。")
(println "      完全なテストには様々な引数パターンでの実行が必要です。")
