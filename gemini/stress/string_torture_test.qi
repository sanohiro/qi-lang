; string_torture_test.qi
; æ–‡å­—åˆ—é–¢æ•°ï¼ˆ71å€‹ï¼‰ã® torture test
;
; åŸºæœ¬æ“ä½œ(20): split, upper, lower, trim, contains?, starts-with?, ends-with?,
;               index-of, last-index-of, slice, take-str, drop-str, sub-before,
;               sub-after, replace, replace-first, lines, words, capitalize,
;               trim-left, trim-right
; æ–‡å­—åˆ—è¿°èª(10): digit?, alpha?, alnum?, space?, lower?, upper?, numeric?,
;                 integer?, blank?, ascii?
; ã‚±ãƒ¼ã‚¹å¤‰æ›ç­‰(15): repeat, chars-count, bytes-count, pad-left, pad-right, pad,
;                   squish, expand-tabs, title, reverse, chars, snake, camel,
;                   kebab, pascal
; ãã®ä»–(11): split-camel, truncate, trunc-words, splice, indent, wrap,
;             parse-int, parse-float, slugify, word-count
; æ­£è¦è¡¨ç¾(5): re-find, re-matches, re-replace, re-match-groups, re-split
; ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ(4): format, format-decimal, format-comma, format-percent
; ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°(6): to-base64, from-base64, url-encode, url-decode,
;                      html-encode, html-decode
; æš—å·(2): hash, uuid

(println "========================================")
(println "æ–‡å­—åˆ—é–¢æ•° Torture Test é–‹å§‹")
(println "========================================")

; ========================================
; Section 1: åŸºæœ¬æ–‡å­—åˆ—æ“ä½œ
; ========================================

(println "\n--- Section 1: åŸºæœ¬æ–‡å­—åˆ—æ“ä½œ ---")

; 1.1 str/split - æ–‡å­—åˆ—åˆ†å‰²
(println "\n[1.1] str/split")
(def split-test-pass
  (and
    (= (str/split "a,b,c" ",") ["a" "b" "c"])
    (= (str/split "hello world" " ") ["hello" "world"])
    (= (str/split "" ",") [""])
    (= (str/split "no-delimiter" ",") ["no-delimiter"])
    (= (str/split "a::b::c" "::") ["a" "b" "c"])))

(if split-test-pass
  (println "âœ“ str/splitã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— str/splitã«å•é¡ŒãŒã‚ã‚‹"))

; 1.2 str/upper, str/lower - å¤§æ–‡å­—å°æ–‡å­—å¤‰æ›
(println "\n[1.2] str/upper, str/lower")
(def case-test-pass
  (and
    (= (str/upper "hello") "HELLO")
    (= (str/lower "WORLD") "world")
    (= (str/upper "æ—¥æœ¬èª") "æ—¥æœ¬èª")
    (= (str/lower "MiXeD") "mixed")
    (= (str/upper "") "")))

(if case-test-pass
  (println "âœ“ str/upper, str/lowerã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— å¤§æ–‡å­—å°æ–‡å­—å¤‰æ›ã«å•é¡ŒãŒã‚ã‚‹"))

; 1.3 str/trimç³» - ç©ºç™½å‰Šé™¤
(println "\n[1.3] str/trim, str/trim-left, str/trim-right")
(def trim-test-pass
  (and
    (= (str/trim "  hello  ") "hello")
    (= (str/trim-left "  hello  ") "hello  ")
    (= (str/trim-right "  hello  ") "  hello")
    (= (str/trim "\t\nhello\n\t") "hello")
    (= (str/trim "") "")))

(if trim-test-pass
  (println "âœ“ trimç³»é–¢æ•°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— trimç³»é–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹"))

; 1.4 str/contains?, str/starts-with?, str/ends-with? - éƒ¨åˆ†æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
(println "\n[1.4] str/contains?, str/starts-with?, str/ends-with?")
(def substr-test-pass
  (and
    (str/contains? "hello world" "world")
    (not (str/contains? "hello" "xyz"))
    (str/starts-with? "hello world" "hello")
    (not (str/starts-with? "hello" "world"))
    (str/ends-with? "hello world" "world")
    (not (str/ends-with? "hello" "xyz"))))

(if substr-test-pass
  (println "âœ“ éƒ¨åˆ†æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— éƒ¨åˆ†æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯ã«å•é¡ŒãŒã‚ã‚‹"))

; 1.5 str/index-of, str/last-index-of - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œç´¢
(println "\n[1.5] str/index-of, str/last-index-of")
(def index-test-pass
  (and
    (= (str/index-of "hello world" "o") 4)
    (= (str/last-index-of "hello world" "o") 7)
    (= (str/index-of "abc" "xyz") nil)
    (= (str/index-of "aaa" "a") 0)))

(if index-test-pass
  (println "âœ“ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œç´¢ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ¤œç´¢ã«å•é¡ŒãŒã‚ã‚‹"))

; 1.6 str/slice - éƒ¨åˆ†æ–‡å­—åˆ—æŠ½å‡º
(println "\n[1.6] str/slice")
(def slice-test-pass
  (and
    (= (str/slice "hello" 0 2) "he")
    (= (str/slice "hello" 1 4) "ell")
    (= (str/slice "hello" 2 5) "llo")
    (= (str/slice "æ—¥æœ¬èª" 0 2) "æ—¥æœ¬")))

(if slice-test-pass
  (println "âœ“ str/sliceã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— str/sliceã«å•é¡ŒãŒã‚ã‚‹"))

; 1.7 str/take-str, str/drop-str
(println "\n[1.7] str/take-str, str/drop-str")
(def take-drop-test-pass
  (and
    (= (str/take-str 3 "hello") "hel")
    (= (str/drop-str 2 "hello") "llo")
    (= (str/take-str 0 "hello") "")
    (= (str/drop-str 10 "hello") "")))

(if take-drop-test-pass
  (println "âœ“ str/take-str, str/drop-strã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— take/dropã«å•é¡ŒãŒã‚ã‚‹"))

; 1.8 str/replace, str/replace-first - ç½®æ›
(println "\n[1.8] str/replace, str/replace-first")
(def replace-test-pass
  (and
    (= (str/replace "hello world" "o" "0") "hell0 w0rld")
    (= (str/replace-first "hello world" "o" "0") "hell0 world")
    (= (str/replace "aaa" "a" "b") "bbb")
    (= (str/replace "hello" "xyz" "abc") "hello")))

(if replace-test-pass
  (println "âœ“ ç½®æ›é–¢æ•°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ç½®æ›é–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹"))

; 1.9 str/lines, str/words - åˆ†å‰²
(println "\n[1.9] str/lines, str/words")
(def split-lines-test-pass
  (and
    (= (str/lines "a\nb\nc") ["a" "b" "c"])
    (= (str/words "hello world test") ["hello" "world" "test"])
    (= (len (str/lines "line1\nline2\nline3")) 3)
    (= (len (str/words "one two three four")) 4)))

(if split-lines-test-pass
  (println "âœ“ str/lines, str/wordsã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— è¡Œãƒ»å˜èªåˆ†å‰²ã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 2: æ–‡å­—åˆ—è¿°èª
; ========================================

(println "\n--- Section 2: æ–‡å­—åˆ—è¿°èª ---")

; 2.1 æ–‡å­—ç¨®åˆ¤å®š
(println "\n[2.1] æ–‡å­—ç¨®åˆ¤å®šè¿°èª")
(def char-type-test-pass
  (and
    (str/digit? "123")
    (not (str/digit? "abc"))
    (str/alpha? "abc")
    (not (str/alpha? "123"))
    (str/alnum? "abc123")
    (not (str/alnum? "abc-123"))
    (str/space? "   ")
    (not (str/space? "hello"))
    (str/lower? "hello")
    (not (str/lower? "Hello"))
    (str/upper? "HELLO")
    (not (str/upper? "Hello"))))

(if char-type-test-pass
  (println "âœ“ æ–‡å­—ç¨®åˆ¤å®šã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— æ–‡å­—ç¨®åˆ¤å®šã«å•é¡ŒãŒã‚ã‚‹"))

; 2.2 æ•°å€¤ãƒ»ç©ºç™½åˆ¤å®š
(println "\n[2.2] str/numeric?, str/integer?, str/blank?, str/ascii?")
(def special-pred-test-pass
  (and
    (str/numeric? "123.45")
    (str/integer? "123")
    (not (str/integer? "12.3"))
    (str/blank? "   ")
    (str/blank? "")
    (not (str/blank? "hello"))
    (str/ascii? "hello")
    (not (str/ascii? "æ—¥æœ¬èª"))))

(if special-pred-test-pass
  (println "âœ“ ç‰¹æ®Šè¿°èªã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ç‰¹æ®Šè¿°èªã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 3: ã‚±ãƒ¼ã‚¹å¤‰æ›ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
; ========================================

(println "\n--- Section 3: ã‚±ãƒ¼ã‚¹å¤‰æ›ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ---")

; 3.1 å„ç¨®ã‚±ãƒ¼ã‚¹å¤‰æ›
(println "\n[3.1] str/snake, str/camel, str/kebab, str/pascal")
(def case-convert-test-pass
  (and
    (= (str/snake "helloWorld") "hello_world")
    (= (str/camel "hello_world") "helloWorld")
    (= (str/kebab "helloWorld") "hello-world")
    (= (str/pascal "hello_world") "HelloWorld")))

(if case-convert-test-pass
  (println "âœ“ ã‚±ãƒ¼ã‚¹å¤‰æ›ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ã‚±ãƒ¼ã‚¹å¤‰æ›ã«å•é¡ŒãŒã‚ã‚‹"))

; 3.2 ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°
(println "\n[3.2] str/pad-left, str/pad-right, str/pad")
(def pad-test-pass
  (and
    (= (str/pad-left "5" 3 "0") "005")
    (= (str/pad-right "5" 3 "0") "500")
    (= (len (str/pad "hi" 10 " ")) 10)))

(if pad-test-pass
  (println "âœ“ ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã«å•é¡ŒãŒã‚ã‚‹"))

; 3.3 ãã®ä»–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
(println "\n[3.3] str/repeat, str/reverse, str/capitalize, str/title")
(def format-test-pass
  (and
    (= (str/repeat "ab" 3) "ababab")
    (= (str/reverse "hello") "olleh")
    (= (str/capitalize "hello") "Hello")
    (= (str/title "hello world") "Hello World")))

(if format-test-pass
  (println "âœ“ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹"))

; 3.4 æ–‡å­—æ•°ãƒ»ãƒã‚¤ãƒˆæ•°
(println "\n[3.4] str/chars-count, str/bytes-count, str/word-count")
(def count-test-pass
  (and
    (= (str/chars-count "hello") 5)
    (= (str/chars-count "æ—¥æœ¬èª") 3)
    (= (str/bytes-count "hello") 5)
    (> (str/bytes-count "æ—¥æœ¬èª") 3)
    (= (str/word-count "hello world test") 3)))

(if count-test-pass
  (println "âœ“ ã‚«ã‚¦ãƒ³ãƒˆé–¢æ•°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ã‚«ã‚¦ãƒ³ãƒˆé–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 4: æ­£è¦è¡¨ç¾
; ========================================

(println "\n--- Section 4: æ­£è¦è¡¨ç¾ ---")

; 4.1 æ­£è¦è¡¨ç¾æ“ä½œ
(println "\n[4.1] str/re-find, str/re-matches, str/re-replace")
(def regex-test-pass
  (and
    (some? (str/re-find "\\d+" "abc123def"))
    (some? (str/re-matches "^\\d+$" "123"))
    (= (str/re-replace "\\d+" "X" "abc123def456") "abcXdefX")))

(if regex-test-pass
  (println "âœ“ æ­£è¦è¡¨ç¾ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— æ­£è¦è¡¨ç¾ã«å•é¡ŒãŒã‚ã‚‹"))

; 4.2 æ­£è¦è¡¨ç¾åˆ†å‰²
(println "\n[4.2] str/re-split")
(def re-split-test-pass
  (and
    (= (len (str/re-split "\\s+" "hello   world  test")) 3)
    (= (len (str/re-split "," "a,b,c")) 3)))

(if re-split-test-pass
  (println "âœ“ str/re-splitã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— str/re-splitã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 5: ãƒ‘ãƒ¼ã‚¹ãƒ»å¤‰æ›
; ========================================

(println "\n--- Section 5: ãƒ‘ãƒ¼ã‚¹ãƒ»å¤‰æ› ---")

; 5.1 æ•°å€¤ãƒ‘ãƒ¼ã‚¹
(println "\n[5.1] str/parse-int, str/parse-float")
(def parse-test-pass
  (and
    (= (str/parse-int "123") 123)
    (= (str/parse-int "-42") -42)
    (= (str/parse-float "3.14") 3.14)
    (= (str/parse-float "-2.5") -2.5)))

(if parse-test-pass
  (println "âœ“ ãƒ‘ãƒ¼ã‚¹é–¢æ•°ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— ãƒ‘ãƒ¼ã‚¹é–¢æ•°ã«å•é¡ŒãŒã‚ã‚‹"))

; 5.2 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
(println "\n[5.2] str/format-decimal, str/format-comma")
(def number-format-test-pass
  (and
    (some? (str/format-decimal 3.14159 2))
    (some? (str/format-comma 1000000))))

(if number-format-test-pass
  (println "âœ“ æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— æ•°å€¤ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 6: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆfeature-gatedï¼‰
; ========================================

(println "\n--- Section 6: ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ---")

; 6.1 Base64
(println "\n[6.1] str/to-base64, str/from-base64")
(def base64-test-pass
  (let [original "hello"
        encoded (str/to-base64 original)
        decoded (str/from-base64 encoded)]
    (= decoded original)))

(if base64-test-pass
  (println "âœ“ Base64ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— Base64ã«å•é¡ŒãŒã‚ã‚‹"))

; 6.2 URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
(println "\n[6.2] str/url-encode, str/url-decode")
(def url-test-pass
  (let [original "hello world"
        encoded (str/url-encode original)
        decoded (str/url-decode encoded)]
    (= decoded original)))

(if url-test-pass
  (println "âœ“ URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«å•é¡ŒãŒã‚ã‚‹"))

; 6.3 HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
(println "\n[6.3] str/html-encode, str/html-decode")
(def html-test-pass
  (let [original "<div>test</div>"
        encoded (str/html-encode original)
        decoded (str/html-decode encoded)]
    (and
      (str/contains? encoded "&lt;")
      (str/contains? encoded "&gt;")
      (= decoded original))))

(if html-test-pass
  (println "âœ“ HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 7: æš—å·ãƒ»ãƒãƒƒã‚·ãƒ¥ï¼ˆfeature-gatedï¼‰
; ========================================

(println "\n--- Section 7: æš—å·ãƒ»ãƒãƒƒã‚·ãƒ¥ ---")

; 7.1 ãƒãƒƒã‚·ãƒ¥
(println "\n[7.1] str/hash")
(def hash-test-pass
  (let [hash1 (str/hash "hello")
        hash2 (str/hash "hello")
        hash3 (str/hash "world")]
    (and
      (= hash1 hash2)
      (not (= hash1 hash3))
      (> (str/chars-count hash1) 10))))

(if hash-test-pass
  (println "âœ“ str/hashã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— str/hashã«å•é¡ŒãŒã‚ã‚‹"))

; 7.2 UUID
(println "\n[7.2] str/uuid")
(def uuid-test-pass
  (let [uuid1 (str/uuid)
        uuid2 (str/uuid)]
    (and
      (not (= uuid1 uuid2))
      (= (str/chars-count uuid1) 36)
      (str/contains? uuid1 "-"))))

(if uuid-test-pass
  (println "âœ“ str/uuidã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— str/uuidã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; Section 8: é«˜è² è·ãƒ†ã‚¹ãƒˆ
; ========================================

(println "\n--- Section 8: é«˜è² è·ãƒ†ã‚¹ãƒˆ ---")

; 8.1 å¤§é‡æ–‡å­—åˆ—ã®å‡¦ç†
(println "\n[8.1] å¤§é‡æ–‡å­—åˆ—ã®åˆ†å‰²ãƒ»çµåˆ")
(def large-str (str/repeat "word " 1000))
(def words (str/words large-str))
(def large-test-pass
  (and
    (= (len words) 1000)
    (= (str/chars-count large-str) 5000)))

(if large-test-pass
  (println "âœ“ å¤§é‡æ–‡å­—åˆ—ã®å‡¦ç†ãŒæˆåŠŸã—ãŸ")
  (println "âœ— å¤§é‡æ–‡å­—åˆ—ã®å‡¦ç†ã«å¤±æ•—"))

; 8.2 è¤‡é›‘ãªå¤‰æ›ãƒã‚§ãƒ¼ãƒ³
(println "\n[8.2] è¤‡é›‘ãªå¤‰æ›ãƒã‚§ãƒ¼ãƒ³")
(def chain-test-pass
  (let [result ("  HELLO_WORLD  "
                |> str/trim
                |> str/lower
                |> (str/replace _ "_" "-"))]
    (= result "hello-world")))

(if chain-test-pass
  (println "âœ“ å¤‰æ›ãƒã‚§ãƒ¼ãƒ³ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— å¤‰æ›ãƒã‚§ãƒ¼ãƒ³ã«å•é¡ŒãŒã‚ã‚‹"))

; 8.3 Unicodeå‡¦ç†
(println "\n[8.3] Unicodeæ–‡å­—åˆ—ã®å‡¦ç†")
(def unicode-test-pass
  (and
    (= (str/chars-count "ğŸğŸŠğŸ‹") 3)
    (= (str/reverse "æ—¥æœ¬èª") "èªæœ¬æ—¥")
    (= (str/upper "cafÃ©") "CAFÃ‰")))

(if unicode-test-pass
  (println "âœ“ Unicodeå‡¦ç†ã¯æ­£ã—ãå‹•ä½œã—ãŸ")
  (println "âœ— Unicodeå‡¦ç†ã«å•é¡ŒãŒã‚ã‚‹"))

; ========================================
; æœ€çµ‚çµæœ
; ========================================

(println "\n========================================")
(println "æ–‡å­—åˆ—é–¢æ•° Torture Test å®Œäº†")
(println "========================================")
(println "\nå…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚")
(println "å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ (âœ“/âœ—) ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
