; ========================================
; ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨å¢ƒç•Œæ¡ä»¶ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ
; ========================================
;
; ç›®çš„: äºˆæœŸã—ãªã„å…¥åŠ›ã‚„æ¥µç«¯ãªçŠ¶æ³ã§ã®å‹•ä½œã‚’ç¢ºèª
;
; ãƒ†ã‚¹ãƒˆé …ç›®:
; 1. ç©ºã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®æ“ä½œ
; 2. nil/false/0/""ã®åŒºåˆ¥ã¨æ‰±ã„
; 3. æ¥µç«¯ã«å¤§ããª/å°ã•ãªæ•°å€¤
; 4. ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€æ–‡å­—åˆ—
; 5. å¾ªç’°å‚ç…§ï¼ˆãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®é™ç•Œï¼‰
; 6. é«˜éšé–¢æ•°ã®æ¥µç«¯ãªãƒã‚¹ãƒˆ
;
; ãªãœã“ã‚ŒãŒé‡è¦ã‹:
; - ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„ã“ã¨ã‚’ç¢ºèª
; - äºˆæœŸã—ãªã„å‹•ä½œã‚’ã—ãªã„ã“ã¨ã‚’ç¢ºèª
; - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

(println "=== Edge Cases Stress Test ===\n")

; ========================================
; Test 1: ç©ºã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹æ“ä½œ
; ========================================
; ç†ç”±: ç©ºã®å ´åˆã®ç‰¹åˆ¥å‡¦ç†ãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
;       nilã‚„ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãã€é©åˆ‡ãªå€¤ã‚’è¿”ã™ã“ã¨ã‚’ç¢ºèª

(println "Test 1: Empty Collections")
(def empty-vec [])
(def empty-map {})
(def empty-list '())

(if (and
      (= 0 (len empty-vec))
      (= 0 (len empty-map))
      (= 0 (len empty-list))
      (= nil (first empty-vec))
      (= nil (last empty-vec))
      (= [] (rest empty-vec))
      (= [] (map inc empty-vec))
      (= [] (filter (fn [_] true) empty-vec))
      (= 0 (reduce + 0 empty-vec)))
  (println "  âœ“ ç©ºã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œæˆåŠŸ")
  (println "  âœ— ç©ºã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œå¤±æ•—"))

; ========================================
; Test 2: nil/false/0/"" ã®å³å¯†ãªåŒºåˆ¥
; ========================================
; ç†ç”±: ã“ã‚Œã‚‰ã¯å…¨ã¦ç•°ãªã‚‹å€¤ã ãŒã€æ¡ä»¶å¼ã§ã®æ‰±ã„ãŒç‰¹æ®Š
;       0ã¨""ã¯truthyã§ã‚ã‚‹ï¼ˆQiè¨€èªã®ç‰¹å¾´ï¼‰

(println "\nTest 2: nil/false/0/empty-string Distinction")
(if (and
      (= nil nil)
      (= false false)
      (= 0 0)
      (= "" "")
      (not (= nil false))
      (not (= nil 0))
      (not (= nil ""))
      (not (= false 0))
      (not (= false ""))
      (not (= 0 ""))
      ; truthiness
      (if nil false true)     ; nil -> false
      (if false false true)   ; false -> false
      (if 0 true false)       ; 0 -> true (truthy!)
      (if "" true false))     ; "" -> true (truthy!)
  (println "  âœ“ nil/false/0/\"\"ã®åŒºåˆ¥æˆåŠŸ")
  (println "  âœ— nil/false/0/\"\"ã®åŒºåˆ¥å¤±æ•—"))

; ========================================
; Test 3: æ¥µç«¯ã«å¤§ããªæ•°å€¤
; ========================================
; ç†ç”±: æ•°å€¤ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚„ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ã®æ‰±ã„

(println "\nTest 3: Extreme Numbers")
(def large 9223372036854775807)  ; i64ã®æœ€å¤§å€¤
(def small -9223372036854775808) ; i64ã®æœ€å°å€¤

(if (and
      (= large 9223372036854775807)
      (= small -9223372036854775808)
      (> large 0)
      (< small 0))
  (println "  âœ“ æ¥µç«¯ãªæ•°å€¤ã®æ‰±ã„æˆåŠŸ")
  (println "  âœ— æ¥µç«¯ãªæ•°å€¤ã®æ‰±ã„å¤±æ•—"))

; ========================================
; Test 4: ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€æ–‡å­—åˆ—
; ========================================
; ç†ç”±: ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚„éASCIIæ–‡å­—ãŒæ­£ã—ãæ‰±ã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 4: Special Characters in Strings")
(def special "Hello\nWorld\t\"Quote\"\r\næ—¥æœ¬èª\u0041")

(if (and
      (str/contains? special "\n")
      (str/contains? special "\t")
      (str/contains? special "\"")
      (str/contains? special "æ—¥æœ¬èª")
      (str/contains? special "A"))  ; \u0041 ã¯ 'A'
  (println "  âœ“ ç‰¹æ®Šæ–‡å­—ã®æ‰±ã„æˆåŠŸ")
  (println "  âœ— ç‰¹æ®Šæ–‡å­—ã®æ‰±ã„å¤±æ•—"))

; ========================================
; Test 5: è¤‡æ•°è¡Œæ–‡å­—åˆ—ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
; ========================================
; ç†ç”±: ãƒˆãƒªãƒ—ãƒ«ã‚¯ã‚ªãƒ¼ãƒˆæ–‡å­—åˆ—ã®å¢ƒç•Œæ¡ä»¶

(println "\nTest 5: Multi-line String Edge Cases")
(def empty-multiline """""")
(def single-line """single""")
(def with-quotes """He said "Hello"!""")

(if (and
      (= empty-multiline "")
      (= single-line "single")
      (str/contains? with-quotes "\""))
  (println "  âœ“ è¤‡æ•°è¡Œæ–‡å­—åˆ—ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹æˆåŠŸ")
  (println "  âœ— è¤‡æ•°è¡Œæ–‡å­—åˆ—ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹å¤±æ•—"))

; ========================================
; Test 6: ãƒã‚¹ãƒˆã®æ¥µé™
; ========================================
; ç†ç”±: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ãƒã‚¹ãƒˆãŒæ·±ã™ãã¦ã‚‚ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãªã„ã“ã¨ã‚’ç¢ºèª

(println "\nTest 6: Extreme Nesting (10 levels)")
(def deep-nest
  [[[[[[[[[[42]]]]]]]]]])

(def extracted
  (first (first (first (first (first (first (first (first (first (first deep-nest)))))))))))

(if (= extracted 42)
  (println "  âœ“ 10éšå±¤ãƒã‚¹ãƒˆæˆåŠŸ")
  (println "  âœ— 10éšå±¤ãƒã‚¹ãƒˆå¤±æ•—"))

; ========================================
; Test 7: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹
; ========================================
; ç†ç”±: ç‰¹æ®Šãªåå‰ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 7: Keyword Edge Cases")
(def data {:+ 1 :- 2 :* 3 :/ 4 :if 5 :fn 6 :def 7})

(if (and
      (= 1 (:+ data))
      (= 2 (:- data))
      (= 3 (:* data))
      (= 4 (:/ data))
      (= 5 (:if data))
      (= 6 (:fn data))
      (= 7 (:def data)))
  (println "  âœ“ ç‰¹æ®Šåã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æˆåŠŸ")
  (println "  âœ— ç‰¹æ®Šåã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¤±æ•—"))

; ========================================
; Test 8: é«˜éšé–¢æ•°ã®æ¥µç«¯ãªãƒã‚¹ãƒˆ
; ========================================
; ç†ç”±: é–¢æ•°ã‚’è¿”ã™é–¢æ•°ã‚’è¿”ã™é–¢æ•°...ãŒæ­£ã—ãå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 8: Deeply Nested Higher-Order Functions")
(def make-adder
  (fn [a]
    (fn [b]
      (fn [c]
        (fn [d]
          (+ a b c d))))))

(def add-all (((make-adder 1) 2) 3))
(def result (add-all 4))

(if (= result 10)
  (println "  âœ“ é«˜éšé–¢æ•°ã®æ·±ã„ãƒã‚¹ãƒˆæˆåŠŸ")
  (println "  âœ— é«˜éšé–¢æ•°ã®æ·±ã„ãƒã‚¹ãƒˆå¤±æ•—"))

; ========================================
; Test 9: compã®æ¥µç«¯ãªä½¿ç”¨
; ========================================
; ç†ç”±: é–¢æ•°åˆæˆã‚’å¤šæ®µéšã§ä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 9: Extreme Function Composition")
(def transform
  (comp
    (fn [x] (+ x 1))
    (fn [x] (* x 2))
    (fn [x] (- x 3))
    (fn [x] (/ x 4))
    (fn [x] (+ x 5))))

; 10 -> 15 -> (15-3)/4 -> 12/4 -> 3 -> 6 -> 7
(def result (transform 10))

(if (= result 7)
  (println "  âœ“ æ¥µç«¯ãªé–¢æ•°åˆæˆæˆåŠŸ")
  (println f"  âœ— æ¥µç«¯ãªé–¢æ•°åˆæˆå¤±æ•—: {result}"))

; ========================================
; Test 10: å·¨å¤§ãªãƒãƒƒãƒ—ï¼ˆ100å€‹ã®ã‚­ãƒ¼ï¼‰
; ========================================
; ç†ç”±: å¤§ããªãƒãƒƒãƒ—ãŒåŠ¹ç‡çš„ã«æ‰±ãˆã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 10: Large Map (100 keys)")
(def large-map
  (reduce
    (fn [m i] (assoc m (keyword (str "key" i)) i))
    {}
    (range 0 100)))

(if (and
      (= 100 (len large-map))
      (= 0 (:key0 large-map))
      (= 50 (:key50 large-map))
      (= 99 (:key99 large-map)))
  (println "  âœ“ 100ã‚­ãƒ¼ãƒãƒƒãƒ—æˆåŠŸ")
  (println "  âœ— 100ã‚­ãƒ¼ãƒãƒƒãƒ—å¤±æ•—"))

; ========================================
; Test 11: è² ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ï¼‰
; ========================================
; ç†ç”±: ä¸æ­£ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 11: Negative Index Handling")
(def vec [1 2 3 4 5])

; nthã¯ç¯„å›²å¤–ã§nilã‚’è¿”ã™å®Ÿè£…ã®å ´åˆ
(def result (try
              {:ok (nth vec -1)}
              (catch e {:error e})))

(if (or (= nil (get result :ok)) (= :error (first (keys result))))
  (println "  âœ“ è² ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‡¦ç†æˆåŠŸ")
  (println "  âœ— è² ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‡¦ç†å¤±æ•—"))

; ========================================
; Test 12: ç©ºæ–‡å­—åˆ—ã‚­ãƒ¼
; ========================================
; ç†ç”±: ç©ºæ–‡å­—åˆ—ãŒã‚­ãƒ¼ã¨ã—ã¦ä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 12: Empty String as Map Key")
(def m {"" "empty-key" "normal" "value"})

(if (and
      (= "empty-key" (get m ""))
      (= "value" (get m "normal")))
  (println "  âœ“ ç©ºæ–‡å­—åˆ—ã‚­ãƒ¼æˆåŠŸ")
  (println "  âœ— ç©ºæ–‡å­—åˆ—ã‚­ãƒ¼å¤±æ•—"))

; ========================================
; Test 13: åŒä¸€æ€§ vs ç­‰ä¾¡æ€§
; ========================================
; ç†ç”±: = ãŒå€¤ã®ç­‰ä¾¡æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 13: Identity vs Equality")
(def v1 [1 2 3])
(def v2 [1 2 3])
(def v3 v1)

(if (and
      (= v1 v2)   ; æ§‹é€ çš„ç­‰ä¾¡æ€§
      (= v1 v3)
      (= v2 v3))
  (println "  âœ“ ç­‰ä¾¡æ€§ãƒã‚§ãƒƒã‚¯æˆåŠŸ")
  (println "  âœ— ç­‰ä¾¡æ€§ãƒã‚§ãƒƒã‚¯å¤±æ•—"))

; ========================================
; Test 14: å†å¸°çš„ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆç–‘ä¼¼å¾ªç’°ï¼‰
; ========================================
; ç†ç”±: è‡ªå·±å‚ç…§çš„ãªãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¾ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
;       ï¼ˆå®Œå…¨ãªå¾ªç’°å‚ç…§ã§ã¯ãªã„ãŒã€æ·±ã„ç›¸äº’å‚ç…§ï¼‰

(println "\nTest 14: Mutually Referential Data")
(def node1 {:id 1 :next-id 2})
(def node2 {:id 2 :next-id 3})
(def node3 {:id 3 :next-id 1})
(def nodes {1 node1 2 node2 3 node3})

(defn traverse [nodes start-id depth]
  (if (<= depth 0)
    start-id
    (let [node (get nodes start-id)
          next-id (:next-id node)]
      (traverse nodes next-id (dec depth)))))

(def final-id (traverse nodes 1 5))

; 1 -> 2 -> 3 -> 1 -> 2 -> 3
(if (= final-id 3)
  (println "  âœ“ ç›¸äº’å‚ç…§ãƒ‡ãƒ¼ã‚¿æˆåŠŸ")
  (println f"  âœ— ç›¸äº’å‚ç…§ãƒ‡ãƒ¼ã‚¿å¤±æ•—: {final-id}"))

; ========================================
; Test 15: Unicodeæ–‡å­—åˆ—ã®é•·ã•
; ========================================
; ç†ç”±: ãƒãƒ«ãƒãƒã‚¤ãƒˆæ–‡å­—ãŒæ­£ã—ãæ‰±ã‚ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

(println "\nTest 15: Unicode String Length")
(def unicode "ã“ã‚“ã«ã¡ã¯ğŸ‰")  ; æ—¥æœ¬èª + çµµæ–‡å­—

(if (and
      (= 7 (len unicode))
      (= "ã“" (str/slice unicode 0 1))
      (= "ğŸ‰" (str/slice unicode 6 7)))
  (println "  âœ“ Unicodeæ–‡å­—åˆ—ã®é•·ã•æˆåŠŸ")
  (println f"  âœ— Unicodeæ–‡å­—åˆ—ã®é•·ã•å¤±æ•—: len={(len unicode)}"))

(println "\n=== Edge Cases Stress Test Complete ===")
