# Qiè¨€èªä»•æ§˜

## è¨€èªæ¦‚è¦

**Qi - A Lisp that flows**

ã‚·ãƒ³ãƒ—ãƒ«ã€é«˜é€Ÿã€ç°¡æ½”ãªãƒ¢ãƒ€ãƒ³Lispç³»è¨€èªã€‚ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã€ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ã«å¼·ã„ã€‚

**ä¸¦åˆ—ã€ä¸¦è¡Œã‚’ç°¡å˜ã«ã§ãã‚‹ã®ã¯Qiã®ã‚­ãƒ¢** - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªè¨­è¨ˆã¨3å±¤ä¸¦è¡Œå‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚

**å®Ÿè£…çŠ¶æ³**: æœ¬ä»•æ§˜æ›¸ã«ã¯è¨ˆç”»ä¸­ã®æ©Ÿèƒ½ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½ã«ã¯ âœ… ãƒãƒ¼ã‚¯ã€æœªå®Ÿè£…ã®æ©Ÿèƒ½ã«ã¯ ğŸš§ ãƒãƒ¼ã‚¯ã‚’ä»˜è¨˜ã—ã¦ã„ã¾ã™ã€‚

---

## è¨€èªå“²å­¦ - Flow-Oriented Programming

### æ ¸ã¨ãªã‚‹æ€æƒ³

**ã€Œãƒ‡ãƒ¼ã‚¿ã¯æµã‚Œã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯æµã‚Œã‚’è¨­è¨ˆã™ã‚‹ã€**

Qiã¯**Flow-Oriented Programming**ï¼ˆæµã‚ŒæŒ‡å‘ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼‰ã‚’ä½“ç¾ã—ã¾ã™ï¼š

1. **ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒç¬¬ä¸€ç´šå¸‚æ°‘**
   - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ `|>` ãŒè¨€èªã®ä¸­å¿ƒ
   - `match` ã¯æµã‚Œã‚’åˆ†å²ãƒ»å¤‰æ›ã™ã‚‹åˆ¶å¾¡æ§‹é€ ï¼ˆ`=> å¤‰æ›` ã§æµã‚Œã‚’ç¶™ç¶šï¼‰
   - å°ã•ãªå¤‰æ›ã‚’çµ„ã¿åˆã‚ã›ã¦å¤§ããªæµã‚Œã‚’ä½œã‚‹
   - Unixå“²å­¦ã®ã€ŒDo One Thing Wellã€ã‚’é–¢æ•°å‹ã§å®Ÿç¾

2. **Simple, Fast, Concise**
   - **Simple**: ç‰¹æ®Šå½¢å¼9ã¤ã€è¨˜æ³•æœ€å°é™ã€å­¦ç¿’æ›²ç·šãŒç·©ã‚„ã‹
   - **Fast**: è»½é‡ãƒ»é«˜é€Ÿèµ·å‹•ãƒ»å°†æ¥çš„ã«JITã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
   - **Concise**: çŸ­ã„é–¢æ•°åã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€`defn`ç³–è¡£æ§‹æ–‡ã§è¡¨ç¾åŠ›è±Šã‹

3. **ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æµã‚Œ**
   - ãƒ‡ãƒ¼ã‚¿ã¯ä¸€æ–¹å‘ã«æµã‚Œã‚‹ï¼ˆå·¦ã‹ã‚‰å³ã€ä¸Šã‹ã‚‰ä¸‹ï¼‰
   - å‰¯ä½œç”¨ã¯ã‚¿ãƒƒãƒ—ï¼ˆ`tap>`ï¼‰ã§è¦³å¯Ÿ
   - ä¸¦åˆ—å‡¦ç†ã¯æµã‚Œã®åˆ†å²ãƒ»åˆæµã¨ã—ã¦è¡¨ç¾
   - **ä¸¦è¡Œãƒ»ä¸¦åˆ—ã‚’ç°¡å˜ã«** - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªè¨­è¨ˆã§è‡ªç„¶ãªä¸¦åˆ—åŒ–

4. **å®Ÿç”¨ä¸»ç¾©**
   - Lispçš„ç´”ç²‹æ€§ã‚ˆã‚Šå®Ÿç”¨æ€§ã‚’å„ªå…ˆ
   - ãƒ¢ãƒ€ãƒ³ãªæ©Ÿèƒ½ï¼ˆf-stringã€ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰ã‚’ç©æ¥µæ¡ç”¨
   - ãƒãƒƒãƒ†ãƒªãƒ¼åŒæ¢±ï¼ˆè±Šå¯Œãªæ–‡å­—åˆ—æ“ä½œã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰

---

### Flowå“²å­¦ã®é€²åŒ–

Qiã¯æ®µéšçš„ã«Flowæ©Ÿèƒ½ã‚’å¼·åŒ–ã—ã¦ã„ãã¾ã™ï¼š

**ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆâœ… ç¾åœ¨ï¼‰**:
- `|>` åŸºæœ¬ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ - é€æ¬¡å‡¦ç†
- `match` åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚° - æ§‹é€ åˆ†è§£ã¨åˆ†å²

**ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆâœ… å®Œäº†ï¼‰**:

*ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å¼·åŒ–*:
- âœ… `||>` ä¸¦åˆ—ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ - è‡ªå‹•çš„ã«pmapåŒ–ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… `tap>` å‰¯ä½œç”¨ã‚¿ãƒƒãƒ— - ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ­ã‚°è¦³å¯Ÿï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸš§ `flow` DSL - åˆ†å²ãƒ»åˆæµã‚’å«ã‚€è¤‡é›‘ãªæµã‚Œï¼ˆæœªå®Ÿè£…ï¼‰

*matchå¼·åŒ–* â­ **Qiç‹¬è‡ªã®å·®åˆ¥åŒ–è¦ç´ **:
- âœ… `:as` æŸç¸› - éƒ¨åˆ†ã¨å…¨ä½“ã‚’ä¸¡æ–¹ä½¿ãˆã‚‹
- âœ… `=> å¤‰æ›` - ãƒãƒƒãƒæ™‚ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çš„å¤‰æ›ï¼ˆmatchã®ä¸­ã«æµã‚Œã‚’åŸ‹ã‚è¾¼ã‚€ï¼‰
- ğŸš§ `or` ãƒ‘ã‚¿ãƒ¼ãƒ³ - è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŒã˜å‡¦ç†ï¼ˆ`1 | 2 | 3 -> "small"`ï¼‰ï¼ˆæœªå®Ÿè£…ï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆâœ… å®Œäº†ï¼‰**:
- âœ… ä¸¦åˆ—å‡¦ç†åŸºç›¤ - ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•Evaluatorã€pmapå®Œå…¨ä¸¦åˆ—åŒ–ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… ä¸¦è¡Œå‡¦ç† - go/chanã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€async/awaitï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… `~>` éåŒæœŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ - go/chançµ±åˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… `stream` é…å»¶è©•ä¾¡ã‚¹ãƒˆãƒªãƒ¼ãƒ  - å·¨å¤§ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆç„¡é™ãƒ‡ãƒ¼ã‚¿æ§‹é€ å¯¾å¿œï¼‰ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸ”œ å†åˆ©ç”¨å¯èƒ½ãªã€Œå°ãƒ‘ã‚¤ãƒ—ã€æ–‡åŒ–ã®ç¢ºç«‹ï¼ˆé€²è¡Œä¸­ï¼‰

---

### è¨­è¨ˆåŸå‰‡

1. **èª­ã¿ã‚„ã™ã• > æ›¸ãã‚„ã™ã•**
   - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ä¸Šã‹ã‚‰ä¸‹ã€å·¦ã‹ã‚‰å³ã«èª­ã‚ã‚‹
   - ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒä¸€ç›®ã§åˆ†ã‹ã‚‹

2. **åˆæˆå¯èƒ½æ€§**
   - å°ã•ãªé–¢æ•°ã‚’çµ„ã¿åˆã‚ã›ã¦å¤§ããªå‡¦ç†ã‚’ä½œã‚‹
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã¯ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½

3. **æ®µéšçš„é–‹ç¤º**
   - åˆå¿ƒè€…: åŸºæœ¬çš„ãª `|>` ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹
   - ä¸­ç´šè€…: `match`ã€`loop`ã€ãƒã‚¯ãƒ­ã‚’æ´»ç”¨
   - ä¸Šç´šè€…: ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã€ä¸¦åˆ—å‡¦ç†ã‚’é§†ä½¿

4. **å®Ÿè¡Œæ™‚ã®åŠ¹ç‡**
   - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯æœ€é©åŒ–ã•ã‚Œã‚‹
   - é…å»¶è©•ä¾¡ã§ä¸è¦ãªè¨ˆç®—ã‚’å›é¿
   - ä¸¦åˆ—å‡¦ç†ã§è‡ªç„¶ã«ã‚¹ã‚±ãƒ¼ãƒ«

### ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­
```
.qi
```

---

## ä½¿ã„æ–¹ - Qiã®å®Ÿè¡Œæ–¹æ³•

Qiã¯3ã¤ã®å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ + æ¨™æº–å…¥åŠ›ã‚’ã‚µãƒãƒ¼ãƒˆï¼š

### 1. REPLï¼ˆå¯¾è©±ãƒ¢ãƒ¼ãƒ‰ï¼‰
```bash
qi
# ã¾ãŸã¯
qi -l utils.qi  # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦REPLèµ·å‹•
```

### 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
```bash
qi script.qi
qi examples/hello.qi
```

### 3. ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼å®Ÿè¡Œ
```bash
qi -e '(println "Hello!")'
qi -e '(range 1 10 |> (map (fn [x] (* x x))) |> sum)'
```

### 4. æ¨™æº–å…¥åŠ›ã‹ã‚‰å®Ÿè¡Œï¼ˆâœ… NEW!ï¼‰
**Unixå“²å­¦ã«æº–æ‹  - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ**

```bash
# echoã‹ã‚‰
echo '(println "Hello from stdin!")' | qi -

# heredocã§è¤‡æ•°è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
qi - <<'EOF'
(def data [1 2 3 4 5])
(def result (data |> (map (fn [x] (* x x))) |> sum))
(println (str "Sum of squares: " result))
EOF

# ä»–ã®ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰Qiã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆ
jq -r '.script' config.json | qi -
curl -s https://example.com/script.qi | qi -

# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šï¼‰
echo "$SECRET_SCRIPT" | qi -

# CI/CDã§ã®å‹•çš„ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
cat automation.qi | qi -
```

#### ãªãœæ¨™æº–å…¥åŠ›å®Ÿè¡ŒãŒé‡è¦ã‹ï¼Ÿ

1. **Unixå“²å­¦** - ä»–ã®ãƒ„ãƒ¼ãƒ«ï¼ˆpython/node/rubyï¼‰ã‚‚ `-` ã‚’ã‚µãƒãƒ¼ãƒˆ
2. **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ** - ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›ã‚’ç›´æ¥å®Ÿè¡Œ
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** - æ©Ÿå¯†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ®‹ã•ãªã„
4. **å‹•çš„ç”Ÿæˆ** - ä»–ã®ãƒ„ãƒ¼ãƒ«ãŒQiã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆâ†’å³å®Ÿè¡Œ
5. **CI/CDå¯¾å¿œ** - GitHub Secretsã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆæ³¨å…¥å¯èƒ½

```bash
# å®Ÿç”¨ä¾‹ï¼šJSONã‹ã‚‰Qiã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æŠ½å‡ºã—ã¦å®Ÿè¡Œ
cat automation.json | jq -r '.tasks.cleanup.script' | qi -

# å®Ÿç”¨ä¾‹ï¼šå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”Ÿæˆ
./generate-processor.sh --type=csv --columns=3 | qi -
```

---

## 1. åŸºæœ¬è¨­è¨ˆ

### åå‰ç©ºé–“
**Lisp-1ï¼ˆSchemeæ´¾ï¼‰** - å¤‰æ•°ã¨é–¢æ•°ã¯åŒã˜åå‰ç©ºé–“
```qi
(def add (fn [x y] (+ x y)))
(def op add)           ;; é–¢æ•°ã‚’å¤‰æ•°ã«ä»£å…¥
(op 1 2)               ;; 3
```

### nil ã¨ bool
**nil ã¨ bool ã¯åˆ¥ç‰©ã€ãŸã ã—æ¡ä»¶å¼ã§ã¯ nil ã‚‚ falsy**
```qi
nil false true          ;; 3ã¤ã®ç•°ãªã‚‹å€¤
(if nil "yes" "no")     ;; "no" (nilã¯falsy)
(if false "yes" "no")   ;; "no" (falseã¯falsy)
(if 0 "yes" "no")       ;; "yes" (0ã¯truthy)
(if "" "yes" "no")      ;; "yes" (ç©ºæ–‡å­—ã‚‚truthy)

;; æ˜ç¤ºçš„ãªæ¯”è¼ƒ
(= x nil)               ;; nilãƒã‚§ãƒƒã‚¯
(= x false)             ;; falseãƒã‚§ãƒƒã‚¯
```

### åå‰ç©ºé–“ã®å„ªå…ˆé †ä½
**core ãŒæœ€å„ªå…ˆï¼ˆå…ˆå‹ï¼‰**
```qi
;; coreã®é–¢æ•°ãŒå„ªå…ˆ
(get {:a 1} :a)         ;; ãƒãƒƒãƒ—ã®get

;; ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯æ˜ç¤ºçš„ã«
(use str :as s)
(s/get "hello" 0)       ;; æ–‡å­—åˆ—ã®getï¼ˆ"h"ï¼‰
```

---

## 2. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ‹¡å¼µ - Flow DSL

### ğŸ¯ ãƒ“ã‚¸ãƒ§ãƒ³: æµã‚Œã‚’è¨­è¨ˆã™ã‚‹è¨€èª

Qiã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ã‚’æ®µéšçš„ã«æ‹¡å¼µã—ã€**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ç›´æ„Ÿçš„ã«è¡¨ç¾**ã§ãã‚‹è¨€èªã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

---

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ã®ä½“ç³»

| æ¼”ç®—å­ | æ„å‘³ | çŠ¶æ…‹ | ç”¨é€” |
|--------|------|------|------|
| `|>` | é€æ¬¡ãƒ‘ã‚¤ãƒ— | âœ… å®Ÿè£…æ¸ˆã¿ | åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿å¤‰æ› |
| `\|>?` | Railway ãƒ‘ã‚¤ãƒ— | âœ… å®Ÿè£…æ¸ˆã¿ | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€Resultå‹ã®é€£é– |
| `||>` | ä¸¦åˆ—ãƒ‘ã‚¤ãƒ— | âœ… å®Ÿè£…æ¸ˆã¿ | è‡ªå‹•çš„ã«pmapåŒ–ã€ãƒªã‚¹ãƒˆå‡¦ç†ã®ä¸¦åˆ—åŒ– |
| `tap>` | å‰¯ä½œç”¨ã‚¿ãƒƒãƒ— | âœ… å®Ÿè£…æ¸ˆã¿ | ãƒ‡ãƒãƒƒã‚°ã€ãƒ­ã‚°ã€ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆé–¢æ•°ã¨ã—ã¦ï¼‰ |
| `~>` | éåŒæœŸãƒ‘ã‚¤ãƒ— | âœ… å®Ÿè£…æ¸ˆã¿ | go/chançµ±åˆã€éåŒæœŸIO |

---

### âœ… `|>` åŸºæœ¬ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**å·¦ã‹ã‚‰å³ã¸ãƒ‡ãƒ¼ã‚¿ã‚’æµã™**

```qi
;; åŸºæœ¬
(data |> parse |> transform |> save)

;; ãƒã‚¹ãƒˆå›é¿
(data
 |> (filter valid?)
 |> (map transform)
 |> (reduce merge {}))

;; å¼•æ•°ä»˜ãé–¢æ•°
(10 |> (+ 5) |> (* 2))  ;; (+ 10 5) |> (* 2) => 30

;; _ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼: ä»»æ„ã®ä½ç½®ã«å€¤ã‚’æŒ¿å…¥
(42 |> (+ 10 _ 3))  ;; (+ 10 42 3) => 55
("world" |> (str "Hello, " _))  ;; (str "Hello, " "world") => "Hello, world"

;; å®Ÿç”¨ä¾‹: URLæ§‹ç¯‰
(params
 |> (map (fn [[k v]] f"{k}={v}"))
 |> (join "&")
 |> (str base-url "?" _))
```

---

### âœ… `||>` ä¸¦åˆ—ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**è‡ªå‹•çš„ã«pmapã«å±•é–‹**

```qi
;; ä¸¦åˆ—å‡¦ç†
(urls ||> http/get ||> json/parse)
;; â†“ å±•é–‹
(urls |> (pmap http/get) |> (pmap json/parse))

;; åŸºæœ¬çš„ãªä½¿ã„æ–¹
([1 2 3 4 5] ||> inc)  ;; (2 3 4 5 6)

;; CPUé›†ç´„çš„å‡¦ç†
(images ||> resize ||> compress ||> save)

;; ãƒ‡ãƒ¼ã‚¿åˆ†æ
(files
 ||> load-csv
 ||> analyze
 |> merge-results)  ;; æœ€å¾Œã¯é€æ¬¡ã§ãƒãƒ¼ã‚¸

;; è¤‡é›‘ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
(data
 ||> (fn [x] (* x 2))
 |> (filter (fn [n] (> n 50)))
 |> sum)
```

**å®Ÿè£…**:
- lexer: `||>`ã‚’`Token::ParallelPipe`ã¨ã—ã¦èªè­˜
- parser: `x ||> f` â†’ `(pmap f x)`ã«å±•é–‹

---

### âœ… `|>?` Railway Pipelineï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æµã‚Œã®ä¸­ã«çµ„ã¿è¾¼ã‚€** - Railway Oriented Programming

```qi
;; Resultå‹: {:ok value} ã¾ãŸã¯ {:error message}
;; |>? ã¯ {:ok value} ãªã‚‰æ¬¡ã®é–¢æ•°ã«å€¤ã‚’æ¸¡ã—ã€{:error e} ãªã‚‰ã‚·ãƒ§ãƒ¼ãƒˆã‚µãƒ¼ã‚­ãƒƒãƒˆ

;; åŸºæœ¬çš„ãªä½¿ã„æ–¹
({:ok 10}
 |>? (fn [x] {:ok (* x 2)})
 |>? (fn [x] {:ok (+ x 5)}))
;; => {:ok 25}

;; ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚·ãƒ§ãƒ¼ãƒˆã‚µãƒ¼ã‚­ãƒƒãƒˆ
({:ok 10}
 |>? (fn [x] {:error "Something went wrong"})
 |>? (fn [x] {:ok (* x 2)}))  ;; ã“ã®é–¢æ•°ã¯å®Ÿè¡Œã•ã‚Œãªã„
;; => {:error "Something went wrong"}

;; JSONãƒ‘ãƒ¼ã‚¹ + ãƒ‡ãƒ¼ã‚¿å¤‰æ›
("{\"name\":\"Alice\",\"age\":30}"
 |> json/parse                    ;; => {:ok {...}}
 |>? (fn [data] {:ok (get data "name")})
 |>? (fn [name] {:ok (str/upper name)}))
;; => {:ok "ALICE"}

;; HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ + ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
("https://api.example.com/users/123"
 |> http/get                      ;; => {:ok {:status 200 :body "..."}}
 |>? (fn [resp] (get resp "body"))
 |>? json/parse
 |>? (fn [data] {:ok (get data "user")}))
;; ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•çš„ã«ä¼æ’­

;; è¤‡é›‘ãªå‡¦ç†ãƒã‚§ãƒ¼ãƒ³
(user-id
 |> (str "https://api.example.com/users/" _)
 |> http/get
 |>? (fn [resp]
       (if (= (get resp "status") 200)
         {:ok (get resp "body")}
         {:error "Failed to fetch"}))
 |>? json/parse
 |>? validate-user
 |>? save-to-db)
```

**ä½¿ã„åˆ†ã‘**:
- `|>`: é€šå¸¸ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆã‚¨ãƒ©ãƒ¼ãªã—ï¼‰
- `|>?`: ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚Šã†ã‚‹å‡¦ç†ï¼ˆAPIã€ãƒ•ã‚¡ã‚¤ãƒ«IOã€ãƒ‘ãƒ¼ã‚¹ï¼‰

**å®Ÿè£…**:
- lexer: `|>?`ã‚’`Token::PipeRailway`ã¨ã—ã¦èªè­˜
- parser: `x |>? f` â†’ `(_railway-pipe f x)`ã«å±•é–‹
- `_railway-pipe`: Resultå‹ãƒãƒƒãƒ—ã‚’æ¤œæŸ»ã—ã€`:ok`ãªã‚‰é–¢æ•°é©ç”¨ã€`:error`ãªã‚‰ãã®ã¾ã¾è¿”ã™

**è¨­è¨ˆå“²å­¦**:
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æµã‚Œã®ä¸€éƒ¨ã¨ã—ã¦è¡¨ç¾ã€‚try-catchã®ãƒã‚¹ãƒˆã‚’é¿ã‘ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãŒæ˜ç¢ºã«ãªã‚‹ã€‚JSONã‚„HTTPãªã©ã®Webé–‹ç™ºæ©Ÿèƒ½ã¨å®Œç’§ã«çµ±åˆã€‚

---

### âœ… `tap>` å‰¯ä½œç”¨ã‚¿ãƒƒãƒ—ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**æµã‚Œã‚’æ­¢ã‚ãšã«è¦³å¯Ÿ**ï¼ˆUnix `tee`ç›¸å½“ï¼‰

```qi
;; tap>ã¯é–¢æ•°ã¨ã—ã¦å®Ÿè£…
(def tap> (fn [f]
  (fn [x]
    (do
      (f x)
      x))))

;; ãƒ‡ãƒãƒƒã‚°
(data
 |> clean
 |> ((fn/tap> (fn [x] (print f"After clean: {x}"))))
 |> analyze
 |> ((fn/tap> (fn [x] (print f"After analyze: {x}"))))
 |> save)

;; ãƒ­ã‚°
(requests
 |> ((fn/tap> log-request))
 |> process
 |> ((fn/tap> log-response)))

;; ç°¡æ½”ãªä½¿ã„æ–¹
([1 2 3]
 |> (map inc)
 |> ((fn/tap> print))
 |> sum)
```

**å®Ÿè£…**:
- é«˜éšé–¢æ•°ã¨ã—ã¦å®Ÿè£…
- `(fn/tap> f)`ã¯`(fn [x] (do (f x) x))`ã‚’è¿”ã™
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§`((fn/tap> f))`ã¨ã—ã¦ä½¿ç”¨

---

### ğŸ”œ `flow` ãƒã‚¯ãƒ­ - æ§‹é€ åŒ–ã•ã‚ŒãŸæµã‚Œï¼ˆè¿‘æœªæ¥ï¼‰

**åˆ†å²ãƒ»åˆæµã‚’å«ã‚€è¤‡é›‘ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**

```qi
;; åŸºæœ¬çš„ãªflow
(flow data
  |> parse
  |> transform
  |> save)

;; åˆ†å²
(flow data
  |> parse
  |> branch
       [valid?   |> process |> save]
       [invalid? |> log-error]
       [else     |> quarantine])

;; ã‚¿ãƒƒãƒ—ã¨ã®çµ„ã¿åˆã‚ã›
(flow request
  |> tap> log-request
  |> validate
  |> process
  |> tap> log-response
  |> format-result)

;; å†åˆ©ç”¨å¯èƒ½ãªå°ãƒ‘ã‚¤ãƒ—
(def normalize-text
  (flow |> trim |> lower |> (str/replace "\\s+" " ")))

(texts |> normalize-text |> unique)
```

---

### âœ… `~>` éåŒæœŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**ä¸¦è¡Œå‡¦ç†ã¨ã®çµ±åˆ - goroutineé¢¨ã®éåŒæœŸå®Ÿè¡Œ**

`~>` æ¼”ç®—å­ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’goroutineã§è‡ªå‹•å®Ÿè¡Œã—ã€çµæœã‚’ãƒãƒ£ãƒãƒ«ã§è¿”ã—ã¾ã™ã€‚

```qi
;; åŸºæœ¬çš„ãªéåŒæœŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
(def result (data ~> transform ~> process))  ; å³åº§ã«ãƒãƒ£ãƒãƒ«ã‚’è¿”ã™
(recv! result)  ; çµæœã‚’å—ä¿¡

;; è¤‡æ•°ã®éåŒæœŸå‡¦ç†
(def r1 (10 ~> inc ~> double))
(def r2 (20 ~> double ~> inc))
(println (recv! r1) (recv! r2))  ; ä¸¦è¡Œå®Ÿè¡Œ

;; goãƒ–ãƒ­ãƒƒã‚¯å†…ã§ã‚‚åˆ©ç”¨å¯èƒ½
(go
  (data ~> transform ~> (send! output-chan)))
```

---

### âœ… `stream` é…å»¶è©•ä¾¡ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**å·¨å¤§ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡çš„å‡¦ç† - é…å»¶è©•ä¾¡ã¨ç„¡é™ãƒ‡ãƒ¼ã‚¿æ§‹é€ **

Streamã¯å€¤ã‚’å¿…è¦ã«ãªã‚‹ã¾ã§è¨ˆç®—ã—ãªã„é…å»¶è©•ä¾¡ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ã€‚
ç„¡é™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚„å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ã«æ‰±ãˆã¾ã™ã€‚

#### Streamä½œæˆ

```qi
;; ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚¹ãƒˆãƒªãƒ¼ãƒ ä½œæˆ
(stream/stream [1 2 3 4 5])

;; ç¯„å›²ã‚¹ãƒˆãƒªãƒ¼ãƒ 
(stream/range 0 10)  ;; 0ã‹ã‚‰9ã¾ã§

;; ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼šåŒã˜å€¤ã‚’ç¹°ã‚Šè¿”ã—
(stream/repeat 42)  ;; 42, 42, 42, ...

;; ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼šãƒªã‚¹ãƒˆã‚’å¾ªç’°
(stream/cycle [1 2 3])  ;; 1, 2, 3, 1, 2, 3, ...

;; ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼šé–¢æ•°ã‚’åå¾©é©ç”¨
(stream/iterate (fn [x] (* x 2)) 1)  ;; 1, 2, 4, 8, 16, 32, ...
```

#### Streamå¤‰æ›

```qi
;; map: å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨
(def s (stream/range 1 6))
(def s2 (stream/map (fn [x] (* x 2)) s))
(stream/realize s2)  ;; (2 4 6 8 10)

;; filter: æ¡ä»¶ã«åˆã†è¦ç´ ã®ã¿
(def s (stream/range 1 11))
(def s2 (stream/filter (fn [x] (= (% x 2) 0)) s))
(stream/realize s2)  ;; (2 4 6 8 10)

;; take: æœ€åˆã®nå€‹ã‚’å–å¾—ï¼ˆç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’æœ‰é™åŒ–ï¼‰
(def s (stream/repeat 42))
(def s2 (stream/take 5 s))
(stream/realize s2)  ;; (42 42 42 42 42)

;; drop: æœ€åˆã®nå€‹ã‚’ã‚¹ã‚­ãƒƒãƒ—
(def s (stream/range 0 10))
(def s2 (stream/drop 5 s))
(stream/realize s2)  ;; (5 6 7 8 9)
```

#### Streamå®Ÿè¡Œ

```qi
;; realize: ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒªã‚¹ãƒˆã«å¤‰æ›ï¼ˆå…¨è¦ç´ ã‚’è¨ˆç®—ï¼‰
(stream/realize (stream/stream [1 2 3]))  ;; (1 2 3)

;; âš ï¸ æ³¨æ„: ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’realizeã™ã‚‹ã¨ç„¡é™ãƒ«ãƒ¼ãƒ—
;; (stream/realize (stream/repeat 42))  ;; NG: æ°¸é ã«çµ‚ã‚ã‚‰ãªã„

;; æ­£ã—ã„ä½¿ã„æ–¹: takeã§æœ‰é™åŒ–ã—ã¦ã‹ã‚‰realize
(stream/realize (stream/take 5 (stream/repeat 42)))  ;; OK
```

#### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ±åˆ

```qi
;; æ—¢å­˜ã® |> ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ã§ä½¿ãˆã‚‹
[1 2 3 4 5]
  |> stream/stream
  |> (stream/map (fn [x] (* x x)))
  |> (stream/filter (fn [x] (> x 10)))
  |> stream/realize
;; (16 25)

;; ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å‡¦ç†
1
  |> (stream/iterate (fn [x] (* x 2)))
  |> (stream/take 10)
  |> stream/realize
;; (1 2 4 8 16 32 64 128 256 512)

;; è¤‡é›‘ãªå¤‰æ›ãƒã‚§ãƒ¼ãƒ³
(stream/range 1 100)
  |> (stream/map (fn [x] (* x x)))
  |> (stream/filter (fn [x] (= (% x 3) 0)))
  |> (stream/take 5)
  |> stream/realize
;; (9 36 81 144 225)
```

#### å®Ÿç”¨ä¾‹

```qi
;; ç´ æ•°ã®ç„¡é™ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆæ¦‚å¿µï¼‰
(def primes
  (2
   |> (stream/iterate inc)
   |> (stream/filter prime?)))

(stream/realize (stream/take 10 primes))  ;; æœ€åˆã®10å€‹ã®ç´ æ•°

;; ãƒ•ã‚£ãƒœãƒŠãƒƒãƒæ•°åˆ—
(def fib-stream
  (stream/iterate     (fn [[a b]] [b (+ a b)])
    [0 1]))

(stream/realize   (stream/take 10 fib-stream)
  |> (map first))  ;; (0 1 1 2 3 5 8 13 21 34)

;; ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
(defn process-data [data]
  (data
   |> stream
   |> (stream/map parse)
   |> (stream/filter valid?)
   |> (stream/take 1000)
   |> stream/realize))
```

#### âœ… I/Oã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«ã¨HTTPãƒ‡ãƒ¼ã‚¿ã®é…å»¶èª­ã¿è¾¼ã¿ - ãƒ†ã‚­ã‚¹ãƒˆï¼†ãƒã‚¤ãƒŠãƒªå¯¾å¿œ**

##### ãƒ†ã‚­ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆè¡Œãƒ™ãƒ¼ã‚¹ï¼‰

```qi
;; stream/file: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡Œã”ã¨ã«é…å»¶èª­ã¿è¾¼ã¿ï¼ˆio.rsï¼‰
(stream/file "large.log")
  |> (stream/filter error-line?)
  |> (stream/map parse)
  |> (stream/take 100)
  |> stream/realize

;; http/get-stream: HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¡Œã”ã¨ã«èª­ã¿è¾¼ã¿ï¼ˆhttp.rsï¼‰
(http/get-stream "https://api.example.com/data")
  |> (stream/take 10)
  |> stream/realize

;; http/post-stream: POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å—ä¿¡
(http/post-stream "https://api.example.com/upload" {:data "value"})
  |> (stream/take 10)
  |> stream/realize

;; http/request-stream: è©³ç´°è¨­å®šã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
(http/request-stream {
  :method "GET"
  :url "https://api.example.com/stream"
})
  |> (stream/filter important?)
  |> stream/realize
```

##### ãƒã‚¤ãƒŠãƒªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒã‚¤ãƒˆãƒãƒ£ãƒ³ã‚¯ï¼‰

```qi
;; stream/file :bytes - ãƒ•ã‚¡ã‚¤ãƒ«ã‚’4KBãƒãƒ£ãƒ³ã‚¯ã§èª­ã¿è¾¼ã¿
(stream/file "image.png" :bytes)
  |> (stream/take 10)
  |> stream/realize
;; => Vector of Integers (bytes) ã®ãƒªã‚¹ãƒˆ

;; http/get-stream :bytes - HTTPãƒã‚¤ãƒŠãƒªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
(http/get-stream "https://example.com/file.bin" :bytes)
  |> (stream/map process-chunk)
  |> stream/realize

;; ãƒã‚¤ãƒˆå‡¦ç†ã®ä¾‹
(def bytes (first (stream/realize (stream/take 1 (stream/file "data.bin" :bytes)))))
(def sum (reduce + bytes))  ; ãƒã‚¤ãƒˆã®åˆè¨ˆ
(println sum)

;; ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
(http/get-stream "https://example.com/logo.png" :bytes)
  |> stream/realize
  |> flatten
  |> (write-bytes "logo.png")  ; write-bytes ã¯å°†æ¥å®Ÿè£…
```

**ãƒ¢ãƒ¼ãƒ‰æ¯”è¼ƒ**:

| ãƒ¢ãƒ¼ãƒ‰ | ç”¨é€” | æˆ»ã‚Šå€¤ | ä¾‹ |
|--------|------|--------|-----|
| ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | ãƒ­ã‚°ã€CSVã€JSON | Stringï¼ˆè¡Œã”ã¨ï¼‰ | `(stream/file "data.txt")` |
| ãƒã‚¤ãƒŠãƒªï¼ˆ`:bytes`ï¼‰ | ç”»åƒã€å‹•ç”»ã€ãƒã‚¤ãƒŠãƒª | Vector of Integersï¼ˆ4KBãƒãƒ£ãƒ³ã‚¯ï¼‰ | `(stream/file "image.png" :bytes)` |

;; CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†
(stream/file "data.csv")
  |> (stream/drop 1)  ; ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚­ãƒƒãƒ—
  |> (stream/map (fn [line] (split line ",")))
  |> (stream/filter (fn [cols] (> (len cols) 2)))
  |> (stream/take 1000)
  |> stream/realize

;; HTTPã‹ã‚‰JSONã‚’å–å¾—ã—ã¦ãƒ‘ãƒ¼ã‚¹
(http/get-stream "https://jsonplaceholder.typicode.com/todos/1")
  |> stream/realize
  |> (join "\n")
  |> json/parse  ; json ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå®Ÿè£…ã•ã‚ŒãŸã‚‰ä½¿ãˆã‚‹
```

**å®Ÿç”¨ä¾‹: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«è§£æ**

```qi
;; å¤§ããªãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ã«å‡¦ç†
(defn analyze-logs [file]
  (stream/file file
   |> (stream/filter (fn [line] (str/contains? line "ERROR")))
   |> (stream/map parse-log-line)
   |> (stream/take 100)  ; æœ€åˆã®100ã‚¨ãƒ©ãƒ¼
   |> stream/realize))

;; çµæœã‚’å–å¾—
(def errors (analyze-logs "/var/log/app.log"))
(println (str "Found " (len errors) " errors"))
```

---

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ–‡åŒ–

**Unixå“²å­¦ Ã— é–¢æ•°å‹ Ã— Lisp**

```qi
;; å°ã•ãªãƒ‘ã‚¤ãƒ—ã‚’å®šç¾©
(def clean-text
  (flow |> trim |> lower |> remove-punctuation))

(def extract-emails
  (flow |> (split "\\s+") |> (filter email?)))

(def dedupe
  (flow |> sort |> unique))

;; çµ„ã¿åˆã‚ã›ã¦ä½¿ã†
(document
 |> clean-text
 |> extract-emails
 |> dedupe
 |> (join ", "))
```

---

## 3. ç‰¹æ®Šå½¢å¼ï¼ˆ9ã¤ï¼‰âœ…

### âœ… `def` - ã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©
```qi
(def x 42)
(def greet (fn [name] (str "Hello, " name)))
(def ops [+ - * /])
```

### âœ… `defn` - é–¢æ•°å®šç¾©ï¼ˆç³–è¡£æ§‹æ–‡ï¼‰
```qi
;; åŸºæœ¬å½¢å¼
(defn greet [name]
  (str "Hello, " name))

;; å¯å¤‰é•·å¼•æ•°
(defn sum [& nums]
  (reduce + 0 nums))

;; ãƒ™ã‚¯ã‚¿ã®åˆ†è§£ï¼ˆDestructuringï¼‰
(defn add-pair [[x y]]
  (+ x y))

(defn format-kv [[k v]]
  f"{k}={v}")

;; ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä»˜ãï¼ˆå°†æ¥ã‚µãƒãƒ¼ãƒˆäºˆå®šï¼‰
(defn greet "æŒ¨æ‹¶ã™ã‚‹" [name]
  (str "Hello, " name))

;; defnã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å±•é–‹ã•ã‚Œã‚‹
(defn greet [name] body)
;; â†“
(def greet (fn [name] body))
```

**Note**: `defn`ã¯`def + fn`ã®ç³–è¡£æ§‹æ–‡ã§ã™ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ–‡å­—åˆ—/ãƒãƒƒãƒ—ã¯èªè­˜ã•ã‚Œã¾ã™ãŒã€ç¾åœ¨ã¯ç„¡è¦–ã•ã‚Œã¾ã™ï¼ˆå°†æ¥ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã§æ´»ç”¨äºˆå®šï¼‰ã€‚

### âœ… `fn` - é–¢æ•°å®šç¾©
```qi
(fn [x] (* x 2))
(fn [x y] (+ x y))
(fn [] (println "no args"))

;; å¯å¤‰é•·å¼•æ•°
(fn [& args] (reduce + 0 args))

;; ãƒ™ã‚¯ã‚¿ã®åˆ†è§£ï¼ˆDestructuringï¼‰
(fn [[x y]] (+ x y))  ;; 2è¦ç´ ã®ãƒ™ã‚¯ã‚¿ã‚’å—ã‘å–ã‚‹
(fn [[k v]] f"{k}={v}")  ;; ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢

;; ãƒã‚¹ãƒˆã—ãŸåˆ†è§£
(fn [[[a b] c]] (+ a b c))  ;; [[1 2] 3] => 6
```

### âœ… `let` - ãƒ­ãƒ¼ã‚«ãƒ«æŸç¸›
```qi
(let [x 10 y 20]
  (+ x y))

;; ãƒã‚¹ãƒˆå¯èƒ½
(let [a 1]
  (let [b 2]
    (+ a b)))

;; ãƒ™ã‚¯ã‚¿ã®åˆ†è§£ï¼ˆDestructuringï¼‰
(let [[x y] [10 20]]
  (+ x y))  ;; => 30

(let [[k v] ["name" "Alice"]]
  f"{k}={v}")  ;; => "name=Alice"

;; ãƒã‚¹ãƒˆã—ãŸåˆ†è§£
(let [[[a b] c] [[1 2] 3]]
  (+ a b c))  ;; => 6

;; ã‚·ãƒ³ãƒ—ãƒ«ãªæŸç¸›ã¨åˆ†è§£ã®æ··åœ¨
(let [x 10
      [y z] [20 30]]
  (+ x y z))  ;; => 60
```

### âœ… `do` - é †æ¬¡å®Ÿè¡Œ
```qi
(do
  (println "first")
  (println "second")
  42)  ;; æœ€å¾Œã®å¼ã®å€¤ã‚’è¿”ã™
```

### âœ… `if` - æ¡ä»¶åˆ†å²
```qi
;; åŸºæœ¬å½¢
(if test then else)

;; å®Ÿç”¨ä¾‹
(if (> x 10) "big" "small")

;; elseçœç•¥å¯èƒ½ï¼ˆçœç•¥æ™‚ã¯nilï¼‰
(if (valid? data)
  (process data))

;; ãƒã‚¹ãƒˆ
(if (> x 0)
    (if (< x 10) "small positive" "big positive")
    "negative or zero")
```

### âœ… `match` - ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼ˆFlow-Orientedï¼‰

Qiã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã¯**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’åˆ†å²ã•ã›ã‚‹åˆ¶å¾¡æ§‹é€ **ã§ã™ã€‚å˜ãªã‚‹æ¡ä»¶åˆ†å²ã§ã¯ãªãã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’åˆ†è§£ãƒ»å¤‰æ›ãƒ»æ¤œè¨¼ã—ãªãŒã‚‰å‡¦ç†ã‚’æŒ¯ã‚Šåˆ†ã‘ã¾ã™ã€‚

#### âœ… åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; å€¤ã®ãƒãƒƒãƒ
(match x
  0 -> "zero"
  1 -> "one"
  n -> (str "other: " n))

;; nil/boolã®åŒºåˆ¥
(match result
  nil -> "not found"
  false -> "explicitly false"
  true -> "success"
  v -> (str "value: " v))

;; ãƒãƒƒãƒ—ã®ãƒãƒƒãƒ
(match data
  {:type "user" :name n} -> (greet n)
  {:type "admin"} -> "admin"
  _ -> "unknown")

;; ãƒªã‚¹ãƒˆã®ãƒãƒƒãƒ
(match lst
  [] -> "empty"
  [x] -> x
  [x ...rest] -> (str "first: " x))

;; ã‚¬ãƒ¼ãƒ‰æ¡ä»¶
(match x
  n when (> n 0) -> "positive"
  n when (< n 0) -> "negative"
  _ -> "zero")
```

#### âœ… æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå®Ÿè£…æ¸ˆã¿ - Flowå¼·åŒ–ï¼‰

**1. `:as` æŸç¸› - éƒ¨åˆ†ã¨å…¨ä½“ã®ä¸¡æ–¹ã‚’ä½¿ã†** âœ…
```qi
;; ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã—ãŸå…¨ä½“ã‚’å¤‰æ•°ã«æŸç¸›
(match data
  {:user {:name n :age a} :as u} -> (do
    (log u)           ;; å…¨ä½“ã‚’ãƒ­ã‚°
    (process n a)))   ;; éƒ¨åˆ†ã‚’å‡¦ç†

;; ãƒã‚¹ãƒˆã—ãŸæ§‹é€ ã§ã‚‚ä½¿ãˆã‚‹
(match response
  {:body {:user u :posts ps} :as body} -> (cache body)
  {:error e :as err} -> (log err))
```

#### ğŸš§ å°†æ¥ã®æ‹¡å¼µãƒ‘ã‚¿ãƒ¼ãƒ³

**2. `=> å¤‰æ›` - ãƒãƒƒãƒæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã™** ğŸš§
```qi
;; æŸç¸›ã¨åŒæ™‚ã«å¤‰æ›é–¢æ•°ã‚’é©ç”¨ï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çš„ï¼‰
(match data
  {:price p => parse-float} -> (calc-tax p)
  {:name n => lower} -> (log n)
  {:created-at t => parse-date} -> (format t))

;; è¤‡æ•°ã®å¤‰æ›ã‚’ã¤ãªã’ã‚‹
(match input
  {:raw r => trim => lower => (split " ")} -> (process-words r))

;; å®Ÿç”¨ä¾‹: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
(match (http-get "/api/user")
  {:body b => parse-json} -> (extract-user b)
  {:status s => str} when (= s "404") -> nil
  _ -> (error "unexpected response"))
```

**3. `or` ãƒ‘ã‚¿ãƒ¼ãƒ³ - è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŒã˜å‡¦ç†** ğŸš§
```qi
;; è¤‡æ•°ã®å€¤ã«ãƒãƒƒãƒ
(match status
  (200 or 201 or 204) -> "success"
  (400 or 401 or 403) -> "client error"
  (500 or 502 or 503) -> "server error"
  _ -> "unknown")

;; è¤‡æ•°ã®æ§‹é€ ã«ãƒãƒƒãƒ
(match event
  ({:type "click"} or {:type "tap"}) -> (handle-interaction)
  ({:type "scroll"} or {:type "drag"}) -> (handle-movement))
```

**4. ãƒã‚¹ãƒˆ + ã‚¬ãƒ¼ãƒ‰ - æ§‹é€ çš„ãªæ¡ä»¶åˆ†å²**
```qi
;; æ·±ã„ãƒã‚¹ãƒˆã§ã‚‚èª­ã¿ã‚„ã™ã„
(match request
  {:user {:age a :country c}} when (and (>= a 18) (= c "JP")) -> (allow)
  {:user {:age a}} when (< a 18) -> (error "age restriction")
  _ -> (deny))

;; Flowçš„ãªèª­ã¿æ–¹: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’åˆ†è§£ â†’ ã‚¬ãƒ¼ãƒ‰ã§æ¤œè¨¼ â†’ å‡¦ç†
```

**5. ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ `_` - é–¢å¿ƒã®ã‚ã‚‹éƒ¨åˆ†ã ã‘æŠ½å‡º**
```qi
;; ä¸€éƒ¨ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘ä½¿ã†
(match data
  {:user {:name _ :age a :city c}} -> (process-location a c)
  {:error _} -> "error occurred")

;; ãƒªã‚¹ãƒˆã®ä¸€éƒ¨ã‚’ã‚¹ã‚­ãƒƒãƒ—
(match coords
  [_ y _] -> y  ;; yåº§æ¨™ã ã‘å–ã‚Šå‡ºã™
  _ -> 0)
```

**6. é…åˆ—ã®è¤‡æ•°æŸç¸›**
```qi
;; è¤‡æ•°è¦ç´ ã‚’åŒæ™‚ã«æŸç¸›
(match data
  [{:id id1} {:id id2}] -> (compare id1 id2)
  [first ...rest] -> (process-batch first rest))

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨çµ„ã¿åˆã‚ã›
(match (coords |> (take 2))
  [x y] -> (distance x y)
  _ -> 0)
```

#### ğŸš§ å°†æ¥æ¤œè¨

**`and` æ¡ä»¶** - è¤‡é›‘ãªè«–ç†å¼ï¼ˆå¿…è¦æ€§ã‚’è¦‹æ¥µã‚ä¸­ï¼‰
```qi
(match x
  (> 0 and < 100) -> "in range"
  _ -> "out of range")
```

#### matchã®è¨­è¨ˆå“²å­¦

1. **ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’åˆ†å²ã•ã›ã‚‹**: matchã¯å˜ãªã‚‹if-elseã§ã¯ãªãã€ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’åˆ†è§£ã—ã¦æµã‚Œã‚’ä½œã‚‹
2. **å¤‰æ›ã‚’åŸ‹ã‚è¾¼ã‚€**: `=> å¤‰æ›` ã§matchå†…éƒ¨ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿç¾
3. **èª­ã¿ã‚„ã™ã•å„ªå…ˆ**: ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä¸Šã‹ã‚‰ä¸‹ã«èª­ã‚ã‚‹ã€æ¡ä»¶ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹
4. **æ®µéšçš„é–‹ç¤º**: åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å§‹ã‚ã¦ã€å¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ã†

### âœ… `try` - ã‚¨ãƒ©ãƒ¼å‡¦ç†
```qi
;; {:ok result} ã¾ãŸã¯ {:error e} ã‚’è¿”ã™
(match (try (risky-operation))
  {:ok result} -> result
  {:error e} -> (log e))

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨çµ„ã¿åˆã‚ã›
(match (try
         (url
          |> http-get
          |> parse
          |> process))
  {:ok data} -> data
  {:error e} -> [])
```

### âœ… `defer` - é…å»¶å®Ÿè¡Œ
```qi
;; ã‚¹ã‚³ãƒ¼ãƒ—çµ‚äº†æ™‚ã«å®Ÿè¡Œ
(defn process-file [path]
  (let [f (open path)]
    (do
      (defer (close f))  ;; é–¢æ•°çµ‚äº†æ™‚ã«å¿…ãšå®Ÿè¡Œ
      (read f))))

;; è¤‡æ•°ã®deferï¼ˆLIFO: å¾Œå…¥ã‚Œå…ˆå‡ºã—ï¼‰
(do
  (defer (log "3"))
  (defer (log "2"))
  (defer (log "1"))
  (work))
;; å®Ÿè¡Œé †: work â†’ "1" â†’ "2" â†’ "3"

;; ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹
(defn safe-process []
  (do
    (defer (cleanup))
    (try (risky-op))))
```

## 4. æ¼”ç®—å­

### âœ… `|>` - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```qi
;; å·¦ã‹ã‚‰å³ã¸ãƒ‡ãƒ¼ã‚¿ã‚’æµã™
(x |> f |> g |> h)
;; (h (g (f x))) ã¨åŒã˜

;; å®Ÿç”¨ä¾‹
(data
 |> parse-json
 |> (filter valid?)
 |> (map transform)
 |> (reduce merge {}))

;; é–¢æ•°ã«è¤‡æ•°å¼•æ•°ã‚’æ¸¡ã™
(10 |> (+ 5))  ;; (+ 10 5) = 15

;; èª­ã¿ã‚„ã™ã„ãƒ‡ãƒ¼ã‚¿å‡¦ç†
(users
 |> (filter active?)
 |> (map :email)
 |> (take 10)
 |> (join ", "))
```

## 5. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### ãƒªã‚¹ãƒˆ
```qi
'(1 2 3)
'()  ;; ç©ºãƒªã‚¹ãƒˆ
(first '(1 2 3))  ;; 1
(rest '(1 2 3))   ;; (2 3)
```

### ãƒãƒƒãƒ—
```qi
{:name "Alice" :age 30}
{}  ;; ç©ºãƒãƒƒãƒ—

;; âœ… ãƒãƒƒãƒ—ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
(get {:a 1} :a)           ;; 1
(:name {:name "Alice"})   ;; "Alice" (ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯é–¢æ•°ã¨ã—ã¦ä½¿ãˆã‚‹)
(:age {:name "Bob" :age 30})  ;; 30

;; ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
(:notexist {:name "Alice"})  ;; ã‚¨ãƒ©ãƒ¼: ã‚­ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
```

### ãƒ™ã‚¯ã‚¿
```qi
[1 2 3]
(nth [10 20 30] 1)  ;; 20
```

### é–¢æ•°
```qi
;; é–¢æ•°ã‚‚ãƒ‡ãƒ¼ã‚¿
(def ops [+ - * /])
((nth ops 0) 1 2)  ;; 3

;; é–¢æ•°ã®ãƒãƒƒãƒ—
(def handlers {:get handle-get :post handle-post})
((get handlers :get) request)
```

## 6. ã‚³ã‚¢é–¢æ•°

Qiã®çµ„ã¿è¾¼ã¿é–¢æ•°ã¯**Flow-oriented**å“²å­¦ã«åŸºã¥ãã€ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã¨å¤‰æ›ã‚’é‡è¦–ã—ãŸè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ã€‚

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ

Qiã¯**2å±¤ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼š

**Core** - ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã€è‡ªå‹•ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- ç‰¹æ®Šå½¢å¼ãƒ»æ¼”ç®—å­: `def`, `fn`, `let`, `do`, `if`, `match`, `try`, `defer`, `|>`, `||>`, `|>?`, `~>`
- ãƒªã‚¹ãƒˆæ“ä½œ: `first`, `rest`, `last`, `nth`, `len`, `count`, `take`, `drop`, `cons`, `conj`, `concat`, `flatten`, `range`, `reverse`, `sort`, `distinct`, `zip`, `map`, `filter`, `reduce`, `pmap`, `tap`, `find`, `every?`, `some?`, `take-while`, `drop-while`
- é«˜éšé–¢æ•°: `identity`, `comp`, `partial`, `apply`, `constantly`, `branch`
- ãƒãƒƒãƒ—æ“ä½œ: `get`, `keys`, `vals`, `assoc`, `dissoc`, `merge`, `get-in`, `update-in`, `update`
- æ•°å€¤ãƒ»æ¯”è¼ƒ: `+`, `-`, `*`, `/`, `%`, `inc`, `dec`, `abs`, `min`, `max`, `sum`, `=`, `!=`, `<`, `>`, `<=`, `>=`
- æ–‡å­—åˆ—: `str`, `split`, `join`
- è¿°èªãƒ»å‹åˆ¤å®š: `nil?`, `list?`, `vector?`, `map?`, `string?`, `integer?`, `float?`, `number?`, `keyword?`, `function?`, `atom?`, `coll?`, `sequential?`, `empty?`, `some?`, `true?`, `false?`, `even?`, `odd?`, `positive?`, `negative?`, `zero?`
- ä¸¦è¡Œå‡¦ç†: `go`, `chan`, `send!`, `recv!`, `close!`
- è«–ç†ãƒ»I/O: `not`, `print`, `println`, `error` (â€» `and`, `or`ã¯ç‰¹æ®Šå½¢å¼)
- çŠ¶æ…‹ç®¡ç†: `atom`, `deref`, `swap!`, `reset!`
- ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°: `eval`, `uvar`, `variable`, `macro?`
- å‹å¤‰æ›: `to-int`, `to-float`, `to-string`
- æ—¥æ™‚: `now`, `timestamp`, `sleep`
- ãƒ‡ãƒãƒƒã‚°: `time`, `inspect`
- ãã®ä»–: `map-lines`

**å°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«** - æ˜ç¤ºçš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¾ãŸã¯ `module/function` å½¢å¼ã§ä½¿ç”¨
- **list**: é«˜åº¦ãªãƒªã‚¹ãƒˆæ“ä½œ- `list/frequencies`, `list/sort-by`, `list/group-by`, etc.
- **map**: é«˜åº¦ãªãƒãƒƒãƒ—æ“ä½œ- `map/select-keys`, `map/update-keys`, etc.
- **fn**: é«˜éšé–¢æ•°- `fn/complement`, `fn/juxt`, `fn/tap>`
- **set**: é›†åˆæ¼”ç®—- `set/union`, `set/intersect`, `set/difference`, etc.
- **math**: æ•°å­¦é–¢æ•°- `math/pow`, `math/sqrt`, `math/round`, etc.
- **io**: ãƒ•ã‚¡ã‚¤ãƒ«I/O- `io/read-file`, `io/write-file`, `io/list-dir`, `io/temp-file`, etc.
- **path**: ãƒ‘ã‚¹æ“ä½œ- `path/join`, `path/basename`, `path/dirname`, etc.
- **env**: ç’°å¢ƒå¤‰æ•°- `env/get`, `env/set`, `env/load-dotenv`, etc.
- **log**: æ§‹é€ åŒ–ãƒ­ã‚°- `log/info`, `log/warn`, `log/error`, `log/set-level`, etc.
- **async**: ä¸¦è¡Œå‡¦ç†ï¼ˆé«˜åº¦ï¼‰- `async/await`, `async/then`, `async/pfilter`, etc.
- **pipeline**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†- `pipeline/pipeline`, `pipeline/map`, etc.
- **stream**: ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†- `stream/stream`, `stream/map`, etc.
- **str**: æ–‡å­—åˆ—æ“ä½œ- `str/upper`, `str/lower`, `str/snake`, etc.
- **json**: JSONå‡¦ç†- `json/parse`, `json/stringify`, `json/pretty`
- **yaml**: YAMLå‡¦ç†- `yaml/parse`, `yaml/stringify`, `yaml/pretty`
- **http**: HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ- `http/get`, `http/post`, `http/get-stream`, etc.
- **server**: HTTPã‚µãƒ¼ãƒãƒ¼- `server/serve`, `server/router`, `server/ok`, `server/json`, ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ãªã©
- **csv**: CSVå‡¦ç†- `csv/parse`, `csv/stringify`, `csv/read-file`, etc.
- **zip**: ZIPåœ§ç¸®ãƒ»è§£å‡- `zip/create`, `zip/extract`, `zip/list`, `zip/gzip`, etc.
- **args**: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ãƒ‘ãƒ¼ã‚¹- `args/all`, `args/get`, `args/parse`, `args/count`
- **db**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹- `db/connect`, `db/query`, `db/exec`, `db/begin`, `db/commit`, etc.

**ä½¿ç”¨ä¾‹**:
```qi
;; Coreé–¢æ•°ã¯ãã®ã¾ã¾ä½¿ãˆã‚‹
(data |> filter valid? |> map transform |> sort)

;; å°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–¢æ•°ã¯ module/function å½¢å¼
(io/read-file "data.txt")
(math/pow 2 8)
(list/frequencies [1 2 2 3])

;; useã§çŸ­ç¸®å¯èƒ½
(use io :only [read-file])
(io/read-file "data.txt")
```

### ãƒªã‚¹ãƒˆæ“ä½œ

#### åŸºæœ¬æ“ä½œï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ã‚¢ã‚¯ã‚»ã‚¹ ===

;; first - æœ€åˆã®è¦ç´ ã‚’è¿”ã™
(first [10 20 30])              ;; => 10

;; rest - æœ€åˆä»¥å¤–ã®è¦ç´ ã‚’è¿”ã™
(rest [10 20 30])               ;; => (20 30)

;; last - æœ€å¾Œã®è¦ç´ ã‚’è¿”ã™
(last [10 20 30])               ;; => 30

;; nth - nç•ªç›®ã®è¦ç´ ã‚’å–å¾—ï¼ˆ0ã‹ã‚‰é–‹å§‹ï¼‰
(nth 1 [10 20 30])              ;; => 20

;; take - æœ€åˆã®nå€‹ã‚’å–å¾—
(take 2 [10 20 30 40])          ;; => (10 20)

;; drop - æœ€åˆã®nå€‹ã‚’ã‚¹ã‚­ãƒƒãƒ—
(drop 2 [10 20 30 40])          ;; => (30 40)

;; === ã‚µã‚¤ã‚ºãƒ»çŠ¶æ…‹ ===

;; len - è¦ç´ æ•°ã‚’è¿”ã™
(len [10 20 30])                ;; => 3

;; count - è¦ç´ æ•°ã‚’è¿”ã™ï¼ˆlenã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰
(count [10 20 30])              ;; => 3

;; empty? - ç©ºã‹ã©ã†ã‹ã‚’åˆ¤å®š
(empty? [])                     ;; => true
(empty? [1])                    ;; => false

;; === è¿½åŠ ãƒ»çµåˆ ===

;; cons - å…ˆé ­ã«è¦ç´ ã‚’è¿½åŠ 
(cons 0 [10 20 30])             ;; => (0 10 20 30)

;; conj - æœ«å°¾ã«è¦ç´ ã‚’è¿½åŠ 
(conj [10 20 30] 40)            ;; => (10 20 30 40)

;; concat - ãƒªã‚¹ãƒˆã‚’é€£çµ
(concat [10 20] [30 40])        ;; => (10 20 30 40)

;; flatten - ãƒã‚¹ãƒˆã‚’å¹³å¦åŒ–
(flatten [[1 2] [3 [4 5]]])     ;; => (1 2 3 4 5)

;; === ç”Ÿæˆãƒ»å¤‰æ› ===

;; range - æ•°å€¤ã®ç¯„å›²ã‚’ç”Ÿæˆ
(range 5)                       ;; => (0 1 2 3 4)
(range 2 5)                     ;; => (2 3 4)

;; reverse - é †åºã‚’åè»¢
(reverse [10 20 30])            ;; => (30 20 10)
```

#### é«˜éšé–¢æ•°ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === åŸºæœ¬é«˜éšé–¢æ•° ===

;; map - å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨
(map inc [1 2 3])                ;; => (2 3 4)
(map str [1 2 3])                ;; => ("1" "2" "3")

;; filter - æ¡ä»¶ã‚’æº€ãŸã™è¦ç´ ã®ã¿æŠ½å‡º
(filter even? [1 2 3 4 5])       ;; => (2 4)
(filter (fn [x] (> x 10)) [5 15 3 20])  ;; => (15 20)

;; reduce - ç•³ã¿è¾¼ã¿ï¼ˆç´¯ç©è¨ˆç®—ï¼‰
(reduce + 0 [1 2 3 4])           ;; => 10
(reduce * 1 [2 3 4])             ;; => 24

;; pmap - ä¸¦åˆ—map
(pmap (fn [x] (* x 2)) [1 2 3])  ;; => (2 4 6)

;; tap - å‰¯ä½œç”¨ã‚¿ãƒƒãƒ—ï¼ˆå€¤ã‚’è¿”ã—ã¤ã¤å‰¯ä½œç”¨å®Ÿè¡Œï¼‰
(tap println [1 2 3])            ;; [1 2 3]ã‚’å‡ºåŠ›ã—ã¦ã€ãã®ã¾ã¾è¿”ã™
```

**ä½¿ç”¨ä¾‹: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ãƒ‡ãƒãƒƒã‚°**

```qi
;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’è¦³å¯Ÿ
([1 2 3]
 |> (map inc)
 |> (tap println)       ;; (2 3 4)ã‚’å‡ºåŠ›ã—ã¦ã€ãã®ã¾ã¾æ¬¡ã«æ¸¡ã™
 |> sum)                ;; => 9

;; ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®è¦³å¯Ÿ
(def data {:name "Alice" :age 30})
(data
 |> (tap inspect)       ;; ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢è¡¨ç¤ºã—ã¦æ¬¡ã«æ¸¡ã™
 |> keys)               ;; => ("name" "age")
```

#### ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ¤œç´¢ãƒ»è¿°èªï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === æ¤œç´¢ ===

;; find - æ¡ä»¶ã‚’æº€ãŸã™æœ€åˆã®è¦ç´ ã‚’è¿”ã™
(find (fn [x] (> x 5)) [1 7 3])     ;; => 7
(find even? [1 3 4 5])              ;; => 4

;; list/find-index - æ¡ä»¶ã‚’æº€ãŸã™æœ€åˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿”ã™
(list/find-index (fn [x] (> x 5)) [1 7 3])  ;; => 1
(list/find-index even? [1 3 4 5])           ;; => 2

;; === è¿°èªï¼ˆå…¨ä½“ãƒã‚§ãƒƒã‚¯ï¼‰ ===

;; every? - å…¨è¦ç´ ãŒæ¡ä»¶ã‚’æº€ãŸã™ã‹
(every? (fn [x] (> x 0)) [1 2 3])   ;; => true
(every? even? [2 4 6])              ;; => true
(every? even? [2 3 4])              ;; => false

;; some? - ã„ãšã‚Œã‹ã®è¦ç´ ãŒæ¡ä»¶ã‚’æº€ãŸã™ã‹
(some? (fn [x] (> x 5)) [1 7 3])    ;; => true
(some? even? [1 3 5])               ;; => false
```

**ä½¿ç”¨ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢**

```qi
(def users [{:name "Alice" :age 30} {:name "Bob" :age 25}])

;; ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’åå‰ã§æ¢ã™
(find (fn [u] (= (get u :name) "Bob")) users)
;; => {:name "Bob" :age 25}

;; å…¨å“¡æˆäººã‹ç¢ºèª
(every? (fn [u] (>= (get u :age) 20)) users)
;; => true

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§æ¤œç´¢
(users
 |> (filter (fn [u] (>= (get u :age) 25)))
 |> (map (fn [u] (get u :name))))
;; => ("Alice" "Bob")
```

#### ã‚½ãƒ¼ãƒˆãƒ»é›†ç´„ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ã‚½ãƒ¼ãƒˆ ===

;; sort - æ˜‡é †ã‚½ãƒ¼ãƒˆï¼ˆæ•´æ•°ãƒ»æµ®å‹•å°æ•°ç‚¹ãƒ»æ–‡å­—åˆ—å¯¾å¿œï¼‰
(sort [3 1 4 1 5])                  ;; => (1 1 3 4 5)
(sort ["zebra" "apple" "banana"])   ;; => ("apple" "banana" "zebra")

;; list/sort-by - ã‚­ãƒ¼æŒ‡å®šã‚½ãƒ¼ãƒˆ
(list/sort-by (fn [u] (get u :age)) [{:name "Bob" :age 25} {:name "Alice" :age 30}])
;; => ({:name "Bob" :age 25} {:name "Alice" :age 30})

;; distinct - é‡è¤‡ã‚’æ’é™¤
(distinct [1 2 2 3 3 3])            ;; => (1 2 3)

;; === ã‚°ãƒ«ãƒ¼ãƒ—åŒ– ===

;; list/group-by - ã‚­ãƒ¼é–¢æ•°ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
(list/group-by even? [1 2 3 4 5 6])
;; => {true [2 4 6], false [1 3 5]}

;; list/partition - è¿°èªã§2åˆ†å‰²
(list/partition even? [1 2 3 4])    ;; => [[2 4] [1 3]]

;; === é »åº¦ãƒ»ã‚«ã‚¦ãƒ³ãƒˆ ===

;; list/frequencies - å‡ºç¾é »åº¦ã‚’é›†è¨ˆ
(list/frequencies [1 2 2 3 3 3])    ;; => {1 1, 2 2, 3 3}

;; list/count-by - è¿°èªã§ã‚«ã‚¦ãƒ³ãƒˆ
(list/count-by even? [1 2 3 4])     ;; => {true 2, false 2}
```

**ä½¿ç”¨ä¾‹: ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**

```qi
;; é‡è¤‡æ’é™¤ã—ã¦ã‚½ãƒ¼ãƒˆ
([5 2 8 2 9 1 3 8 4]
 |> distinct
 |> sort)
;; => (1 2 3 4 5 8 9)

;; ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦é›†è¨ˆ
(list/group-by (fn [n] (% n 3)) [1 2 3 4 5 6 7 8 9])
;; => {0 (3 6 9), 1 (1 4 7), 2 (2 5 8)}
```

#### é›†ç´„ãƒ»åˆ†æï¼ˆâœ… å…¨ã¦å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ã‚­ãƒ¼æŒ‡å®šæ“ä½œ ===

;; list/max-by - ã‚­ãƒ¼é–¢æ•°ã§æœ€å¤§å€¤ã‚’å–å¾—
(list/max-by (fn [u] (get u :age)) [{:name "Alice" :age 30} {:name "Bob" :age 25}])
;; => {:name "Alice" :age 30}

;; list/min-by - ã‚­ãƒ¼é–¢æ•°ã§æœ€å°å€¤ã‚’å–å¾—
(list/min-by (fn [u] (get u :age)) [{:name "Alice" :age 30} {:name "Bob" :age 25}])
;; => {:name "Bob" :age 25}

;; list/sum-by - ã‚­ãƒ¼é–¢æ•°ã§åˆè¨ˆ
(list/sum-by (fn [item] (get item :price)) [{:price 100} {:price 200} {:price 300}])
;; => 600
```

#### é›†åˆæ¼”ç®—ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ set/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; set/union - å’Œé›†åˆ
(set/union [1 2] [2 3])             ;; => [1 2 3]

;; set/intersect - ç©é›†åˆ
(set/intersect [1 2 3] [2 3 4])     ;; => [2 3]

;; set/difference - å·®é›†åˆ
(set/difference [1 2 3] [2])        ;; => [1 3]

;; set/symmetric-difference - å¯¾ç§°å·®
(set/symmetric-difference [1 2 3] [2 3 4])  ;; => [1 4]

;; set/subset? - éƒ¨åˆ†é›†åˆåˆ¤å®š
(set/subset? [1 2] [1 2 3])         ;; => true

;; set/superset? - ä¸Šä½é›†åˆåˆ¤å®š
(set/superset? [1 2 3] [1 2])       ;; => true

;; set/disjoint? - äº’ã„ã«ç´ åˆ¤å®š
(set/disjoint? [1 2] [3 4])         ;; => true
```

#### ãƒãƒ£ãƒ³ã‚¯ãƒ»åˆ†å‰²ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ãƒãƒ£ãƒ³ã‚¯ ===

;; list/chunk - å›ºå®šã‚µã‚¤ã‚ºã§åˆ†å‰²
(list/chunk 3 [1 2 3 4 5])          ;; => ([1 2 3] [4 5])
(list/chunk 2 [1 2 3 4 5 6])        ;; => ([1 2] [3 4] [5 6])

;; === æ¡ä»¶ä»˜ãå–å¾— ===

;; take-while - è¿°èªãŒçœŸã®é–“å–å¾—
(take-while (fn [x] (< x 5)) [1 2 3 6 7 4])    ;; => (1 2 3)

;; drop-while - è¿°èªãŒçœŸã®é–“å‰Šé™¤
(drop-while (fn [x] (< x 5)) [1 2 3 6 7 4])    ;; => (6 7 4)
```

### æ•°å€¤ãƒ»æ¯”è¼ƒ

#### ç®—è¡“æ¼”ç®—ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === åŸºæœ¬æ¼”ç®— ===

;; + - åŠ ç®—ãƒ»æ¸›ç®—
(+ 1 2 3)                           ;; => 6
(- 10 3)                            ;; => 7

;; * / - ä¹—ç®—ãƒ»é™¤ç®—
(* 2 3 4)                           ;; => 24
(/ 10 2)                            ;; => 5

;; % - å‰°ä½™
(% 10 3)                            ;; => 1

;; inc dec - ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ/ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
(inc 5)                             ;; => 6
(dec 5)                             ;; => 4

;; === é›†ç´„ ===

;; sum - åˆè¨ˆ
(sum [1 2 3 4 5])                   ;; => 15

;; min max - æœ€å°/æœ€å¤§
(min 3 1 4 1 5)                     ;; => 1
(max 3 1 4 1 5)                     ;; => 5

;; abs - çµ¶å¯¾å€¤
(abs -5)                            ;; => 5
```

#### æ¯”è¼ƒï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === æ¯”è¼ƒæ¼”ç®—å­ ===

;; = - ç­‰ã—ã„
(= 1 1)                             ;; => true
(= 1 2)                             ;; => false

;; != - ç­‰ã—ããªã„
(!= 1 2)                            ;; => true

;; < > <= >= - å¤§å°æ¯”è¼ƒ
(< 1 2)                             ;; => true
(> 3 2)                             ;; => true
(<= 2 2)                            ;; => true
(>= 3 2)                            ;; => true
```

#### æ•°å­¦é–¢æ•°ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ math/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === ã¹ãä¹—ãƒ»å¹³æ–¹æ ¹ ===

;; math/pow - ã¹ãä¹—
(math/pow 2 8)                      ;; => 256
(math/pow 10 3)                     ;; => 1000

;; math/sqrt - å¹³æ–¹æ ¹
(math/sqrt 16)                      ;; => 4
(math/sqrt 2)                       ;; => 1.414...

;; === ä¸¸ã‚ ===

;; math/round - å››æ¨äº”å…¥
(math/round 3.7)                    ;; => 4
(math/round 3.2)                    ;; => 3

;; math/floor - åˆ‡ã‚Šæ¨ã¦
(math/floor 3.9)                    ;; => 3

;; math/ceil - åˆ‡ã‚Šä¸Šã’
(math/ceil 3.1)                     ;; => 4

;; === ç¯„å›²åˆ¶é™ ===

;; math/clamp - å€¤ã‚’ç¯„å›²å†…ã«åˆ¶é™
(math/clamp 1 10 15)                ;; => 10
(math/clamp 1 10 5)                 ;; => 5

;; === ä¹±æ•° ===

;; math/rand - 0.0ä»¥ä¸Š1.0æœªæº€ã®ä¹±æ•°
(math/rand)                         ;; => 0.742... (ãƒ©ãƒ³ãƒ€ãƒ )

;; math/rand-int - 0ä»¥ä¸Šnæœªæº€ã®æ•´æ•°ä¹±æ•°
(math/rand-int 10)                  ;; => 7 (0-9ã®ãƒ©ãƒ³ãƒ€ãƒ )
```

#### çµ±è¨ˆï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ stats/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; stats/mean - å¹³å‡å€¤
(stats/mean [1 2 3 4 5])            ;; => 3

;; stats/median - ä¸­å¤®å€¤
(stats/median [1 2 3 4 5])          ;; => 3

;; stats/mode - æœ€é »å€¤
(stats/mode [1 2 2 3 3 3])          ;; => 3

;; stats/stddev - æ¨™æº–åå·®
(stats/stddev [1 2 3 4 5])          ;; => 1.414...

;; stats/variance - åˆ†æ•£
(stats/variance [1 2 3 4 5])        ;; => 2

;; stats/percentile - ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«
(stats/percentile 0.5 [1 2 3 4 5])  ;; => 3 (50ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«)
```

### è«–ç†ï¼ˆâœ… å…¨ã¦å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === è«–ç†æ¼”ç®—å­ ===

;; and - è«–ç†ANDï¼ˆçŸ­çµ¡è©•ä¾¡ï¼‰
(and true true)                     ;; => true
(and true false)                    ;; => false

;; or - è«–ç†ORï¼ˆçŸ­çµ¡è©•ä¾¡ï¼‰
(or false true)                     ;; => true
(or false false)                    ;; => false

;; not - è«–ç†NOT
(not true)                          ;; => false
(not false)                         ;; => true
```

### ãƒãƒƒãƒ—æ“ä½œ

#### åŸºæœ¬æ“ä½œï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ã‚¢ã‚¯ã‚»ã‚¹ ===

;; get - ã‚­ãƒ¼ã§å€¤ã‚’å–å¾—
(get {:name "Alice" :age 30} :name)     ;; => "Alice"
(get {:name "Alice"} :age 0)            ;; => 0 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤)

;; keys - å…¨ã‚­ãƒ¼ã‚’å–å¾—
(keys {:name "Alice" :age 30})          ;; => ("name" "age")

;; vals - å…¨å€¤ã‚’å–å¾—
(vals {:name "Alice" :age 30})          ;; => ("Alice" 30)

;; === è¿½åŠ ãƒ»å‰Šé™¤ ===

;; assoc - ã‚­ãƒ¼ã¨å€¤ã‚’è¿½åŠ 
(assoc {:name "Alice"} :age 30)         ;; => {:name "Alice" :age 30}

;; dissoc - ã‚­ãƒ¼ã‚’å‰Šé™¤
(dissoc {:name "Alice" :age 30} :age)   ;; => {:name "Alice"}

;; === ãƒãƒ¼ã‚¸ ===

;; merge - ãƒãƒƒãƒ—ã‚’çµåˆ
(merge {:a 1} {:b 2})                   ;; => {:a 1 :b 2}
(merge {:a 1} {:a 2})                   ;; => {:a 2} (å³ãŒå„ªå…ˆ)

;; map/select-keys - æŒ‡å®šã—ãŸã‚­ãƒ¼ã®ã¿æŠ½å‡º
(map/select-keys {:a 1 :b 2 :c 3} [:a :c])  ;; => {:a 1 :c 3}
```

#### ãƒã‚¹ãƒˆæ“ä½œï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === å€¤ã®æ›´æ–° ===

;; update - å€¤ã‚’é–¢æ•°ã§æ›´æ–°
(update {:name "Alice" :age 30} :age inc)
;; => {:name "Alice" :age 31}

;; update-in - ãƒã‚¹ãƒˆã—ãŸå€¤ã‚’æ›´æ–°
(update-in {:user {:profile {:visits 10}}} [:user :profile :visits] inc)
;; => {:user {:profile {:visits 11}}}

;; === ãƒã‚¹ãƒˆã‚¢ã‚¯ã‚»ã‚¹ ===

;; get-in - ãƒã‚¹ãƒˆã—ãŸå€¤ã‚’å–å¾—
(get-in {:user {:name "Bob"}} [:user :name])    ;; => "Bob"
(get-in {} [:user :name] "guest")               ;; => "guest"

;; map/assoc-in - ãƒã‚¹ãƒˆã—ãŸä½ç½®ã«å€¤ã‚’è¨­å®š
(map/assoc-in {:user {}} [:user :name] "Alice")
;; => {:user {:name "Alice"}}

;; map/dissoc-in - ãƒã‚¹ãƒˆã—ãŸä½ç½®ã®ã‚­ãƒ¼ã‚’å‰Šé™¤
(map/dissoc-in {:user {:name "Alice" :age 30}} [:user :age])
;; => {:user {:name "Alice"}}
```

**ä½¿ç”¨ä¾‹: Web APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†**

```qi
(def state {:user {:profile {:visits 10 :last-seen nil}}})

;; è¨ªå•å›æ•°ã‚’å¢—ã‚„ã—ã¦ã€æœ€çµ‚è¨ªå•æ™‚åˆ»ã‚’è¨˜éŒ²
(state
 |> (fn [s] (update-in s [:user :profile :visits] inc))
 |> (fn [s] (map/assoc-in s [:user :profile :last-seen] (now))))
```

#### ãƒãƒƒãƒ—ä¸€æ‹¬å¤‰æ›ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ map/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; map/update-keys - å…¨ã‚­ãƒ¼ã«é–¢æ•°ã‚’é©ç”¨
(map/update-keys str/upper {:name "Alice" :age 30})
;; => {"NAME" "Alice" "AGE" 30}

;; map/update-vals - å…¨å€¤ã«é–¢æ•°ã‚’é©ç”¨
(map/update-vals (fn [v] (* v 2)) {:a 1 :b 2})
;; => {:a 2 :b 4}

;; list/zipmap - ã‚­ãƒ¼ã¨å€¤ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãƒãƒƒãƒ—ã‚’ç”Ÿæˆ
(list/zipmap [:a :b :c] [1 2 3])    ;; => {:a 1 :b 2 :c 3}
```

**ä½¿ç”¨ä¾‹: ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**

```qi
(def prices {:apple 100 :banana 50 :orange 80})

;; å…¨å•†å“ã‚’10%å€¤ä¸Šã’ã—ã¦ä¸¸ã‚ã‚‹
(prices
 |> (map/update-vals (fn [p] (* p 1.1)))
 |> (map/update-vals math/round))
;; => {:apple 110 :banana 55 :orange 88}
```

### é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åŸºç¤

#### åŸºæœ¬ãƒ„ãƒ¼ãƒ«ï¼ˆâœ… å…¨ã¦å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === åŸºæœ¬ ===

;; identity - å¼•æ•°ã‚’ãã®ã¾ã¾è¿”ã™
(identity 42)                       ;; => 42
(filter identity [1 false nil 2])   ;; => (1 2)

;; constantly - å¸¸ã«åŒã˜å€¤ã‚’è¿”ã™é–¢æ•°ã‚’ç”Ÿæˆ
((constantly 42) "anything")        ;; => 42

;; apply - ãƒªã‚¹ãƒˆã‚’å¼•æ•°ã¨ã—ã¦é–¢æ•°ã«é©ç”¨
(apply + [1 2 3])                   ;; => 6
(apply max [5 2 8 3])               ;; => 8

;; === é–¢æ•°åˆæˆ ===

;; comp - é–¢æ•°ã‚’åˆæˆï¼ˆå³ã‹ã‚‰å·¦ã«é©ç”¨ï¼‰
(def process (comp inc (* 2)))
(process 5)                         ;; => 11  ((5 * 2) + 1)

;; partial - éƒ¨åˆ†é©ç”¨
(def add5 (partial + 5))
(add5 10)                           ;; => 15

;; === fn/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ===

;; fn/complement - è¿°èªã®å¦å®š
((fn/complement even?) 3)           ;; => true
((fn/complement even?) 4)           ;; => false

;; fn/juxt - è¤‡æ•°é–¢æ•°ã‚’ä¸¦åˆ—é©ç”¨
((fn/juxt inc dec) 5)               ;; => [6 4]
```

### æ–‡å­—åˆ—æ“ä½œ

#### Coreé–¢æ•°ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === åŸºæœ¬ ===

;; str - å€¤ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ãƒ»é€£çµ
(str "hello" " " "world")           ;; => "hello world"
(str 42)                            ;; => "42"

;; split - æ–‡å­—åˆ—ã‚’åˆ†å‰²
(split "a,b,c" ",")                 ;; => ["a" "b" "c"]

;; join - ãƒªã‚¹ãƒˆã‚’çµåˆ
(join "," ["a" "b" "c"])            ;; => "a,b,c"

;; === ãã®ä»– ===

;; map-lines - å„è¡Œã«é–¢æ•°ã‚’é©ç”¨
(map-lines str/upper "line1\nline2\nline3")
;; => "LINE1\nLINE2\nLINE3"
```

**æ‹¡å¼µæ©Ÿèƒ½**: 60ä»¥ä¸Šã®æ–‡å­—åˆ—é–¢æ•°ãŒ `str/` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

### è¿°èªé–¢æ•°ï¼ˆâœ… å…¨ã¦å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === å‹åˆ¤å®š ===

;; nil? - nilã‹ã©ã†ã‹
(nil? nil)                          ;; => true
(nil? 0)                            ;; => false

;; list? vector? map? - ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹åˆ¤å®š
(list? '(1 2 3))                    ;; => true
(vector? [1 2 3])                   ;; => true
(map? {:a 1})                       ;; => true

;; string? keyword? - ãã®ä»–ã®å‹åˆ¤å®š
(string? "hello")                   ;; => true
(keyword? :name)                    ;; => true

;; integer? float? number? - æ•°å€¤å‹åˆ¤å®š
(integer? 42)                       ;; => true
(float? 3.14)                       ;; => true
(number? 42)                        ;; => true

;; function? macro? - é–¢æ•°ãƒ»ãƒã‚¯ãƒ­åˆ¤å®š
(function? map)                     ;; => true
(macro? defn)                       ;; => true

;; === ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³åˆ¤å®š ===

;; coll? - ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å‹ã‹ï¼ˆlist/vector/mapï¼‰
(coll? [1 2 3])                     ;; => true
(coll? {:a 1})                      ;; => true

;; sequential? - ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«å‹ã‹ï¼ˆlist/vectorï¼‰
(sequential? [1 2 3])               ;; => true
(sequential? {:a 1})                ;; => false

;; === çŠ¶æ…‹åˆ¤å®š ===

;; empty? - ç©ºã‹ã©ã†ã‹
(empty? [])                         ;; => true
(empty? [1])                        ;; => false

;; some? - nilã§ãªã„ã‹
(some? 0)                           ;; => true
(some? nil)                         ;; => false

;; === è«–ç†å€¤åˆ¤å®š ===

;; true? false? - å³å¯†ãªçœŸå½å€¤åˆ¤å®š
(true? true)                        ;; => true
(true? 1)                           ;; => false
(false? false)                      ;; => true

;; === æ•°å€¤åˆ¤å®š ===

;; even? odd? - å¶æ•°ãƒ»å¥‡æ•°åˆ¤å®š
(even? 4)                           ;; => true
(odd? 5)                            ;; => true

;; positive? negative? zero? - æ­£è² ã‚¼ãƒ­åˆ¤å®š
(positive? 5)                       ;; => true
(negative? -5)                      ;; => true
(zero? 0)                           ;; => true
```

### IOãƒ»ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ

#### åŸºæœ¬I/Oï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ io/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === å‡ºåŠ› ===

;; print - æ¨™æº–å‡ºåŠ›ï¼ˆæ”¹è¡Œãªã—ï¼‰
(print "Hello")                     ;; Helloï¼ˆæ”¹è¡Œãªã—ï¼‰

;; println - æ¨™æº–å‡ºåŠ›ï¼ˆæ”¹è¡Œã‚ã‚Šï¼‰
(println "Hello")                   ;; Hello\n

;; === ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ ===

;; io/read-file - ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’èª­ã¿è¾¼ã¿
(io/read-file "data.txt")           ;; => "file content..."

;; io/read-lines - è¡Œã”ã¨ã«èª­ã¿è¾¼ã¿ï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ï¼‰
(io/read-lines "data.txt")          ;; => ["line1" "line2" "line3"]

;; === ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ ===

;; io/write-file - ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ï¼ˆä¸Šæ›¸ãï¼‰
(io/write-file "/tmp/test.txt" "Hello, Qi!")

;; io/append-file - ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½è¨˜
(io/append-file "/tmp/test.txt" "\nSecond line")

;; === ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª ===

;; io/file-exists? - ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
(io/file-exists? "/tmp/test.txt")   ;; => true
```

**ä½¿ç”¨ä¾‹: CSVãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†**

```qi
;; CSVã‚’èª­ã¿è¾¼ã‚“ã§å‡¦ç†
(io/read-file "data.csv")
  |> (fn [content] (split content "\n"))
  |> (map (fn [line] (split line ",")))
  |> (filter (fn [row] (> (len row) 2)))
```

### ä¸¦è¡Œå‡¦ç†ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ãƒãƒ£ãƒãƒ« ===

;; chan - ãƒãƒ£ãƒãƒ«ã‚’ä½œæˆ
(chan)                              ;; ç„¡åˆ¶é™ãƒãƒƒãƒ•ã‚¡
(chan 10)                           ;; ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º10

;; send! - ãƒãƒ£ãƒãƒ«ã«é€ä¿¡
(def ch (chan))
(send! ch 42)

;; recv! - ãƒãƒ£ãƒãƒ«ã‹ã‚‰å—ä¿¡ï¼ˆãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
(recv! ch)                          ;; => 42

;; close! - ãƒãƒ£ãƒãƒ«ã‚’ã‚¯ãƒ­ãƒ¼ã‚º
(close! ch)

;; === Goroutine ===

;; go - æ–°ã—ã„goroutineã§å®Ÿè¡Œ
(go (println "async!"))

;; çµæœã‚’ãƒãƒ£ãƒãƒ«ã§å—ã‘å–ã‚‹
(def result-ch (chan))
(go (send! result-ch (* 2 3)))
(recv! result-ch)                   ;; => 6
```

**ä½¿ç”¨ä¾‹: ä¸¦åˆ—è¨ˆç®—**

```qi
;; è¤‡æ•°ã®goroutineã§ä¸¦åˆ—è¨ˆç®—
(def ch (chan))

(go (send! ch (* 2 3)))
(go (send! ch (* 4 5)))
(go (send! ch (* 6 7)))

[(recv! ch) (recv! ch) (recv! ch)]  ;; => [6 20 42]
```

### çŠ¶æ…‹ç®¡ç†ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ã‚¢ãƒˆãƒ  ===

;; atom - ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªçŠ¶æ…‹ã‚’ä½œæˆ
(def counter (atom 0))

;; deref - ç¾åœ¨ã®å€¤ã‚’å–å¾—
(deref counter)                     ;; => 0

;; reset! - å€¤ã‚’è¨­å®š
(reset! counter 10)
(deref counter)                     ;; => 10

;; swap! - é–¢æ•°ã§å€¤ã‚’æ›´æ–°
(swap! counter inc)
(deref counter)                     ;; => 11

(swap! counter (fn [x] (* x 2)))
(deref counter)                     ;; => 22
```

**ä½¿ç”¨ä¾‹: ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªã‚«ã‚¦ãƒ³ã‚¿ãƒ¼**

```qi
(def counter (atom 0))

;; è¤‡æ•°ã®goroutineã‹ã‚‰å®‰å…¨ã«ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
(go (swap! counter inc))
(go (swap! counter inc))
(go (swap! counter inc))

(sleep 100)  ;; å®Œäº†ã‚’å¾…ã¤
(deref counter)  ;; => 3
```

### ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒ»ãã®ä»–ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; === ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚° ===

;; eval - æ–‡å­—åˆ—ã‚’ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è©•ä¾¡
(eval "(+ 1 2)")                    ;; => 3

;; uvar - ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå¤‰æ•°åã‚’ç”Ÿæˆï¼ˆåå‰è¡çªå›é¿ï¼‰
(uvar)                              ;; => "g__1234"

;; variable - å¤‰æ•°ã‚’ä½œæˆ
(variable "x" 42)

;; macro? - ãƒã‚¯ãƒ­ã‹ã©ã†ã‹åˆ¤å®š
(macro? defn)                       ;; => true

;; === å‹å¤‰æ› ===

;; to-int - æ•´æ•°ã«å¤‰æ›
(to-int "42")                       ;; => 42
(to-int 3.14)                       ;; => 3

;; to-float - æµ®å‹•å°æ•°ç‚¹æ•°ã«å¤‰æ›
(to-float "3.14")                   ;; => 3.14
(to-float 42)                       ;; => 42.0

;; to-string - æ–‡å­—åˆ—ã«å¤‰æ›
(to-string 42)                      ;; => "42"
(to-string [1 2 3])                 ;; => "[1 2 3]"

;; === æ—¥æ™‚ ===

;; now - ç¾åœ¨æ™‚åˆ»ï¼ˆãƒŸãƒªç§’ï¼‰
(now)                               ;; => 1234567890123

;; timestamp - ç¾åœ¨ã®UNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆç§’ï¼‰
(timestamp)                         ;; => 1234567890

;; sleep - æŒ‡å®šãƒŸãƒªç§’ã‚¹ãƒªãƒ¼ãƒ—
(sleep 1000)                        ;; 1ç§’å¾…æ©Ÿ

;; === ãƒ‡ãƒãƒƒã‚° ===

;; time - é–¢æ•°ã®å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬
(time (fn [] (reduce + (range 1000000))))
;; Elapsed: 0.234s

;; inspect - å€¤ã‚’æ•´å½¢è¡¨ç¤ºã—ã¦è¿”ã™
(inspect {:name "Alice" :age 30})
;; => {:name "Alice" :age 30} (æ•´å½¢è¡¨ç¤ºã•ã‚Œã‚‹)

;; error - ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹
(error "Something went wrong")
```

### ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ ğŸš€ **Qiã®æœ€å¼·æ©Ÿèƒ½ - Unixã‚³ãƒãƒ³ãƒ‰ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹çµ±åˆ**

> **ä»–ã®è¨€èªã§ã¯é›£ã—ã„ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€ãŒã€Qiã§ã¯ `|>` ã§ç°¡å˜ã«ï¼**
>
> Python/Node.jsã§ã®ãƒ—ãƒ­ã‚»ã‚¹é–“é€šä¿¡ã¯é¢å€’ã€‚Qiãªã‚‰**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã¨ã—ã¦æ‰±ãˆã‚‹**ã€‚

#### ãªãœQiã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡ŒãŒé©æ–°çš„ãªã®ã‹ï¼Ÿ

**å¾“æ¥ã®å•é¡Œç‚¹**:
- Python: `subprocess.Popen(stdin=PIPE)` ã§è¤‡é›‘ãªã‚³ãƒ¼ãƒ‰
- Node.js: `spawn().stdin.write()` ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
- **ãƒ‘ã‚¤ãƒ—ãŒä½¿ã„ã«ãã„ã€ãƒ‡ãƒ¼ã‚¿ã®æµã‚ŒãŒè¦‹ãˆãªã„**

**Qiã®è§£æ±ºç­–**:
```qi
;; ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒãƒ³ãƒ‰ã¸æµã™ã ã‘ï¼
(data |> (cmd/pipe "jq") |> (cmd/pipe "sort") |> process)

;; Lispã®é–¢æ•°ã‚‚Unixã‚³ãƒãƒ³ãƒ‰ã‚‚åŒã˜ã‚ˆã†ã«æ‰±ãˆã‚‹
(["alice" "bob" "charlie"]
 |> (map str/upper)        ;; Lispé–¢æ•°
 |> (cmd/pipe "sort -r")   ;; Unixã‚³ãƒãƒ³ãƒ‰
 |> (take 2))              ;; Lispé–¢æ•°
;; => ("CHARLIE" "BOB")
```

#### åŸºæœ¬é–¢æ•°ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰
```qi
;; åŸºæœ¬å®Ÿè¡Œ
cmd/exec           ;; ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œï¼ˆçµæœã‚’è¿”ã™ï¼‰
cmd/sh             ;; ã‚·ã‚§ãƒ«çµŒç”±ã§å®Ÿè¡Œï¼ˆãƒ‘ã‚¤ãƒ—ã€ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¯ï¼‰
cmd/pipe           ;; ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒãƒ³ãƒ‰ã¸ãƒ‘ã‚¤ãƒ—ï¼ˆâ˜…è¶…é‡è¦ï¼‰
cmd/lines          ;; ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œãƒªã‚¹ãƒˆã«åˆ†å‰²

;; ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ï¼ˆâœ… NEW!ï¼‰
cmd/stream-lines   ;; ã‚³ãƒãƒ³ãƒ‰å‡ºåŠ›ã‚’è¡Œå˜ä½ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ åŒ–
cmd/stream-bytes   ;; ã‚³ãƒãƒ³ãƒ‰å‡ºåŠ›ã‚’ãƒã‚¤ãƒˆå˜ä½ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ åŒ–

;; åŒæ–¹å‘é€šä¿¡ï¼ˆâœ… NEW!ï¼‰
cmd/interactive    ;; åŒæ–¹å‘ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚»ã‚¹èµ·å‹•
cmd/write          ;; ãƒ—ãƒ­ã‚»ã‚¹ã«æ›¸ãè¾¼ã¿
cmd/read-line      ;; ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰èª­ã¿å–ã‚Š
cmd/wait           ;; ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ã‚’å¾…ã¤
```

---

#### ğŸ’ ã‹ã£ã“ã„ã„å®Ÿç”¨ä¾‹

**ä¾‹1: ãƒ­ã‚°åˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**
```qi
;; ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’æŠ½å‡ºã—ã¦é›†è¨ˆï¼ˆLisp + Unixå®Œå…¨çµ±åˆï¼‰
("access.log"
 |> read-file
 |> (cmd/pipe "grep ERROR")
 |> (get _ "stdout")
 |> cmd/lines
 |> (map (fn [line] (str/re-find #"\[(\w+)\]" line)))
 |> (filter some?)
 |> frequencies
 |> (list/sort-by second >)
 |> (take 5))
;; Lispé–¢æ•°ã¨grepãŒå®Œå…¨ã«èåˆï¼
```

**ä¾‹2: API + jq + ãƒ‡ãƒ¼ã‚¿åŠ å·¥**
```qi
;; GitHub APIã‹ã‚‰å–å¾—â†’jqã§æ•´å½¢â†’Qiã§é›†è¨ˆ
(defn get-user-repos [username]
  (cmd/sh (str "curl -s https://api.github.com/users/" username "/repos")
   |> (get _ "stdout")
   |> (cmd/pipe "jq '[.[] | {name: .name, stars: .stargazers_count}]'")
   |> (get _ "stdout")
   |> json/parse
   |> (get _ :ok)
   |> (list/sort-by (fn [r] (get r "stars")) >)
   |> (take 10)))

(get-user-repos "octocat")
;; curlã‚‚jqã‚‚Qiã‚‚å…¨éƒ¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼
```

**ä¾‹3: CSVãƒ‡ãƒ¼ã‚¿ã®æ•°å€¤ã‚½ãƒ¼ãƒˆï¼ˆawkä¸è¦ï¼‰**
```qi
;; è¤‡é›‘ãªCSVã‚½ãƒ¼ãƒˆï¼ˆå£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’é‡‘é¡ã§ã‚½ãƒ¼ãƒˆï¼‰
(def sales-data "apple,10,150\nbanana,5,80\ncherry,15,300\n")

(sales-data
 |> (cmd/pipe "sort -t, -k3 -rn")  ;; 3åˆ—ç›®ã§é™é †ã‚½ãƒ¼ãƒˆ
 |> (get _ "stdout")
 |> cmd/lines
 |> (map (fn [line] (split line ",")))
 |> (map (fn [[name qty price]]
          {:product name
           :qty (to-int qty)
           :total (to-int price)})))
;; => ({:product "cherry" :qty 15 :total 300}
;;     {:product "apple" :qty 10 :total 150}
;;     {:product "banana" :qty 5 :total 80})

;; sortã‚³ãƒãƒ³ãƒ‰ã§ã‚½ãƒ¼ãƒˆâ†’Lispã§ãƒ‘ãƒ¼ã‚¹â†’ãƒãƒƒãƒ—ã«å¤‰æ›
;; ã“ã‚ŒãŒä¸€ã¤ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ï¼
```

**ä¾‹4: ä¸¦åˆ—å‡¦ç† + ã‚³ãƒãƒ³ãƒ‰**
```qi
;; è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—ã§å‡¦ç†
(["data1.json" "data2.json" "data3.json"]
 ||> read-file                    ;; ä¸¦åˆ—èª­ã¿è¾¼ã¿
 ||> (cmd/pipe "jq '.records'")   ;; ä¸¦åˆ—jqå‡¦ç†
 ||> (fn [r] (get r "stdout"))
 ||> json/parse
 |> (map (fn [r] (get r :ok)))
 |> flatten
 |> (take 100))

;; ||> ã§å…¨éƒ¨ä¸¦åˆ—ï¼curl + jq + Qiã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ä¸¦åˆ—å‡¦ç†
```

**ä¾‹5: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦– & ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç† (âœ… å®Ÿè£…æ¸ˆã¿)**
```qi
;; âœ… å®Ÿè£…æ¸ˆã¿: cmd/stream-lines - è¡Œå˜ä½ã‚¹ãƒˆãƒªãƒ¼ãƒ 
;; tail -f ã®ã‚ˆã†ãªã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†
(def log-stream (cmd/stream-lines "tail -f /var/log/app.log"))

;; ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ»å‡¦ç†
(log-stream
 |> (stream/filter (fn [line] (str/contains? line "ERROR")))
 |> (stream/map parse-log)
 |> (stream/take 100)
 |> stream/realize)

;; ã¾ãŸã¯1è¡Œãšã¤å‡¦ç†
(def line (stream-next log-stream))
(when (str/contains? line "ERROR")
  (alert line))
```

---

### ğŸ”¥ ã‚¹ãƒˆãƒªãƒ¼ãƒ æ©Ÿèƒ½ - å·¨å¤§ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ¡ãƒ¢ãƒªã‚’ä½¿ã‚ãšã«å‡¦ç†ï¼

> **tarã€å·¨å¤§ãƒ­ã‚°ã€å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚‚ï¼ãƒ¡ãƒ¢ãƒªã«è¼‰ã›ãšã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†**

#### ã‚¹ãƒˆãƒªãƒ¼ãƒ é–¢æ•°ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰
```qi
cmd/stream-lines    ;; ã‚³ãƒãƒ³ãƒ‰å‡ºåŠ›ã‚’è¡Œå˜ä½ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ åŒ–
cmd/stream-bytes    ;; ã‚³ãƒãƒ³ãƒ‰å‡ºåŠ›ã‚’ãƒã‚¤ãƒˆå˜ä½ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ åŒ–
cmd/interactive     ;; åŒæ–¹å‘ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚»ã‚¹
cmd/write           ;; ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚»ã‚¹ã«æ›¸ãè¾¼ã¿
cmd/read-line       ;; ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰èª­ã¿å–ã‚Š
cmd/wait            ;; ãƒ—ãƒ­ã‚»ã‚¹ã®çµ‚äº†ã‚’å¾…ã¤
```

---

#### ğŸ’ ã‚¹ãƒˆãƒªãƒ¼ãƒ å®Ÿç”¨ä¾‹

**ä¾‹1: 100GBã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ¡ãƒ¢ãƒªã«è¼‰ã›ãšã«å‡¦ç†**
```qi
;; å·¨å¤§ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡ºï¼ˆãƒ¡ãƒ¢ãƒªåŠ¹ç‡â—ï¼‰
(def huge-log-stream (cmd/stream-lines "cat /var/log/huge-access.log"))

(huge-log-stream
 |> (stream/filter (fn [line] (str/contains? line "ERROR")))
 |> (stream/map parse-error-line)
 |> (stream/take 1000)          ;; æœ€åˆã®1000ä»¶ã ã‘
 |> stream/realize
 |> (map alert))

;; ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: ã»ã¼ã‚¼ãƒ­ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ï¼‰
;; å¾“æ¥: 100GBã‚’ãƒ¡ãƒ¢ãƒªã«è¼‰ã›ã‚‹å¿…è¦ãŒã‚ã‚‹â†’ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
```

**ä¾‹2: taråœ§ç¸®ãƒ»å±•é–‹ã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†**
```qi
;; å·¨å¤§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’taråœ§ç¸®ï¼ˆé€²æ—è¡¨ç¤ºä»˜ãï¼‰
(def tar-stream (cmd/stream-bytes "tar czf - /data/huge-directory" 8192))

(def total-bytes (atom 0))
(tar-stream
 |> (stream/map (fn [list/chunk]
                  (swap! total-bytes + (str/bytes-count list/chunk))
                  (println (str "Compressed: " @total-bytes " bytes"))
                  list/chunk))
 |> stream/realize
 |> (fn [chunks]
      (io/write-bytes "backup.tar.gz" (apply str chunks))))

;; ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãªã®ã§ã€å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒ¡ãƒ¢ãƒªã‚’åœ§è¿«ã—ãªã„
```

**ä¾‹3: å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®é€²æ—è¡¨ç¤º**
```qi
;; å¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—ï¼‰
(def download-stream
  (cmd/stream-bytes "curl -L https://example.com/large-video.mp4" 8192))

(def total (atom 0))
(def output-file (io/open "video.mp4" :write))

(download-stream
 |> (stream/map (fn [list/chunk]
                  (swap! total + (str/bytes-count list/chunk))
                  (print (str "\rDownloaded: " @total " bytes"))
                  (io/write-bytes output-file list/chunk)
                  list/chunk))
 |> stream/realize)

(io/close output-file)
(println "\nDownload complete!")
```

**ä¾‹4: Pythonã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ã¨ã®å¯¾è©±**
```qi
;; Python REPLã¨å¯¾è©±çš„ã«ã‚„ã‚Šã¨ã‚Š
(def py (cmd/interactive "python3 -i"))

(cmd/write py "import math\n")
(cmd/write py "print(math.pi)\n")
(def result (cmd/read-line py))
;; => "3.141592653589793"

(cmd/write py "print(math.sqrt(16))\n")
(def sqrt-result (cmd/read-line py))
;; => "4.0"

(cmd/wait py)
;; => {:exit 0 :stderr ""}
```

**ä¾‹5: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦– & ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**
```qi
;; ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
(def log-stream (cmd/stream-lines "tail -f /var/log/system.log"))

;; ERRORã®ã¿ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
(log-stream
 |> (stream/filter (fn [line] (or (str/contains? line "ERROR")
                                   (str/contains? line "CRITICAL"))))
 |> (stream/map (fn [line]
                  (log/error "Alert!" {:line line})
                  (send-to-slack line)
                  line))
 |> (stream/take 100)  ;; æœ€åˆã®100ä»¶ã§ã‚¹ãƒˆãƒƒãƒ—
 |> stream/realize)
```

---

#### ğŸ¯ ã‚¹ãƒˆãƒªãƒ¼ãƒ è¨­è¨ˆã®åˆ©ç‚¹

1. **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡** - 100GBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ•°MBã®ãƒ¡ãƒ¢ãƒªã§å‡¦ç†å¯èƒ½
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§** - ãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸã‚‰å³åº§ã«å‡¦ç†é–‹å§‹
3. **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ** - `|>` ã¨ `stream/` é–¢æ•°ã§è‡ªç„¶ã«ç¹‹ãŒã‚‹
4. **æ—¢å­˜ãƒ„ãƒ¼ãƒ«æ´»ç”¨** - tarã€gzipã€curlã€tailãªã©å…¨éƒ¨ä½¿ãˆã‚‹

#### ğŸ“Š ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®æ¯”è¼ƒ

| å‡¦ç† | å¾“æ¥ï¼ˆãƒãƒƒãƒ•ã‚¡èª­ã¿è¾¼ã¿ï¼‰ | **Qiï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼‰** |
|------|------------------------|---------------------|
| 100GBãƒ­ã‚°å‡¦ç† | 100GB+ ãƒ¡ãƒ¢ãƒªå¿…è¦ | **æ•°MB** |
| taråœ§ç¸® | ãƒ‡ã‚£ã‚¹ã‚¯I/O2å› | **ãƒ‡ã‚£ã‚¹ã‚¯I/O1å›** |
| å‹•ç”»DL | å…¨DLå¾Œã«å‡¦ç†é–‹å§‹ | **å³åº§ã«å‡¦ç†é–‹å§‹** |
| ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦– | ä¸å¯èƒ½ | **tail -få¯¾å¿œ** |

**â†’ ä»–ã®è¨€èªã§ã¯Cæ‹¡å¼µãŒå¿…è¦ãªå‡¦ç†ãŒã€Qiãªã‚‰æ¨™æº–ã§ï¼**

---

#### ğŸ¯ è¨­è¨ˆæ€æƒ³

1. **ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã¨ã—ã¦çµ±ä¸€** - ã‚³ãƒãƒ³ãƒ‰ã‚‚é–¢æ•°ã‚‚åŒã˜ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
2. **å®‰å…¨æ€§** - ãƒ™ã‚¯ã‚¿å½¢å¼ `["cmd" "arg1" "arg2"]` ã§ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³é˜²æ­¢
3. **çµæœã¯å¸¸ã«Map** - `{:stdout "" :stderr "" :exit 0}` ã§ä¸€è²«æ€§
4. **ãƒªã‚¹ãƒˆã¯è‡ªå‹•å¤‰æ›** - `["a" "b" "c"]` â†’ `"a\nb\nc"` ã¸è‡ªå‹•å¤‰æ›

#### ğŸ“Š ä»–è¨€èªã¨ã®æ¯”è¼ƒ

| æ“ä½œ | Python | Node.js | **Qi** |
|------|--------|---------|--------|
| ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ | `subprocess.run(...)` å†—é•· | `execSync(...)` | `(cmd/exec "...")` |
| ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ— | `Popen(stdin=PIPE)` è¤‡é›‘ | `spawn().stdin.write()` | `(data \|> (cmd/pipe "..."))` |
| è¤‡æ•°ã‚³ãƒãƒ³ãƒ‰ | æ‰‹å‹•ã§ç¹‹ã | æ‰‹å‹•ã§ç¹‹ã | `\|>` ã§è‡ªç„¶ã«ç¹‹ãŒã‚‹ |
| ä¸¦åˆ—å®Ÿè¡Œ | ThreadPoolå¿…è¦ | Promise.all | `\|\|>` ã ã‘ |

**â†’ Qiãªã‚‰1è¡Œã§ã§ãã‚‹ã“ã¨ãŒã€ä»–ã®è¨€èªã§ã¯10è¡Œä»¥ä¸Šå¿…è¦ï¼**

### Webé–‹ç™ºãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ â­ **Phase 4.5æ–°æ©Ÿèƒ½**

#### JSONå‡¦ç†ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ json/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === åŸºæœ¬æ“ä½œ ===

;; json/parse - JSONæ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹
(json/parse "{\"name\":\"Alice\",\"age\":30}")
;; => {:ok {"name" "Alice" "age" 30}}

;; json/stringify - å€¤ã‚’JSONåŒ–ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆï¼‰
(json/stringify {"name" "Bob" "age" 25})
;; => {:ok "{\"name\":\"Bob\",\"age\":25}"}

;; json/pretty - å€¤ã‚’æ•´å½¢JSONåŒ–
(json/pretty {"name" "Bob" "age" 25})
;; => {:ok "{\n  \"name\": \"Bob\",\n  \"age\": 25\n}"}
```

**ä½¿ç”¨ä¾‹: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç†**
```qi
;; APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹â†’å¤‰æ›â†’ä¿å­˜
("https://api.example.com/users/123"
 |> http/get
 |>? (fn [resp] {:ok (get resp "body")})
 |>? json/parse
 |>? (fn [data] {:ok (assoc data "processed" true)})
 |>? json/pretty
 |>? (fn [json] {:ok (io/write-file "output.json" json)}))
```

#### YAMLå‡¦ç†ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

**Pure Rustå®Ÿè£… - serde_yamlä½¿ç”¨**

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ yaml/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === åŸºæœ¬æ“ä½œ ===

;; yaml/parse - YAMLæ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹
(yaml/parse "name: Alice\nage: 30\ntags:\n  - dev\n  - ops")
;; => {:ok {"name" "Alice" "age" 30 "tags" ["dev" "ops"]}}

;; yaml/stringify - å€¤ã‚’YAMLåŒ–
(yaml/stringify {"name" "Bob" "age" 25 "tags" ["backend" "devops"]})
;; => {:ok "name: Bob\nage: 25\ntags:\n- backend\n- devops\n"}

;; yaml/pretty - å€¤ã‚’æ•´å½¢YAMLåŒ–ï¼ˆyaml/stringifyã¨åŒã˜ï¼‰
(yaml/pretty {"server" {"host" "localhost" "port" 8080}})
;; => {:ok "server:\n  host: localhost\n  port: 8080\n"}
```

**ä½¿ç”¨ä¾‹: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†**
```qi
;; è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ãƒãƒ¼ãƒˆç•ªå·ã‚’å–å¾—
("config.yaml"
 |> io/read-file
 |> yaml/parse
 |>? (fn [conf] {:ok (get-in conf ["server" "port"])}))
;; => {:ok 8080}

;; ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆJSON â†’ YAMLï¼‰
("data.json"
 |> io/read-file
 |> json/parse
 |>? (fn [data] (yaml/stringify (get data "ok")))
 |>? (fn [yaml] {:ok (io/write-file "data.yaml" yaml)}))
```

**YAMLã®ç‰¹å¾´**:
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«æœ€é©ï¼ˆJSON/TOMLã‚ˆã‚Šèª­ã¿ã‚„ã™ã„ï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè‡ªå‹•æ•´å½¢
- JSONäº’æ›ï¼ˆYAMLã¯JSONã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚»ãƒƒãƒˆï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: `{:ok ...}` ã¾ãŸã¯ `{:error "..."}`

#### HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ http/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === åŸºæœ¬ãƒ¡ã‚½ãƒƒãƒ‰ ===

;; http/get - HTTP GETãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/get "https://httpbin.org/get")
;; => {:ok {"status" 200 "headers" {...} "body" "..."}}

;; http/post - HTTP POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/post "https://api.example.com/users" {"name" "Alice" "email" "alice@example.com"})
;; => {:ok {"status" 201 "body" "..."}}

;; http/put - HTTP PUTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/put "https://api.example.com/users/1" {"name" "Alice Updated"})

;; http/delete - HTTP DELETEãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/delete "https://api.example.com/users/1")

;; http/patch - HTTP PATCHãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/patch "https://api.example.com/users/1" {"email" "newemail@example.com"})

;; http/head - HTTP HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/head "https://api.example.com/status")

;; http/options - HTTP OPTIONSãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/options "https://api.example.com")

;; === è©³ç´°è¨­å®š ===

;; http/request - ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
(http/request {
  "method" "POST"
  "url" "https://api.example.com/data"
  "headers" {"Authorization" "Bearer token123"}
  "body" {"data" "value"}
  "timeout" 5000
})

;; === èªè¨¼ ===

;; Basicèªè¨¼
(http/request {
  "url" "https://api.example.com/data"
  "basic-auth" ["username" "password"]
})

;; Bearer Tokenèªè¨¼
(http/request {
  "url" "https://api.example.com/data"
  "bearer-token" "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
})

;; === ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åœ§ç¸® ===

;; è‡ªå‹•è§£å‡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ï¼‰
(http/get "https://example.com/api")  ;; gzip/deflate/brotli ã‚’è‡ªå‹•è§£å‡

;; é€ä¿¡æ™‚ã®åœ§ç¸®
(http/post "https://example.com/api"
  {"data" "large payload"}
  {"headers" {"content-encoding" "gzip"}})  ;; ãƒœãƒ‡ã‚£ã‚’è‡ªå‹•çš„ã«gzipåœ§ç¸®
```

**ä½¿ç”¨ä¾‹: Railway Pipelineã¨çµ„ã¿åˆã‚ã›**
```qi
;; GitHub APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
("https://api.github.com/users/octocat"
 |> http/get
 |>? (fn [resp] {:ok (get resp "body")})
 |>? json/parse
 |>? (fn [data] {:ok (get data "name")}))
;; => {:ok "The Octocat"}

;; ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆè‡ªå‹•çš„ã«ã‚¨ãƒ©ãƒ¼ä¼æ’­ï¼‰
("https://invalid.com/api"
 |> http/get
 |>? (fn [resp] {:ok (get resp "body")})  ;; å®Ÿè¡Œã•ã‚Œãªã„
 |>? json/parse)                          ;; å®Ÿè¡Œã•ã‚Œãªã„
;; => {:error {"type" "connection" "message" "..."}}

#### HTTP ã‚µãƒ¼ãƒãƒ¼ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰

**Flow-Oriented ãª Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ§‹ç¯‰**

Qiã®å“²å­¦ï¼ˆFlow-Oriented Programmingï¼‰ã«æ²¿ã£ãŸã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ãƒ‡ãƒ¼ã‚¿ã¨ã„ã†è¨­è¨ˆã§ã™ã€‚

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ server/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒ«ãƒ‘ãƒ¼ ===

;; server/ok - 200 OKãƒ¬ã‚¹ãƒãƒ³ã‚¹
(server/ok "Hello, World!")
;; => {"status" 200 "headers" {...} "body" "Hello, World!"}

;; server/json - JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹
(server/json {"message" "hello" "status" "success"})
;; => {"status" 200 "headers" {"Content-Type" "application/json"} "body" "{...}"}

;; server/not-found - 404 Not Foundãƒ¬ã‚¹ãƒãƒ³ã‚¹
(server/not-found "Page not found")

;; server/no-content - 204 No Contentãƒ¬ã‚¹ãƒãƒ³ã‚¹
(server/no-content)

;; === ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ===

;; server/router - ãƒ«ãƒ¼ã‚¿ãƒ¼ä½œæˆ
(server/router [["/" {"get" hello-handler}]
                ["/api/users" {"get" list-users "post" create-user}]
                ["/api/users/:id" {"get" get-user}]])

;; server/serve - ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
(server/serve app {"port" 3000})
;; => HTTP server started on http://127.0.0.1:3000

;; server/serve - è©³ç´°è¨­å®š
(server/serve app {"port" 8080 "host" "0.0.0.0" "timeout" 30})
;; => HTTP server started on http://0.0.0.0:8080 (timeout: 30s)

;; === ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ ===

;; server/with-logging - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ­ã‚°å‡ºåŠ›
(def handler (server/with-logging (fn [req] (server/ok "Hello"))))

;; server/with-cors - CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
(def handler (server/with-cors (fn [req] (server/json {...}))))

;; server/with-json-body - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’è‡ªå‹•çš„ã«JSONãƒ‘ãƒ¼ã‚¹
(def handler (server/with-json-body (fn [req] (get req "json"))))

;; server/with-compression - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’gzipåœ§ç¸®
(def handler (server/with-compression (fn [req] (server/ok "..."))))

;; server/with-basic-auth - Basicèªè¨¼
(def handler (server/with-basic-auth (fn [req] ...) "user" "pass"))

;; server/with-bearer - Bearer TokenæŠ½å‡º
(def handler (server/with-bearer (fn [req] (get req "token"))))

;; server/with-no-cache - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
(def handler (server/with-no-cache (fn [req] (server/ok "..."))))

;; server/with-cache-control - ã‚«ã‚¹ã‚¿ãƒ Cache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
(def handler (server/with-cache-control (fn [req] ...) "public, max-age=3600"))

;; === é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ ===

;; server/static-file - å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
(server/static-file "index.html")

;; server/static-dir - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¿¡
(server/static-dir "public")
```

**ä½¿ç”¨ä¾‹: ã‚·ãƒ³ãƒ—ãƒ«ãªã‚µãƒ¼ãƒãƒ¼**
```qi
;; ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ -> ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰
(def hello-handler
  (fn [req] (server/ok "Hello, World!")))

;; ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆãƒ‡ãƒ¼ã‚¿é§†å‹•ï¼‰
(def routes [["/" {"get" hello-handler}]])

;; ã‚¢ãƒ—ãƒªèµ·å‹•
(def app (server/router routes))
(server/serve app {"port" 3000})
```

**ä½¿ç”¨ä¾‹: JSON API with ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**
```qi
;; ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å®šç¾©
(def list-users
  (fn [req]
    (server/json {"users" [{"id" 1 "name" "Alice"}
                           {"id" 2 "name" "Bob"}]})))

(def get-user
  (fn [req]
    (let [user-id (get-in req ["params" "id"])]
      (server/json {"id" user-id "name" "Alice"}))))

(def create-user
  (fn [req]
    (server/json {"status" "created"} {"status" 201})))

;; ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: /users/:id å½¢å¼ï¼‰
(def routes
  [["/api/users" {"get" list-users "post" create-user}]
   ["/api/users/:id" {"get" get-user}]
   ["/api/users/:user_id/posts/:post_id" {"get" get-post}]])

;; ã‚¢ãƒ—ãƒªèµ·å‹•
(def app (server/router routes))
(server/serve app {"port" 8080 "host" "0.0.0.0" "timeout" 30})
```

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**:
```qi
;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ§‹é€ 
{"method" "get"                      ;; HTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå°æ–‡å­—ï¼‰
 "path" "/api/users/123"             ;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ã‚¹
 "query" "page=1&limit=10"           ;; ã‚¯ã‚¨ãƒªæ–‡å­—åˆ—ï¼ˆç”Ÿï¼‰
 "query-params" {"page" "1"          ;; ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆè‡ªå‹•ãƒ‘ãƒ¼ã‚¹ï¼‰
                 "limit" "10"}
 "headers" {"content-type" "application/json" ...}
 "body" "..."                        ;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼ˆæ–‡å­—åˆ—ï¼‰
 "params" {"id" "123"}}              ;; ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆãƒãƒƒãƒã—ãŸå ´åˆã®ã¿ï¼‰

;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ 
{"status" 200                        ;; HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
 "headers" {"Content-Type" "text/plain; charset=utf-8" ...}
 "body" "Hello, World!"}             ;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£
```

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½**:
- âœ… **ãƒ‡ãƒ¼ã‚¿é§†å‹•**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯æ¤œæŸ»ãƒ»å¤‰æ›å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- âœ… **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ `|>` ã§æµã‚ŒãŒæ˜ç¢º
- âœ… **åˆæˆå¯èƒ½**: ã™ã¹ã¦ãŒé–¢æ•°ã§ã€ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚‚é–¢æ•°
- âœ… **ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•**: ä¸¦åˆ—ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã«å¯¾å¿œ
- âœ… **ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `/users/:id` å½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆè¤‡æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¯¾å¿œï¼‰
- âœ… **ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `?page=1&limit=10` ã‚’è‡ªå‹•ãƒ‘ãƒ¼ã‚¹ã€é…åˆ—å¯¾å¿œã€URLãƒ‡ã‚³ãƒ¼ãƒ‰
- âœ… **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’è¨­å®šå¯èƒ½ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30ç§’ï¼‰
- âœ… **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢**: ãƒ­ã‚®ãƒ³ã‚°ã€CORSã€JSONãƒœãƒ‡ã‚£ãƒ‘ãƒ¼ã‚¹ï¼ˆè¤‡æ•°é‡ã­å¯èƒ½ï¼‰
- âœ… **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡**: HTMLã€CSSã€JSã€ç”»åƒã€ãƒ•ã‚©ãƒ³ãƒˆãªã©ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ
- âœ… **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åœ§ç¸®**: gzip/deflate/brotliåœ§ç¸®ã‚’ã‚µãƒãƒ¼ãƒˆ
- âœ… **èªè¨¼**: Basic Authã€Bearer TokenæŠ½å‡º
- âœ… **ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡**: Cache-Controlã€ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³

**ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚·ã‚¹ãƒ†ãƒ **ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰:

Qiã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã¯**ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ãƒ©ãƒƒãƒ—ã—ã¦æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹é«˜éšé–¢æ•°**ã§ã™ã€‚è¤‡æ•°ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é‡ã­ã‚‹ã“ã¨ã§ã€æ¨ªæ–­çš„ãªé–¢å¿ƒäº‹ã‚’åˆ†é›¢ã§ãã¾ã™ã€‚

```qi
;; ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é–¢æ•°
server/with-logging       ;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ­ã‚°å‡ºåŠ›
server/with-cors          ;; CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
server/with-json-body     ;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’è‡ªå‹•çš„ã«JSONãƒ‘ãƒ¼ã‚¹
server/with-compression   ;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’gzipåœ§ç¸®
server/with-basic-auth    ;; Basicèªè¨¼ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ï¼‰
server/with-bearer        ;; Bearer TokenæŠ½å‡ºï¼ˆæ¤œè¨¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ï¼‰
server/with-no-cache      ;; ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
server/with-cache-control ;; ã‚«ã‚¹ã‚¿ãƒ Cache-Controlãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
```

**ä½¿ç”¨ä¾‹ - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®åŸºæœ¬**:
```qi
;; 1. ãƒ­ã‚®ãƒ³ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def logging-handler
  (server/with-logging
    (fn [req]
      (server/ok "Hello!"))))

;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚: [HTTP] GET /logging
;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚: [HTTP] -> 200

;; 2. CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def cors-handler
  (server/with-cors
    (fn [req]
      (server/json {"message" "CORS enabled"}))))

;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«è‡ªå‹•çš„ã«CORSãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¿½åŠ ã•ã‚Œã‚‹:
;; Access-Control-Allow-Origin: *
;; Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
;; Access-Control-Allow-Headers: Content-Type, Authorization

;; 3. JSONãƒœãƒ‡ã‚£ãƒ‘ãƒ¼ã‚¹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def json-handler
  (server/with-json-body
    (fn [req]
      (let [json-data (get req "json")]
        (server/json {"received" json-data})))))

;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ãŒè‡ªå‹•çš„ã«ãƒ‘ãƒ¼ã‚¹ã•ã‚Œã€req["json"]ã«æ ¼ç´ã•ã‚Œã‚‹
;; curl -X POST ... -d '{"name":"alice"}'
;; => req["json"] = {"name" "alice"}

;; 4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def compressed-handler
  (server/with-compression
    (fn [req]
      (server/ok "Large response body that will be compressed..."))))

;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒ1KBä»¥ä¸Šã®å ´åˆã€è‡ªå‹•çš„ã«gzipåœ§ç¸®ã•ã‚Œã‚‹
;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼: Content-Encoding: gzip

;; 5. Basicèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def protected-handler
  (server/with-basic-auth
    (fn [req]
      (server/ok "Protected content"))
    {"users" {"admin" "secret123" "user" "pass456"}}))

;; èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
;; æ­£ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãªã„å ´åˆã€401 Unauthorizedã‚’è¿”ã™
;; curl -u admin:secret123 http://localhost:3000/admin
;; => "Protected content"

;; ãƒ«ãƒ¼ã‚¿ãƒ¼å…¨ä½“ã«èªè¨¼ã‚’é©ç”¨
(def protected-app
  (server/with-basic-auth
    (server/router routes)
    {"users" {"admin" "secret"}}))

;; å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆãŒèªè¨¼å¿…é ˆã«ãªã‚‹

;; 6. Bearer TokenæŠ½å‡ºãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
(def api-handler
  (server/with-bearer
    (fn [req]
      (let [token (get req "bearer-token")]
        (if (= token "valid-token-12345")
          (server/json {"status" "authenticated" "data" "..."})
          (server/json {"status" "unauthorized"} {"status" 401}))))))

;; Authorization: Bearer valid-token-12345 ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æŠ½å‡º
;; req["bearer-token"] ã«ãƒˆãƒ¼ã‚¯ãƒ³æ–‡å­—åˆ—ãŒæ ¼ç´ã•ã‚Œã‚‹
;; æ¤œè¨¼ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã§å®Ÿè¡Œï¼ˆJWTãƒ©ã‚¤ãƒ–ãƒ©ãƒªç­‰ã‚’ä½¿ç”¨å¯èƒ½ï¼‰
```

**ä½¿ç”¨ä¾‹ - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®çµ„ã¿åˆã‚ã›**:
```qi
;; è¤‡æ•°ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚’é‡ã­ã¦ä½¿ç”¨ï¼ˆå¤–å´ã‹ã‚‰é †ã«é©ç”¨ï¼‰
(def api-handler
  (server/with-logging        ;; æœ€å¤–å±¤: ãƒ­ã‚°ã‚’å‡ºåŠ›
    (server/with-cors         ;; ä¸­å±¤: CORSãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
      (server/with-json-body  ;; æœ€å†…å±¤: JSONã‚’è‡ªå‹•ãƒ‘ãƒ¼ã‚¹
        (fn [req]
          (let [data (get req "json")
                user (get data "user")]
            (server/json {"message" (str "Hello, " user "!")})))))))

(def routes
  [["/api" (assoc {} "post" api-handler)]])

(def app (server/router routes))
(server/serve app {"port" 3000})

;; curl -X POST http://localhost:3000/api -d '{"user":"alice"}'
;; [HTTP] POST /api              <- ãƒ­ã‚°å‡ºåŠ›
;; [HTTP] -> 200                 <- ãƒ­ã‚°å‡ºåŠ›
;; {"message":"Hello, alice!"}   <- JSON + CORSãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ããƒ¬ã‚¹ãƒãƒ³ã‚¹
```

**ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**:
```qi
;; CORSã®ã‚ªãƒªã‚¸ãƒ³ã‚’æŒ‡å®š
(def cors-handler
  (server/with-cors
    (fn [req] (server/json {"data" "..."}))
    {"origins" ["https://example.com" "https://api.example.com"]}))

;; åœ§ç¸®ã®æœ€å°ã‚µã‚¤ã‚ºã‚’æŒ‡å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1024ãƒã‚¤ãƒˆ = 1KBï¼‰
(def custom-compressed-handler
  (server/with-compression
    (fn [req] (server/ok "Response body..."))
    {"min-size" 512}))  ;; 512ãƒã‚¤ãƒˆä»¥ä¸Šã§åœ§ç¸®

;; èªè¨¼ã¨JSONå‡¦ç†ã‚’çµ„ã¿åˆã‚ã›
(def secure-api-handler
  (server/with-basic-auth
    (server/with-json-body
      (fn [req]
        (let [data (get req "json")]
          (server/json {"received" data "authenticated" true}))))
    {"users" {"api-user" "api-pass"}}))

;; Bearerèªè¨¼ã§APIä¿è­·
(def bearer-api-handler
  (server/with-bearer
    (server/with-json-body
      (fn [req]
        (let [token (get req "bearer-token")
              data (get req "json")]
          (if (= token "secret-api-token")
            (server/json {"data" data "status" "ok"})
            (server/json {"error" "invalid token"} {"status" 401})))))))

;; ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–ï¼ˆAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹ç­‰ï¼‰
(def no-cache-handler
  (server/with-no-cache
    (fn [req] (server/json {"data" "dynamic content" "timestamp" (now)}))))
;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:
;; Cache-Control: no-store, no-cache, must-revalidate, private
;; Pragma: no-cache
;; Expires: 0

;; ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡ï¼ˆé™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç­‰ï¼‰
(def cached-handler
  (server/with-cache-control
    (fn [req] (server/ok "Static content"))
    {"max-age" 3600 "public" true}))
;; ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼: Cache-Control: max-age=3600, public

;; è©³ç´°ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡
(def immutable-handler
  (server/with-cache-control
    (fn [req] (server/ok "Immutable content with hash in filename"))
    {"max-age" 31536000 "public" true "immutable" true}))
;; 1å¹´é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ + immutableï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã•ã‚ŒãŸã‚¢ã‚»ãƒƒãƒˆç”¨ï¼‰
;; Cache-Control: max-age=31536000, public, immutable
```

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä½¿ç”¨ä¾‹**:
```qi
;; åŸºæœ¬çš„ãªã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
(def search-handler
  (fn [req]
    (let [params (get req "query-params")
          query (get params "q")
          page (get params "page")
          limit (get params "limit")]
      (server/json {"search" query "page" page "limit" limit}))))

;; GET /search?q=lisp&page=1&limit=20
;; => {"search":"lisp","page":"1","limit":"20"}

;; é…åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆåŒã˜ã‚­ãƒ¼ãŒè¤‡æ•°ï¼‰
(def filter-handler
  (fn [req]
    (let [params (get req "query-params")
          tags (get params "tags")]  ;; é…åˆ—ã«ãªã‚‹
      (server/json {"tags" tags}))))

;; GET /filter?tags=ruby&tags=python&tags=lisp
;; => {"tags":["ruby","python","lisp"]}

;; URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤ã‚‚è‡ªå‹•ãƒ‡ã‚³ãƒ¼ãƒ‰
;; GET /search?q=Hello%20World
;; => {"search":"Hello World"}
```

**é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡**ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰:

Qiã¯é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTMLã€CSSã€JavaScriptã€ç”»åƒã€ãƒ•ã‚©ãƒ³ãƒˆãªã©ï¼‰ã®é…ä¿¡ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ­£ã—ãå‡¦ç†ã•ã‚Œã¾ã™ã€‚

```qi
;; ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é–¢æ•°
server/static-file        ;; å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡ã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç”Ÿæˆ
server/static-dir         ;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç”Ÿæˆ
```

**ä½¿ç”¨ä¾‹ - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¿¡**:
```qi
;; publicãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ä¿¡
(def routes
  [["/" (assoc {} "get" (server/static-dir "./public"))]])

(def app (server/router routes))
(server/serve app {"port" 3000})

;; GET /index.html  => ./public/index.html ã‚’é…ä¿¡
;; GET /style.css   => ./public/style.css ã‚’é…ä¿¡
;; GET /logo.png    => ./public/logo.png ã‚’é…ä¿¡ï¼ˆãƒã‚¤ãƒŠãƒªï¼‰
;; GET /            => ./public/index.html ã‚’è‡ªå‹•é…ä¿¡
```

**ä½¿ç”¨ä¾‹ - å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡**:
```qi
;; ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥é…ä¿¡
(def favicon-handler
  (fn [req]
    (server/static-file "./public/favicon.ico")))

(def routes
  [["/favicon.ico" (assoc {} "get" favicon-handler)]])
```

**ä½¿ç”¨ä¾‹ - APIã¨é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ„ã¿åˆã‚ã›**:
```qi
;; APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒæ™‚ã«æä¾›
(def routes
  [["/api/users" (assoc {} "get" list-users "post" create-user)]
   ["/api/users/:id" (assoc {} "get" get-user)]
   ["/" (assoc {} "get" (server/static-dir "./public"))]])  ;; é™çš„ãƒ•ã‚¡ã‚¤ãƒ«

(def app (server/router routes))
(server/serve app {"port" 8080})

;; GET /api/users         => APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆJSONï¼‰
;; GET /api/users/123     => APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆJSONï¼‰
;; GET /index.html        => é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆHTMLï¼‰
;; GET /app.js            => é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆJavaScriptï¼‰
;; GET /logo.png          => é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆPNGç”»åƒï¼‰
```

**æ©Ÿèƒ½**:
- âœ… **Content-Typeè‡ªå‹•åˆ¤å®š**: æ‹¡å¼µå­ã‹ã‚‰é©åˆ‡ãªMIMEã‚¿ã‚¤ãƒ—ã‚’è¨­å®šï¼ˆHTMLã€CSSã€JSã€ç”»åƒã€ãƒ•ã‚©ãƒ³ãƒˆã€PDFç­‰ï¼‰
- âœ… **ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ**: ç”»åƒã€ãƒ•ã‚©ãƒ³ãƒˆã€PDFãªã©ã‚’ãƒ‡ãƒ¼ã‚¿æå¤±ãªãé…ä¿¡
- âœ… **index.htmlè‡ªå‹•é…ä¿¡**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è‡ªå‹•çš„ã«index.htmlã‚’é…ä¿¡
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«æ”»æ’ƒï¼ˆ`..`ã‚’å«ã‚€ãƒ‘ã‚¹ï¼‰ã‚’è‡ªå‹•æ¤œå‡ºãƒ»æ‹’å¦
- âœ… **ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒãƒƒãƒãƒ³ã‚°**: `/` ã«é…ç½®ã—ãŸé™çš„ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ã™ã¹ã¦ã®ã‚µãƒ–ãƒ‘ã‚¹ã«ãƒãƒƒãƒ

**å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼**ï¼ˆContent-Typeè‡ªå‹•åˆ¤å®šï¼‰:
- ãƒ†ã‚­ã‚¹ãƒˆ: `.html`, `.css`, `.js`, `.json`, `.xml`, `.txt`, `.md`
- ç”»åƒ: `.png`, `.jpg`, `.jpeg`, `.gif`, `.svg`, `.ico`, `.webp`
- ãƒ•ã‚©ãƒ³ãƒˆ: `.woff`, `.woff2`, `.ttf`, `.otf`
- ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–: `.pdf`, `.zip`, `.gz`
- ãã®ä»–: `application/octet-stream`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

**åˆ¶é™äº‹é …**:
- âš ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯éåŒæœŸå‡¦ç†ã«é©ç”¨ã•ã‚Œã‚‹ãŒã€Qiã®åŒæœŸçš„ãªãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°æ“ä½œï¼ˆ`sleep`ãªã©ï¼‰ã«ã¯åŠ¹ã‹ãªã„
- âš ï¸ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã¯æ–‡å­—åˆ—ã®ã¾ã¾ï¼ˆæ•°å€¤ã¸ã®è‡ªå‹•å¤‰æ›ã¯è¡Œã‚ãªã„ï¼‰
- âš ï¸ **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡ã¯ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚€**
  - **æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 10MB**
  - ã“ã‚Œã‚’è¶…ãˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚‚å…¨ä½“ã‚’ãƒ¡ãƒ¢ãƒªã«èª­ã¿è¾¼ã‚€
  - **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡** = ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º Ã— åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
  - **æ¨å¥¨**: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‹•ç”»ã€å¤§ããªPDFãªã©ï¼‰ã¯åˆ¥ã®CDNã‚„ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã§é…ä¿¡

**ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ä¾‹**:
- å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ¨å¥¨ï¼‰: GET /logo.png (100KB) Ã— 10åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 1MB ãƒ¡ãƒ¢ãƒª
- ä¸­è¦æ¨¡ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè¨±å®¹ç¯„å›²ï¼‰: GET /document.pdf (5MB) Ã— 10åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 50MB ãƒ¡ãƒ¢ãƒª
- å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆ¶é™ã‚ã‚Šï¼‰: GET /large.pdf (10MB) Ã— 10åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆ = 100MB ãƒ¡ãƒ¢ãƒª
- å¤§ãã™ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚¨ãƒ©ãƒ¼ï¼‰: GET /video.mp4 (50MB) â†’ ã‚¨ãƒ©ãƒ¼: "file too large: 52428800 bytes (max: 10485760 bytes / 10 MB)"

**å°†æ¥ã®æ‹¡å¼µäºˆå®š** ğŸš§:
- **ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹** ğŸ¯ å„ªå…ˆåº¦é«˜
  - å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‹•ç”»ã€å¤§ããªPDFç­‰ï¼‰ã‚’ãƒãƒ£ãƒ³ã‚¯å˜ä½ã§é…ä¿¡
  - ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„ãªå®Ÿè£…ï¼ˆRust: `tokio::fs::File` + `ReaderStream`ï¼‰
  - Range requests å¯¾å¿œï¼ˆéƒ¨åˆ†ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€å‹•ç”»ã‚·ãƒ¼ã‚¯ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ä½œæˆAPI
- ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹è‡ªå‹•æ¨è«–ï¼ˆ`"42"` â†’ `42`ï¼‰
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆå¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
- WebSocket ã‚µãƒãƒ¼ãƒˆ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³

#### ãƒ‡ãƒãƒƒã‚°ãƒ»è¨ˆæ¸¬ï¼ˆâœ… å®Ÿè£…æ¸ˆã¿ï¼‰
```qi
inspect                 ;; å€¤ã‚’æ•´å½¢è¡¨ç¤ºã—ã¦ãã®ã¾ã¾è¿”ã™ï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ç”¨ï¼‰
time                    ;; é–¢æ•°å®Ÿè¡Œæ™‚é–“ã‚’è¨ˆæ¸¬
```

**ä½¿ç”¨ä¾‹**:
```qi
;; inspect: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã‚’è¦³å¯Ÿ
(def data {"name" "Alice" "scores" [95 87 92]})
(data
 |> (assoc _ "average" 91.3)
 |> inspect              ;; æ•´å½¢è¡¨ç¤ºã—ã¦ãã®ã¾ã¾è¿”ã™
 |> (map/update-vals inc))

;; time: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
(time (fn []
  (reduce + (range 1000000))))
;; Elapsed: 0.234s
;; => 499999500000

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ä½¿ç”¨
(urls
 ||> http/get
 |> (fn [responses] (time (fn [] (process responses))))
 |> save-results)
```

**è¨­è¨ˆå“²å­¦**:
- JSONã¨HTTPã¯å¸¸ã«Resultå‹ `{:ok value}` / `{:error e}` ã‚’è¿”ã™
- Railway Pipeline `|>?` ã¨å®Œç’§ã«çµ±åˆ
- ãƒ‡ãƒãƒƒã‚°é–¢æ•°ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å†…ã§ä½¿ã„ã‚„ã™ã„è¨­è¨ˆ
- éåŒæœŸç‰ˆã¯Channelã‚’è¿”ã—ã€Layer 1 (go/chan) ã¨çµ±åˆ

### ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç† - Qiã®çœŸé«„

**Qiã¯ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ã‚’ç¬¬ä¸€ç´šå¸‚æ°‘ã¨ã—ã¦æ‰±ã†è¨€èªã§ã™ã€‚**

ã€Œä¸¦åˆ—ã€ä¸¦è¡Œã‚’ç°¡å˜ã«ã§ãã‚‹ã®ã¯Qiã®ã‚­ãƒ¢ã€- ã“ã‚ŒãŒQiã®è¨­è¨ˆå“²å­¦ã®æ ¸å¿ƒã§ã™ã€‚

#### è¨­è¨ˆå“²å­¦

Qiã®ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ã¯**3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: async/await (é«˜ãƒ¬ãƒ™ãƒ«)     â”‚  â† ä½¿ã„ã‚„ã™ã•ï¼ˆI/Oã€APIï¼‰
â”‚  - async, await, then, catch        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 2: Pipeline (ä¸­ãƒ¬ãƒ™ãƒ«)        â”‚  â† é–¢æ•°å‹ã‚‰ã—ã•
â”‚  - pmap, pipeline, fan-out/in       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Layer 1: go/chan (ä½ãƒ¬ãƒ™ãƒ«åŸºç›¤)     â”‚  â† ãƒ‘ãƒ¯ãƒ¼ã¨æŸ”è»Ÿæ€§
â”‚  - go, chan, send!, recv!, close!   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã™ã¹ã¦go/chanã®ä¸Šã«æ§‹ç¯‰** - ã‚·ãƒ³ãƒ—ãƒ«ã§ä¸€è²«æ€§ã®ã‚ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚

#### âœ… å…¨ã¦å®Ÿè£…æ¸ˆã¿

**å®Ÿè£…çŠ¶æ…‹**:
- âœ… Evaluatorã‚’å®Œå…¨ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•åŒ–ï¼ˆArc<RwLock<_>>ï¼‰
- âœ… pmapã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã‚‚ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½
- âœ… Atomã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼ˆRwLockä½¿ç”¨ï¼‰
- âœ… Layer 1: go/chanå®Œå…¨å®Ÿè£…
- âœ… Layer 2: Pipelineå®Œå…¨å®Ÿè£…
- âœ… Layer 3: async/awaitå®Œå…¨å®Ÿè£…

**Layer 1: go/chanï¼ˆåŸºç›¤ï¼‰** - Goé¢¨ã®ä¸¦è¡Œå‡¦ç† âœ…

ãƒãƒ£ãƒãƒ«ä½œæˆ:
```qi
(chan)       ;; ç„¡åˆ¶é™ãƒãƒƒãƒ•ã‚¡
(chan 10)    ;; ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚º10
```

é€å—ä¿¡:
```qi
;; ãƒãƒ£ãƒãƒ«ã¸ã®é€ä¿¡ã¨å—ä¿¡ï¼ˆchã¯äº‹å‰ã«ä½œæˆã•ã‚ŒãŸãƒãƒ£ãƒãƒ«ï¼‰
(def ch (chan))
(def value 42)

(send! ch value)              ;; ãƒãƒ£ãƒãƒ«ã«é€ä¿¡
(recv! ch)                    ;; ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å—ä¿¡
(recv! ch :timeout 1000)      ;; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãå—ä¿¡ï¼ˆãƒŸãƒªç§’ï¼‰
(close! ch)                   ;; ãƒãƒ£ãƒãƒ«ã‚¯ãƒ­ãƒ¼ã‚º
```

goroutine:
```qi
(go (println "async!"))

(def result-ch (chan))
(go (send! result-ch (* 2 3)))
(recv! result-ch)  ;; 6
```

Structured Concurrencyï¼ˆæ§‹é€ åŒ–ä¸¦è¡Œå‡¦ç†ï¼‰:
```qi
;; Structured Concurrencyï¼ˆæ§‹é€ åŒ–ä¸¦è¡Œå‡¦ç†ï¼‰ âœ…
(def ctx (make-scope))  ;; ã‚¹ã‚³ãƒ¼ãƒ—ä½œæˆ
(async/scope-go ctx (fn []    ;; ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§goroutineèµ·å‹•
  (loop [i 0]
    (if (async/cancelled? ctx)
      (println "cancelled")
      (do
        (println i)
        (sleep 100)
        (recur (inc i)))))))
(async/cancel! ctx)           ;; ã‚¹ã‚³ãƒ¼ãƒ—å†…ã®å…¨goroutineã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

;; with-scopeé–¢æ•°ï¼ˆä¾¿åˆ©ç‰ˆï¼‰ âœ…
(async/with-scope (fn [ctx]
  (async/scope-go ctx task1)
  (async/scope-go ctx task2)
  ;; ã‚¹ã‚³ãƒ¼ãƒ—çµ‚äº†æ™‚ã«è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  ))
```

**Layer 2: Pipelineï¼ˆæ§‹é€ åŒ–ä¸¦è¡Œå‡¦ç†ï¼‰** - é–¢æ•°å‹ã‚¹ã‚¿ã‚¤ãƒ« âœ…
```lisp
;; ä¸¦åˆ—ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ“ä½œ âœ…
pmap                    ;; ä¸¦åˆ—mapï¼ˆrayonä½¿ç”¨ï¼‰
async/pfilter                 ;; ä¸¦åˆ—filter âœ…
async/preduce                 ;; ä¸¦åˆ—reduce âœ…
async/parallel-do             ;; è¤‡æ•°å¼ã®ä¸¦åˆ—å®Ÿè¡Œ âœ…

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç† âœ…
(pipeline n xf ch)      ;; nä¸¦åˆ—ã§xfå¤‰æ›ã‚’chã«é©ç”¨

;; ãƒ•ã‚¡ãƒ³ã‚¢ã‚¦ãƒˆ/ãƒ•ã‚¡ãƒ³ã‚¤ãƒ³ âœ…
(fan-out ch n)          ;; 1ã¤ã®ãƒãƒ£ãƒãƒ«ã‚’nå€‹ã«åˆ†å²
(fan-in chs)            ;; è¤‡æ•°ãƒãƒ£ãƒãƒ«ã‚’1ã¤ã«åˆæµ

;; ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ âœ…
(-> data
    (pipeline/map 4 transform)     ;; 4ä¸¦åˆ—ã§å¤‰æ›
    (pipeline/filter 2 predicate)  ;; 2ä¸¦åˆ—ã§ãƒ•ã‚£ãƒ«ã‚¿
    (into []))
```

**Layer 3: async/awaitï¼ˆé«˜ãƒ¬ãƒ™ãƒ«ï¼‰** - ãƒ¢ãƒ€ãƒ³ãªéåŒæœŸå‡¦ç† âœ…
```lisp
;; åŸºæœ¬çš„ãªawait
(def p (go (fn [] (+ 1 2 3))))
(async/await p)  ;; => 6

;; Promise ãƒã‚§ãƒ¼ãƒ³
(-> (go (fn [] 10))
    (async/then (fn [x] (* x 2)))
    (async/then (fn [x] (+ x 1)))
    (await))  ;; => 21

;; Promise.allé¢¨
(def promises [(go (fn [] 1)) (go (fn [] 2)) (go (fn [] 3))])
(async/await (all promises))  ;; => [1 2 3]

;; Promise.raceé¢¨
(def promises [(go (fn [] "slow")) (go (fn [] "fast"))])
(async/await (async/race promises))  ;; => "fast"

;; ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
(async/catch promise (fn [e] (println "Error:" e)))
```

**å®Ÿè£…æ¸ˆã¿ãƒ»å®Ÿè£…äºˆå®šã®é–¢æ•°ä¸€è¦§**:

**Layer 1 (go/chan)**:
- âœ… `chan`: ãƒãƒ£ãƒãƒ«ä½œæˆ
- âœ… `send!`: é€ä¿¡
- âœ… `recv!`: ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å—ä¿¡
- âœ… `recv! :timeout`: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãå—ä¿¡
- âœ… `try-recv!`: éãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å—ä¿¡
- âœ… `close!`: ãƒãƒ£ãƒãƒ«ã‚¯ãƒ­ãƒ¼ã‚º
- âœ… `go`: goroutineèµ·å‹•
- âœ… `select!`: è¤‡æ•°ãƒãƒ£ãƒãƒ«å¾…ã¡åˆã‚ã›
- âœ… `make-scope`: ã‚¹ã‚³ãƒ¼ãƒ—ä½œæˆ
- âœ… `async/scope-go`: ã‚¹ã‚³ãƒ¼ãƒ—å†…goroutine
- âœ… `cancel!`: ã‚¹ã‚³ãƒ¼ãƒ—ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- âœ… `cancelled?`: ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèª
- âœ… `async/with-scope`: ã‚¹ã‚³ãƒ¼ãƒ—è‡ªå‹•ç®¡ç†

**Layer 2 (Pipeline)**:
- âœ… `pmap`: ä¸¦åˆ—map
- âœ… `async/pfilter`: ä¸¦åˆ—filter
- âœ… `async/preduce`: ä¸¦åˆ—reduce
- âœ… `async/parallel-do`: è¤‡æ•°å¼ã®ä¸¦åˆ—å®Ÿè¡Œ
- âœ… `pipeline`: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†
- âœ… `pipeline/map`: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³map
- âœ… `pipeline/filter`: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³filter
- âœ… `fan-out`: ãƒ•ã‚¡ãƒ³ã‚¢ã‚¦ãƒˆ
- âœ… `fan-in`: ãƒ•ã‚¡ãƒ³ã‚¤ãƒ³

**Layer 3 (async/await)**:
- âœ… `await`: Promiseã‚’å¾…æ©Ÿ
- âœ… `then`: Promiseãƒã‚§ãƒ¼ãƒ³
- âœ… `catch`: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- âœ… `all`: è¤‡æ•°Promiseã‚’ä¸¦åˆ—å®Ÿè¡Œ
- âœ… `race`: æœ€é€Ÿã®Promiseã‚’è¿”ã™

#### å®Ÿè£…æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **crossbeam-channel**: Goé¢¨ãƒãƒ£ãƒãƒ«å®Ÿè£…ï¼ˆselect!ãƒã‚¯ãƒ­ã‚‚æä¾›ï¼‰
- **rayon**: ãƒ‡ãƒ¼ã‚¿ä¸¦åˆ—ï¼ˆpmap, async/pfilter, preduceç­‰ï¼‰
- **parking_lot**: é«˜æ€§èƒ½RwLock
- **tokio** (å°†æ¥): async/awaitå®Ÿè¡Œæ™‚

### âœ… çŠ¶æ…‹ç®¡ç† - Atomï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

Qiã®çŠ¶æ…‹ç®¡ç†ã¯**Atom**ï¼ˆã‚¢ãƒˆãƒ ï¼‰ã‚’ä½¿ã„ã¾ã™ã€‚Atomã¯å‚ç…§é€éæ€§ã‚’ä¿ã¡ãªãŒã‚‰ã€å¿…è¦ãªå ´æ‰€ã ã‘ã§çŠ¶æ…‹ã‚’æŒã¤ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚

#### åŸºæœ¬æ“ä½œ

```qi
;; âœ… å®Ÿè£…æ¸ˆã¿
atom                    ;; ã‚¢ãƒˆãƒ ä½œæˆ
deref                   ;; å€¤å–å¾—
@                       ;; derefã®çŸ­ç¸®å½¢ï¼ˆ@counter => (deref counter)ï¼‰
swap!                   ;; é–¢æ•°ã§æ›´æ–°ï¼ˆã‚¢ãƒˆãƒŸãƒƒã‚¯ï¼‰
reset!                  ;; å€¤ã‚’ç›´æ¥ã‚»ãƒƒãƒˆ
```

#### ã‚¢ãƒˆãƒ ã®ä½œæˆã¨å‚ç…§

```qi
;; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
(def counter (atom 0))

;; å€¤ã‚’å–å¾—
(deref counter)  ;; 0

;; å€¤ã‚’æ›´æ–°
(reset! counter 10)
(deref counter)  ;; 10

;; é–¢æ•°ã§æ›´æ–°ï¼ˆç¾åœ¨ã®å€¤ã‚’ä½¿ã†ï¼‰
(swap! counter inc)
(deref counter)  ;; 11

(swap! counter + 5)
(deref counter)  ;; 16
```

#### å®Ÿç”¨ä¾‹1: ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼

```qi
;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
(def request-count (atom 0))

(defn handle-request [req]
  (do
    (swap! request-count inc)
    (process req)))

;; ç¾åœ¨ã®ã‚«ã‚¦ãƒ³ãƒˆç¢ºèª
(deref request-count)  ;; å‡¦ç†ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
```

#### å®Ÿç”¨ä¾‹2: çŠ¶æ…‹ã‚’æŒã¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥

```qi
;; ã‚­ãƒ£ãƒƒã‚·ãƒ¥
(def cache (atom {}))

(defn get-or-fetch [key fetch-fn]
  (let [cached (get (deref cache) key)]
    (if cached
      cached
      (let [value (fetch-fn)]
        (do
          (swap! cache assoc key value)
          value)))))

;; ä½¿ç”¨ä¾‹
(get-or-fetch :user-123 (fn [] (fetch-from-db :user-123)))
```

#### å®Ÿç”¨ä¾‹3: æ¥ç¶šç®¡ç†ï¼ˆdeferã¨çµ„ã¿åˆã‚ã›ï¼‰

```qi
;; ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ¥ç¶šã‚’ç®¡ç†
(def clients (atom #{}))

(defn handle-connection [conn]
  (do
    (swap! clients conj conn)
    (defer (swap! clients dissoc conn))  ;; ç¢ºå®Ÿã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    (process-connection conn)))

;; ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°
(len (deref clients))
```

#### å®Ÿç”¨ä¾‹4: è¤‡é›‘ãªçŠ¶æ…‹æ›´æ–°

```qi
;; ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
(def app-state (atom {
  :users {}
  :posts []
  :status "running"
}))

;; ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
(defn add-user [user]
  (swap! app-state (fn [state]
    (assoc state :users
      (assoc (get state :users) (get user :id) user)))))

;; æŠ•ç¨¿è¿½åŠ 
(defn add-post [post]
  (swap! app-state (fn [state]
    (assoc state :posts (conj (get state :posts) post)))))

;; çŠ¶æ…‹ç¢ºèª
(deref app-state)
```

#### Atomã®è¨­è¨ˆå“²å­¦

1. **å±€æ‰€çš„ãªçŠ¶æ…‹**: ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ä»£ã‚ã‚Šã«ã€å¿…è¦ãªå ´æ‰€ã ã‘ã§Atomã‚’ä½¿ã†
2. **swap!ã®åŸå­æ€§**: æ›´æ–°ãŒç¢ºå®Ÿã«é©ç”¨ã•ã‚Œã‚‹ï¼ˆç«¶åˆçŠ¶æ…‹ã‚’å›é¿ï¼‰
3. **é–¢æ•°å‹ã¨ã®å…±å­˜**: ç´”ç²‹é–¢æ•°ã¨Atomã‚’çµ„ã¿åˆã‚ã›ã‚‹
4. **deferã¨ç›¸æ€§ãŒè‰¯ã„**: ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã§å¨åŠ›ã‚’ç™ºæ®

#### âœ… @ æ§‹æ–‡ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

```qi
;; derefã®çŸ­ç¸®å½¢
(deref counter)  ;; å¾“æ¥
@counter         ;; çŸ­ç¸®å½¢

;; ã©ã¡ã‚‰ã‚‚åŒã˜æ„å‘³
(print (deref state))
(print @state)

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä¾¿åˆ©
(def cache (atom {:user-123 {:name "Alice"}}))
(get @cache :user-123)  ;; {:name "Alice"}

;; é–¢æ•°ã®å¼•æ•°ã¨ã—ã¦ã‚‚ä½¿ãˆã‚‹
(def users (atom [{:name "Alice"} {:name "Bob"}]))
(first @users)  ;; {:name "Alice"}
(map (fn [u] (get u :name)) @users)  ;; ("Alice" "Bob")
```

### âœ… ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆå…¨ã¦å®Ÿè£…æ¸ˆã¿ï¼‰
```qi
;; âœ… å®Ÿè£…æ¸ˆã¿
try                     ;; ã‚¨ãƒ©ãƒ¼ã‚’ {:ok ...} / {:error ...} ã«å¤‰æ›
error                   ;; ä¾‹å¤–ã‚’æŠ•ã’ã‚‹ï¼ˆå›å¾©ä¸èƒ½ï¼‰
```

### âœ… ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
```lisp
;; âœ… å®Ÿè£…æ¸ˆã¿
mac                     ;; ãƒã‚¯ãƒ­å®šç¾©
quasiquote (`)          ;; ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
unquote (,)             ;; å€¤ã®åŸ‹ã‚è¾¼ã¿
unquote-splice (,@)     ;; ãƒªã‚¹ãƒˆã®å±•é–‹
uvar                    ;; ä¸€æ„ãªå¤‰æ•°ã‚’ç”Ÿæˆï¼ˆãƒã‚¯ãƒ­ã®è¡›ç”Ÿæ€§ï¼‰
variable                ;; å¤‰æ•°ã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯
macro?                  ;; ãƒã‚¯ãƒ­ã‹ã©ã†ã‹
eval                    ;; å¼ã‚’è©•ä¾¡
```

## 7. ãƒ«ãƒ¼ãƒ—æ§‹é€ 

### âœ… `loop` / `recur`ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

æœ«å°¾å†å¸°æœ€é©åŒ–ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®ç‰¹æ®Šå½¢å¼ã§ã™ã€‚

```qi
;; åŸºæœ¬å½¢
(loop [var1 val1 var2 val2 ...]
  body
  (recur new-val1 new-val2 ...))

;; éšä¹—ï¼ˆ5! = 120ï¼‰
(defn factorial [n]
  (loop [i n acc 1]
    (if (= i 0)
      acc
      (recur (dec i) (* acc i)))))

(factorial 5)  ;; 120

;; ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
(defn count-down [n]
  (loop [i n]
    (if (<= i 0)
      "done"
      (do
        (print i)
        (recur (dec i))))))

;; ãƒªã‚¹ãƒˆå‡¦ç†ï¼ˆmatchã¨çµ„ã¿åˆã‚ã›ã‚‹å ´åˆã¯è¦å®Ÿè£…ï¼‰
;; ç¾åœ¨ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã§å®Ÿè£…å¯èƒ½ï¼š
(defn sum-list [lst]
  (loop [items lst result 0]
    (if (empty? items)
      result
      (recur (rest items) (+ result (first items))))))

(sum-list [1 2 3 4 5])  ;; 15
```

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ**:
- `loop`ã¯æ–°ã—ã„ç’°å¢ƒã‚’ä½œæˆã—ã€å¤‰æ•°ã‚’åˆæœŸå€¤ã§æŸç¸›
- `recur`ã¯ç‰¹åˆ¥ãªã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã„ã€`loop`ã§ã‚­ãƒ£ãƒƒãƒã—ã¦å¤‰æ•°ã‚’æ›´æ–°
- é€šå¸¸ã®å†å¸°ã¨ç•°ãªã‚Šã€ã‚¹ã‚¿ãƒƒã‚¯ã‚’æ¶ˆè²»ã—ãªã„ï¼ˆæœ«å°¾å†å¸°æœ€é©åŒ–ï¼‰
```

## 8. ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®3å±¤æ§‹é€ 

Qiã¯ç”¨é€”ã«å¿œã˜ã¦3ã¤ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†æ–¹æ³•ã‚’æä¾›ã—ã¾ã™ï¼š

1. **Resultå‹ (`{:ok/:error}`)** - å›å¾©å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã€Railway Pipeline
2. **try/catchãƒ–ãƒ­ãƒƒã‚¯** - ä¾‹å¤–ã®ã‚­ãƒ£ãƒƒãƒã¨ãƒªã‚«ãƒãƒª
3. **defer** - ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ã®ä¿è¨¼ï¼ˆ`finally`ã®ä»£æ›¿ï¼‰

---

### 1. Resultå‹ - Railway Pipeline âœ… **æ¨å¥¨ãƒ‘ã‚¿ãƒ¼ãƒ³**

**ç”¨é€”**: APIã€ãƒ•ã‚¡ã‚¤ãƒ«IOã€ãƒ‘ãƒ¼ã‚¹ç­‰ã®å¤±æ•—ãŒäºˆæƒ³ã•ã‚Œã‚‹å‡¦ç†

```qi
;; Resultå‹ã‚’è¿”ã™é–¢æ•°
(defn divide [x y]
  (if (= y 0)
    {:error "division by zero"}
    {:ok (/ x y)}))

;; Railway Pipelineã§å‡¦ç†
(user-input
 |> validate
 |>? parse-number
 |>? (fn [n] (divide 100 n))
 |>? format-result)
;; ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«ä¼æ’­

;; ã¾ãŸã¯matchã§å‡¦ç†
(match (divide 10 2)
  {:ok result} -> result
  {:error e} -> (log e))
```

**è¨­è¨ˆå“²å­¦**: ã‚¨ãƒ©ãƒ¼ã‚’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã„ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ä¸­ã§æµã™ã€‚

---

### 2. try/catch - ä¾‹å¤–å‡¦ç† âœ…

**ç”¨é€”**: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã®ã‚­ãƒ£ãƒƒãƒã€ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚³ãƒ¼ãƒ‰ã®å‘¼ã³å‡ºã—

```qi
;; try-catchãƒ–ãƒ­ãƒƒã‚¯
(match (try (risky-operation))
  {:ok result} -> result
  {:error e} -> (handle-error e))

;; ãƒã‚¹ãƒˆå¯èƒ½
(match (try
         (let data (parse-data input))
         (process data))
  {:ok result} -> result
  {:error e} -> {:error (str "Failed: " e)})
```

**æ³¨æ„**: Qiã«ã¯`finally`ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»£ã‚ã‚Šã«`defer`ã‚’ä½¿ã„ã¾ã™ï¼ˆä¸‹è¨˜å‚ç…§ï¼‰ã€‚

---

### 3. defer - ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾ã®ä¿è¨¼ âœ… **finallyã®ä»£æ›¿**

**ç”¨é€”**: ãƒ•ã‚¡ã‚¤ãƒ«ã€æ¥ç¶šã€ãƒ­ãƒƒã‚¯ãªã©ã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†

```qi
;; deferã§ç¢ºå®Ÿã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
(defn process-file [path]
  (let f (open-file path))
  (defer (close-file f))  ;; é–¢æ•°çµ‚äº†æ™‚ã«å¿…ãšå®Ÿè¡Œ
  (let data (io/read-file f))
  (transform data))

;; è¤‡æ•°ã®deferã¯ã‚¹ã‚¿ãƒƒã‚¯çš„ã«å®Ÿè¡Œï¼ˆå¾Œå…¥ã‚Œå…ˆå‡ºã—ï¼‰
(defn complex-operation []
  (let conn (open-connection))
  (defer (close-connection conn))
  (let lock (acquire-lock))
  (defer (release-lock lock))
  (let file (open-file "data.txt"))
  (defer (close-file file))
  ;; å‡¦ç†...
  ;; çµ‚äº†æ™‚: close-file â†’ release-lock â†’ close-connection
  )

;; ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚deferã¯å®Ÿè¡Œã•ã‚Œã‚‹
(defn safe-process []
  (let res (allocate-resource))
  (defer (free-resource res))
  (if (error-condition?)
    (error "something went wrong")  ;; deferã¯å®Ÿè¡Œã•ã‚Œã‚‹
    (process res)))
```

**è¨­è¨ˆå“²å­¦**:
- `finally`ã‚ˆã‚Šã‚·ãƒ³ãƒ—ãƒ« - é–¢æ•°ã®ã©ã“ã«ã§ã‚‚æ›¸ã‘ã‚‹
- å¼·åŠ› - è¤‡æ•°ã®deferã‚’çµ„ã¿åˆã‚ã›ã‚‰ã‚Œã‚‹
- Goè¨€èªã®deferã¨åŒã˜è¨­è¨ˆ
- Lispçš„ - ç‰¹æ®Šãªæ§‹æ–‡ã‚’å¢—ã‚„ã•ãªã„

**ãªãœfinallyãŒãªã„ã®ã‹**: `defer`ã®æ–¹ãŒæŸ”è»Ÿã§ã€è¤‡æ•°ã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ãŒç›´æ„Ÿçš„ã€‚try-catch-finallyã®ãƒã‚¹ãƒˆã‚ˆã‚Šèª­ã¿ã‚„ã™ã„ã€‚

---

### å›å¾©å¯èƒ½ - {:ok/:error}
```qi
;; é–¢æ•°ãŒçµæœã‚’è¿”ã™
(defn divide [x y]
  (if (= y 0)
    {:error "division by zero"}
    {:ok (/ x y)}))

(match (divide 10 2)
  {:ok result} -> result
  {:error e} -> (log e))

(def parse-int (fn [s]
  (match (try-parse s)
    nil -> {:error "not a number"}
    n -> {:ok n})))
```

### å›å¾©ä¸èƒ½ - error
```qi
;; è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼ã¯ error ã§æŠ•ã’ã‚‹
(def critical-init (fn []
  (if (not (io/file-exists? "config.qi"))
    (error "config.qi not found")
    (load-config))))

(defn factorial [n]
  (if (< n 0)
    (error "negative input not allowed")
    (loop [i n acc 1]
      (if (= i 0)
        acc
        (recur (dec i) (* acc i))))))

;; try ã§ã‚­ãƒ£ãƒƒãƒ
(match (try (factorial -5))
  {:ok result} -> result
  {:error e} -> (log (str "Error: " e)))
```

## 9. ãƒ¦ãƒ‹ãƒ¼ã‚¯å¤‰æ•°ï¼ˆuvarsï¼‰

### åŸºæœ¬
```qi
;; ä¸€æ„ãªå¤‰æ•°ã‚’ç”Ÿæˆ
(def uvar ()
  (join))  ;; æ–°ã—ã„ãƒšã‚¢ã‚’è¿”ã™

;; ãƒãƒ¼ã‚«ãƒ¼
(def vmark (join))

;; å¤‰æ•°åˆ¤å®š
(def variable (x)
  (or (and (symbol x) (not (mem x '(nil t o apply))))
      (and (pair x) (id (car x) vmark))))
```

### ãƒã‚¯ãƒ­ã§ã®ä½¿ç”¨
```qi
;; å¤‰æ•°åã®è¡çªã‚’é¿ã‘ã‚‹
(mac when (test & body)
  (let [g (uvar)]
    `(let [,g ,test]
       (if ,g (do ,@body)))))

;; å±•é–‹ä¾‹
(when (> x 10)
  (print x))
;; â†“
(let [#<uvar:1> (> x 10)]
  (if #<uvar:1> (do (print x))))

;; è¡çªã—ãªã„
(let [g 5]
  (when (> x 10)
    (+ g 1)))  ;; gã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¤‰æ•°
```

### å®‰å…¨ãªãƒã‚¯ãƒ­
```qi
;; aif ãƒã‚¯ãƒ­
(mac aif (test then & else)
  (let [it (uvar)]
    `(let [,it ,test]
       (if ,it ,then ,@else))))

;; ä½¿ç”¨ä¾‹ï¼ˆè¡çªãªã—ï¼‰
(let [it 'outer]
  (aif (find even? [1 3 5])
       it        ;; aifã®itï¼ˆuvarï¼‰
       it))      ;; outerã®it
;; => 'outer

;; or ãƒã‚¯ãƒ­
(mac or (& args)
  (if (no args)
      nil
      (if (no (cdr args))
          (car args)
          (let [g (uvar)]
            `(let [,g ,(car args)]
               (if ,g ,g (or ,@(cdr args))))))))

;; do ãƒã‚¯ãƒ­
(mac do (& body)
  (reduce (fn [x y]
            (let [v (uvar)]
              `((fn [,v] ,y) ,x)))
          body))

;; è¤‡æ•°ã®uvars
(mac letu (vars & body)
  `(withs ,(fuse [list _ `(uvar)] vars)
     ,@body))

;; ä½¿ç”¨ä¾‹
(mac my-complex-macro (x y)
  (letu (a b c)
    `(let [,a ,x]
       (let [,b ,y]
         (let [,c (+ ,a ,b)]
           (list ,a ,b ,c))))))
```

## 10. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ï¼ˆâœ… åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…æ¸ˆã¿ï¼‰

### âœ… ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©
```qi
;; http.qi
(module http)

(defn get [url] ...)
(defn post [url data] ...)

(export get post)
```

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
```qi
;; âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³1: ç‰¹å®šã®é–¢æ•°ã®ã¿ï¼ˆæ¨å¥¨ãƒ»å®Ÿè£…æ¸ˆã¿ï¼‰
(use http :only [get post])
(get url)

;; ğŸš§ ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼ˆæœªå®Ÿè£…ï¼‰
(use http :as h)
(h/get url)

;; âœ… ãƒ‘ã‚¿ãƒ¼ãƒ³3: å…¨ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
(use http :all)
(get url)

;; ğŸš§ ãƒ‘ã‚¿ãƒ¼ãƒ³4: ãƒªãƒãƒ¼ãƒ ï¼ˆæœªå®Ÿè£…ï¼‰
(use http :only [get :as fetch])
(fetch url)
```

**å®Ÿè£…çŠ¶æ³ãƒ¡ãƒ¢**:
- âœ… `module` / `export` - ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- âœ… `use :only [...]` - ç‰¹å®šé–¢æ•°ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- âœ… `use :all` - å…¨ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- âœ… å¾ªç’°å‚ç…§æ¤œå‡º
- âœ… `use :as` - ã‚¨ã‚¤ãƒªã‚¢ã‚¹æ©Ÿèƒ½ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

### æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

#### âœ… coreï¼ˆè‡ªå‹•ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»110å€‹ï¼‰
Coreãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯è‡ªå‹•çš„ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚

```qi
;; ç‰¹æ®Šå½¢å¼ãƒ»æ¼”ç®—å­
def fn let do if match try defer
|> ||> |>? ~>

;; ãƒªã‚¹ãƒˆæ“ä½œ
first rest last nth len count take drop cons conj concat
flatten range reverse sort distinct zip map filter reduce
pmap tap find every? some? take-while drop-while

;; é«˜éšé–¢æ•°
identity comp partial apply constantly branch

;; ãƒãƒƒãƒ—æ“ä½œ
get keys vals assoc dissoc merge get-in update-in update

;; æ•°å€¤ãƒ»æ¯”è¼ƒ
+ - * / % inc dec abs min max sum = != < > <= >=

;; æ–‡å­—åˆ—
str split join

;; è¿°èªãƒ»å‹åˆ¤å®š
nil? list? vector? map? string? integer? float? number?
keyword? function? atom? coll? sequential? empty? some?
true? false? even? odd? positive? negative? zero?

;; ä¸¦è¡Œå‡¦ç†
go chan send! recv! close!

;; è«–ç†ãƒ»I/O
not print println error
;; æ³¨: and, or ã¯ç‰¹æ®Šå½¢å¼ï¼ˆé…å»¶è©•ä¾¡ã®ãŸã‚ï¼‰

;; çŠ¶æ…‹ç®¡ç†
atom deref swap! reset!

;; ãƒ¡ã‚¿ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
eval uvar variable macro?

;; å‹å¤‰æ›
to-int to-float to-string

;; æ—¥æ™‚
now timestamp sleep

;; ãƒ‡ãƒãƒƒã‚°
time inspect

;; ãã®ä»–
map-lines
```

#### å°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

##### âœ… list - é«˜åº¦ãªãƒªã‚¹ãƒˆæ“ä½œ

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ list/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; list/frequencies - è¦ç´ ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
(list/frequencies [1 2 2 3 3 3])        ;; => {1 1, 2 2, 3 3}

;; list/sort-by - ã‚­ãƒ¼é–¢æ•°ã§ã‚½ãƒ¼ãƒˆ
(list/sort-by count ["aaa" "b" "cc"])   ;; => ["b" "cc" "aaa"]

;; list/count-by - ã‚­ãƒ¼é–¢æ•°ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
(list/count-by even? [1 2 3 4 5 6])     ;; => {false 3, true 3}

;; list/max-by - ã‚­ãƒ¼é–¢æ•°ã§æœ€å¤§å€¤ã‚’æŒã¤è¦ç´ 
(list/max-by count ["a" "bbb" "cc"])    ;; => "bbb"

;; list/min-by - ã‚­ãƒ¼é–¢æ•°ã§æœ€å°å€¤ã‚’æŒã¤è¦ç´ 
(list/min-by count ["a" "bbb" "cc"])    ;; => "a"

;; list/sum-by - ã‚­ãƒ¼é–¢æ•°ã§å¤‰æ›ã—ã¦åˆè¨ˆ
(list/sum-by count ["a" "bb" "ccc"])    ;; => 6

;; list/find-index - æ¡ä»¶ã‚’æº€ãŸã™æœ€åˆã®è¦ç´ ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
(list/find-index even? [1 3 4 5])       ;; => 2

;; list/partition - nå€‹ãšã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²
(list/partition 2 [1 2 3 4 5 6])        ;; => ((1 2) (3 4) (5 6))

;; list/partition-by - é–¢æ•°ã®æˆ»ã‚Šå€¤ãŒå¤‰ã‚ã‚‹ä½ç½®ã§åˆ†å‰²
(list/partition-by even? [1 1 2 2 3 3]) ;; => ((1 1) (2 2) (3 3))

;; list/group-by - ã‚­ãƒ¼é–¢æ•°ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
(list/group-by even? [1 2 3 4 5 6])     ;; => {false [1 3 5], true [2 4 6]}

;; list/keep - nilã§ãªã„çµæœã®ã¿ä¿æŒ
(list/keep (fn [x] (if (even? x) x nil)) [1 2 3 4])  ;; => (2 4)

;; list/zipmap - 2ã¤ã®ãƒªã‚¹ãƒˆã‹ã‚‰ãƒãƒƒãƒ—ã‚’ä½œæˆ
(list/zipmap ["a" "b" "c"] [1 2 3])     ;; => {"a" 1, "b" 2, "c" 3}

;; list/chunk - nå€‹ãšã¤ã®ãƒãƒ£ãƒ³ã‚¯ã«åˆ†å‰²ï¼ˆpartitionã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹ï¼‰
(list/chunk 3 [1 2 3 4 5 6 7])          ;; => ((1 2 3) (4 5 6) (7))

;; list/interleave - è¤‡æ•°ã®ãƒªã‚¹ãƒˆã‚’äº¤äº’ã«çµåˆ
(list/interleave [1 2 3] [:a :b :c])    ;; => (1 :a 2 :b 3 :c)

;; list/take-nth - nç•ªç›®ã”ã¨ã®è¦ç´ ã‚’å–å¾—
(list/take-nth 2 [0 1 2 3 4 5])         ;; => (0 2 4)

;; list/dedupe - é€£ç¶šã™ã‚‹é‡è¤‡ã‚’å‰Šé™¤
(list/dedupe [1 1 2 2 2 3 3 1])         ;; => (1 2 3 1)

;; list/split-at - æŒ‡å®šä½ç½®ã§åˆ†å‰²
(list/split-at 3 [1 2 3 4 5])           ;; => ([1 2 3] [4 5])

;; list/drop-last - æœ€å¾Œã®nè¦ç´ ã‚’å‰Šé™¤
(list/drop-last 2 [1 2 3 4 5])          ;; => (1 2 3)
```

##### âœ… map - é«˜åº¦ãªãƒãƒƒãƒ—æ“ä½œ

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ map/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; map/select-keys - æŒ‡å®šã—ãŸã‚­ãƒ¼ã®ã¿æŠ½å‡º
(map/select-keys {"a" 1 "b" 2 "c" 3} ["a" "c"])  ;; => {"a" 1, "c" 3}

;; map/assoc-in - ãƒã‚¹ãƒˆã—ãŸãƒãƒƒãƒ—ã«å€¤ã‚’è¨­å®š
(map/assoc-in {} ["a" "b" "c"] 42)               ;; => {"a" {"b" {"c" 42}}}

;; map/dissoc-in - ãƒã‚¹ãƒˆã—ãŸãƒãƒƒãƒ—ã‹ã‚‰å€¤ã‚’å‰Šé™¤
(map/dissoc-in {"a" {"b" {"c" 1}}} ["a" "b" "c"])  ;; => {"a" {"b" {}}}

;; map/update-keys - å…¨ã¦ã®ã‚­ãƒ¼ã«é–¢æ•°ã‚’é©ç”¨
(map/update-keys str/upper {"a" 1 "b" 2})        ;; => {"A" 1, "B" 2}

;; map/update-vals - å…¨ã¦ã®å€¤ã«é–¢æ•°ã‚’é©ç”¨
(map/update-vals inc {"a" 1 "b" 2})              ;; => {"a" 2, "b" 3}
```

##### âœ… fn - é«˜éšé–¢æ•°

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ fn/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; fn/complement - è¿°èªé–¢æ•°ã®å¦å®šã‚’è¿”ã™
(def not-even? (fn/complement even?))
(not-even? 3)                                    ;; => true

;; fn/juxt - è¤‡æ•°ã®é–¢æ•°ã‚’ä¸¦åˆ—é©ç”¨
(def stats (fn/juxt min max sum))
(stats [1 2 3 4 5])                              ;; => (1 5 15)

;; fn/tap> - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å€¤ã‚’æ¸¡ã—ãªãŒã‚‰å‰¯ä½œç”¨å®Ÿè¡Œ
([1 2 3] |> (fn/tap> println) |> sum)            ;; => 6
```

##### âœ… set - é›†åˆæ¼”ç®—

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ set/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; set/union - å’Œé›†åˆ
(set/union #{1 2 3} #{3 4 5})                    ;; => #{1 2 3 4 5}

;; set/intersect - ç©é›†åˆ
(set/intersect #{1 2 3} #{2 3 4})                ;; => #{2 3}

;; set/difference - å·®é›†åˆ
(set/difference #{1 2 3} #{2 3 4})               ;; => #{1}

;; set/subset? - éƒ¨åˆ†é›†åˆã‹åˆ¤å®š
(set/subset? #{1 2} #{1 2 3})                    ;; => true

;; set/superset? - ä¸Šä½é›†åˆã‹åˆ¤å®š
(set/superset? #{1 2 3} #{1 2})                  ;; => true

;; set/disjoint? - äº’ã„ã«ç´ ã‹åˆ¤å®š
(set/disjoint? #{1 2} #{3 4})                    ;; => true

;; set/symmetric-difference - å¯¾ç§°å·®
(set/symmetric-difference #{1 2 3} #{2 3 4})     ;; => #{1 4}
```

##### âœ… math - æ•°å­¦é–¢æ•°

Coreã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€Œæ•°å­¦é–¢æ•°ã€ã‚’å‚ç…§ï¼ˆè©³ç´°ãªä¾‹ã‚ã‚Šï¼‰

```qi
;; math/pow, math/sqrt, math/round, math/floor, math/ceil
;; math/clamp, math/rand, math/rand-int
```

##### âœ… time - æ—¥ä»˜ãƒ»æ™‚åˆ»

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ time/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; time/now-iso, time/today, time/from-unix, time/to-unix
;; time/format, time/parse
;; time/add-days, time/add-hours, time/add-minutes
;; time/sub-days, time/sub-hours, time/sub-minutes
;; time/diff-days, time/diff-hours, time/diff-minutes
;; time/before?, time/after?, time/between?
;; time/year, time/month, time/day
;; time/hour, time/minute, time/second, time/weekday
```

##### âœ… io - ãƒ•ã‚¡ã‚¤ãƒ«I/O - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œï¼ˆæ—¥ä¸­éŸ“æ¬§éœ²ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿æ›¸ã**:
- `io/read-file` - ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®šãƒ»è‡ªå‹•æ¤œå‡ºå¯¾å¿œï¼‰
- `io/write-file` - ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®šã€if-existsã€create-dirså¯¾å¿œï¼‰
- `io/append-file` - ãƒ•ã‚¡ã‚¤ãƒ«è¿½è¨˜
- `io/write-stream` - ã‚¹ãƒˆãƒªãƒ¼ãƒ â†’ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿
- `io/read-lines` - è¡Œã”ã¨èª­ã¿è¾¼ã¿

**ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ**:
- `io/list-dir` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§å–å¾—ï¼ˆã‚°ãƒ­ãƒ–ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰
- `io/create-dir` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
- `io/delete-file` - ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
- `io/delete-dir` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‰Šé™¤
- `io/copy-file` - ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
- `io/move-file` - ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹•ãƒ»åå‰å¤‰æ›´

**ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**:
- `io/file-info` - ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±å–å¾—
- `io/file-exists?` - ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
- `io/is-file?` - ãƒ•ã‚¡ã‚¤ãƒ«åˆ¤å®š
- `io/is-dir?` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ¤å®š

**ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚µãƒãƒ¼ãƒˆ** - ã‚°ãƒ­ãƒ¼ãƒãƒ«å¯¾å¿œ:

**Unicode**:
- `:utf-8` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€BOMè‡ªå‹•é™¤å»)
- `:utf-8-bom` (BOMä»˜ãUTF-8ã€Excelå¯¾å¿œ)
- `:utf-16le` (UTF-16LEã€BOMä»˜ãã€Excelå¤šè¨€èªå¯¾å¿œ)
- `:utf-16be` (UTF-16BEã€BOMä»˜ã)

**æ—¥æœ¬èª**:
- `:sjis` / `:shift-jis` (Shift_JIS/Windows-31Jã€æ—¥æœ¬Windows/Excel)
- `:euc-jp` (EUC-JPã€Unixç³»)
- `:iso-2022-jp` (JISã€ãƒ¡ãƒ¼ãƒ«)

**ä¸­å›½èª**:
- `:gbk` (GBKã€ä¸­å›½æœ¬åœŸãƒ»ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«ã€ç°¡ä½“å­—Windows/Excel)
- `:gb18030` (GB18030ã€ä¸­å›½å›½å®¶è¦æ ¼ã€GBKä¸Šä½äº’æ›)
- `:big5` (Big5ã€å°æ¹¾ãƒ»é¦™æ¸¯ã€ç¹ä½“å­—Windows/Excel)

**éŸ“å›½èª**:
- `:euc-kr` (EUC-KRã€éŸ“å›½Windows/Excel)

**æ¬§å·**:
- `:windows-1252` / `:cp1252` / `:latin1` (è¥¿æ¬§ã€ç±³å›½Windows/Excel)
- `:windows-1251` / `:cp1251` (ãƒ­ã‚·ã‚¢ãƒ»ã‚­ãƒªãƒ«æ–‡å­—åœWindows/Excel)

**è‡ªå‹•æ¤œå‡º**:
- `:auto` (BOMæ¤œå‡º â†’ UTF-8 â†’ å„åœ°åŸŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é †æ¬¡è©¦è¡Œ)

```qi
;; ============================================
;; åŸºæœ¬çš„ãªèª­ã¿æ›¸ã
;; ============================================

;; ã‚·ãƒ³ãƒ—ãƒ«ï¼ˆUTF-8ï¼‰
(io/read-file "data.txt")
(io/write-file content "output.txt")

;; ============================================
;; ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æŒ‡å®š
;; ============================================

;; Shift_JISï¼ˆæ—¥æœ¬èªWindows/Excelï¼‰
(io/read-file "legacy.csv" :encoding :sjis)
(io/write-file data "for_excel.csv" :encoding :sjis)

;; UTF-8 BOMä»˜ãï¼ˆExcelç”¨CSVï¼‰
(io/write-file csv-data "excel.csv" :encoding :utf-8-bom)

;; è‡ªå‹•æ¤œå‡ºï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸æ˜ãªãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
(io/read-file "unknown.txt" :encoding :auto)

;; ============================================
;; æ›¸ãè¾¼ã¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³
;; ============================================

;; ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨æ™‚ã®å‹•ä½œ
(io/write-file data "out.txt" :if-exists :error)      ;; å­˜åœ¨ã—ãŸã‚‰ã‚¨ãƒ©ãƒ¼
(io/write-file data "out.txt" :if-exists :skip)       ;; å­˜åœ¨ã—ãŸã‚‰ã‚¹ã‚­ãƒƒãƒ—
(io/write-file data "out.txt" :if-exists :append)     ;; è¿½è¨˜
(io/write-file data "out.txt" :if-exists :overwrite)  ;; ä¸Šæ›¸ãï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè‡ªå‹•ä½œæˆ
(io/write-file data "path/to/out.txt" :create-dirs true)

;; è¤‡æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³çµ„ã¿åˆã‚ã›
(io/write-file data "backup/data.csv"
               :encoding :sjis
               :if-exists :error
               :create-dirs true)

;; ============================================
;; å®Ÿç”¨ä¾‹ - å„å›½ã®Excel/ãƒ¬ã‚¬ã‚·ãƒ¼ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ
;; ============================================

;; æ—¥æœ¬: Excelç”¨CSVï¼ˆShift_JISï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "japan_excel.csv" :encoding :sjis)))

;; ä¸­å›½ï¼ˆç°¡ä½“å­—ï¼‰: Excelç”¨CSVï¼ˆGBKï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "china_excel.csv" :encoding :gbk)))

;; å°æ¹¾ãƒ»é¦™æ¸¯ï¼ˆç¹ä½“å­—ï¼‰: Excelç”¨CSVï¼ˆBig5ï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "taiwan_excel.csv" :encoding :big5)))

;; éŸ“å›½: Excelç”¨CSVï¼ˆEUC-KRï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "korea_excel.csv" :encoding :euc-kr)))

;; è¥¿æ¬§ãƒ»ç±³å›½: Excelç”¨CSVï¼ˆWindows-1252ï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "europe_excel.csv" :encoding :windows-1252)))

;; å¤šè¨€èªæ··åœ¨: UTF-16LEï¼ˆExcelæ¨å¥¨ã€BOMä»˜ãï¼‰
(data
 |> csv/stringify
 |> (fn [s] (io/write-file s "multilang_excel.csv" :encoding :utf-16le)))

;; ãƒ¬ã‚¬ã‚·ãƒ¼ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â†’ UTF-8å¤‰æ›
(io/read-file "legacy.csv" :encoding :sjis)
 |> csv/parse
 |> (map transform)
 |> csv/stringify
 |> (fn [s] (io/write-file s "modern_utf8.csv"))

;; ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸æ˜ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ¤œå‡º
(io/read-file "unknown.txt" :encoding :auto)
 |> process
 |> (fn [s] (io/write-file s "output.txt" :encoding :utf-8-bom))

;; å®‰å…¨ãªæ›¸ãè¾¼ã¿ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿è­·ï¼‰
(io/write-file data "important.txt"
               :if-exists :error
               :create-dirs true)

;; ============================================
;; ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ
;; ============================================

;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§å–å¾—
(io/list-dir ".")                                ;; ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
(io/list-dir "logs" :pattern "*.log")            ;; ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
(io/list-dir "src" :pattern "*.rs" :recursive true)  ;; å†å¸°çš„ã«æ¤œç´¢

;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ“ä½œ
(io/create-dir "data/backup")                    ;; è¦ªã‚‚è‡ªå‹•ä½œæˆ
(io/delete-dir "temp")                           ;; ç©ºãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‰Šé™¤
(io/delete-dir "old_data" :recursive true)       ;; ä¸­èº«ã”ã¨å‰Šé™¤

;; ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
(io/copy-file "data.txt" "data_backup.txt")      ;; ã‚³ãƒ”ãƒ¼
(io/move-file "old.txt" "new.txt")               ;; ç§»å‹•ãƒ»åå‰å¤‰æ›´
(io/delete-file "temp.txt")                      ;; å‰Šé™¤

;; ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
(def info (io/file-info "data.txt"))
(get info "size")                                ;; ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
(get info "modified")                            ;; æ›´æ–°æ—¥æ™‚ï¼ˆUNIXã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
(get info "is-dir")                              ;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹
(get info "is-file")                             ;; ãƒ•ã‚¡ã‚¤ãƒ«ã‹

;; åˆ¤å®š
(io/is-file? "data.txt")                         ;; true
(io/is-dir? "data")                              ;; true
(io/file-exists? "config.json")                  ;; true/false

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨çµ„ã¿åˆã‚ã›
("logs"
 |> (io/list-dir :pattern "*.log")
 |> (map io/read-file)
 |> (map process-log)
 |> (reduce merge))
```

**ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**:
- `io/temp-file` - ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰
- `io/temp-file-keep` - ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆå‰Šé™¤ã—ãªã„ï¼‰
- `io/temp-dir` - ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰
- `io/temp-dir-keep` - ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆï¼ˆå‰Šé™¤ã—ãªã„ï¼‰

```qi
;; ============================================
;; ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰
;; ============================================

;; ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ä½¿ç”¨ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ã«è‡ªå‹•å‰Šé™¤ï¼‰
(let [tmp (io/temp-file)]
  (io/write-file "temporary data" tmp)
  (process-file tmp))
;; ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ã«tmpã¯è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã‚‹

;; ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆï¼ˆè‡ªå‹•å‰Šé™¤ï¼‰
(let [tmpdir (io/temp-dir)]
  (io/write-file "data1" (path/join tmpdir "file1.txt"))
  (io/write-file "data2" (path/join tmpdir "file2.txt"))
  (process-directory tmpdir))
;; ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†æ™‚ã«tmpdirã¨ä¸­èº«ã¯è‡ªå‹•çš„ã«å‰Šé™¤ã•ã‚Œã‚‹

;; ============================================
;; ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå‰Šé™¤ã—ãªã„ï¼‰
;; ============================================

;; æ°¸ç¶šçš„ãªä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆæ‰‹å‹•ã§å‰Šé™¤ãŒå¿…è¦ï¼‰
(let [tmp (io/temp-file-keep)]
  (io/write-file "persistent data" tmp)
  (println f"Created: {tmp}")
  tmp)
;; => "/tmp/.tmpXXXXXX" ï¼ˆå‰Šé™¤ã•ã‚Œãªã„ï¼‰

;; æ°¸ç¶šçš„ãªä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
(let [tmpdir (io/temp-dir-keep)]
  (io/create-dir (path/join tmpdir "subdir"))
  tmpdir)
;; => "/tmp/.tmpXXXXXX" ï¼ˆå‰Šé™¤ã•ã‚Œãªã„ï¼‰

;; ============================================
;; å®Ÿç”¨ä¾‹: ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†
;; ============================================

;; å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã§å‡¦ç†
(defn process-large-data [url]
  (let [tmp (io/temp-file)]
    ;; ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
    (http/get url :output tmp)
    ;; ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†
    (let [result (process-file tmp)]
      ;; é–¢æ•°çµ‚äº†å¾Œã€tmpã¯è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹
      result)))

;; è¤‡æ•°ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨
(defn merge-files [files output]
  (let [tmpdir (io/temp-dir)
        processed (files
                   |> (map (fn [f]
                         (let [tmp (path/join tmpdir (path/basename f))]
                           (io/copy-file f tmp)
                           (process-file tmp)
                           tmp))))]
    ;; å‡¦ç†æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒ¼ã‚¸
    (merge-all processed output)
    ;; é–¢æ•°çµ‚äº†å¾Œã€tmpdirã¨ä¸­èº«ã¯è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹
    output))

;; ============================================
;; å®Ÿç”¨ä¾‹: ãƒ“ãƒ«ãƒ‰ã®ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
;; ============================================

;; ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä½œæˆã—ã¦ã‹ã‚‰ã‚³ãƒ”ãƒ¼
(defn build-project [source-dir output-dir]
  (let [build-dir (io/temp-dir)]
    (try
      (do
        ;; ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ãƒ“ãƒ«ãƒ‰
        (compile-sources source-dir build-dir)
        (run-tests build-dir)
        ;; æˆåŠŸã—ãŸã‚‰å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
        (io/copy-file build-dir output-dir)
        {:ok true})
      (async/catch e
        ;; ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã‚‚ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹
        {:error e})))))
```

**æ³¨æ„**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰å¼•æ•°ã‚’ä½¿ã†å ´åˆã¯ç„¡åé–¢æ•°ã§ãƒ©ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

##### âœ… path - ãƒ‘ã‚¹æ“ä½œ

ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ éä¾å­˜ã®ãƒ‘ã‚¹æ“ä½œã‚’æä¾›ã€‚

**ãƒ‘ã‚¹æ“ä½œ**:
- `path/join` - ãƒ‘ã‚¹çµåˆ
- `path/basename` - ãƒ•ã‚¡ã‚¤ãƒ«åå–å¾—
- `path/dirname` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåå–å¾—
- `path/extension` - æ‹¡å¼µå­å–å¾—
- `path/stem` - æ‹¡å¼µå­ãªã—ãƒ•ã‚¡ã‚¤ãƒ«åå–å¾—
- `path/absolute` - çµ¶å¯¾ãƒ‘ã‚¹åŒ–
- `path/normalize` - ãƒ‘ã‚¹æ­£è¦åŒ–

**ãƒ‘ã‚¹åˆ¤å®š**:
- `path/is-absolute?` - çµ¶å¯¾ãƒ‘ã‚¹åˆ¤å®š
- `path/is-relative?` - ç›¸å¯¾ãƒ‘ã‚¹åˆ¤å®š

```qi
;; ãƒ‘ã‚¹çµåˆ
(path/join "dir" "subdir" "file.txt")            ;; "dir/subdir/file.txt"
(path/join "/usr" "local" "bin")                 ;; "/usr/local/bin"

;; ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåå–å¾—
(path/basename "/path/to/file.txt")              ;; "file.txt"
(path/dirname "/path/to/file.txt")               ;; "/path/to"
(path/extension "file.txt")                      ;; "txt"
(path/extension "archive.tar.gz")                ;; "gz"
(path/stem "file.txt")                           ;; "file"
(path/stem "archive.tar.gz")                     ;; "archive.tar"

;; ãƒ‘ã‚¹æ­£è¦åŒ–
(path/normalize "a/./b/../c")                    ;; "a/c"
(path/normalize "/usr/local/../bin")             ;; "/usr/bin"

;; çµ¶å¯¾ãƒ‘ã‚¹åŒ–
(path/absolute "relative/path")                  ;; "/current/dir/relative/path"

;; ãƒ‘ã‚¹åˆ¤å®š
(path/is-absolute? "/usr/bin")                   ;; true
(path/is-absolute? "relative/path")              ;; false
(path/is-relative? "data/file.txt")              ;; true

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨çµ„ã¿åˆã‚ã›
("logs"
 |> io/list-dir
 |> (filter (fn [p] (= (path/extension p) "log")))
 |> (map (fn [p] (path/join "archive" (path/basename p))))
 |> (map (fn [dst] (io/copy-file (path/join "logs" (path/basename dst)) dst))))
```

##### âœ… env - ç’°å¢ƒå¤‰æ•°

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚„ç’°å¢ƒä¾å­˜ã®å€¤ã‚’ç®¡ç†ã€‚dotenvãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒãƒ¼ãƒˆã€‚

**ç’°å¢ƒå¤‰æ•°æ“ä½œ**:
- `env/get` - ç’°å¢ƒå¤‰æ•°å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å¯¾å¿œï¼‰
- `env/set` - ç’°å¢ƒå¤‰æ•°è¨­å®š
- `env/all` - å…¨ç’°å¢ƒå¤‰æ•°ã‚’ãƒãƒƒãƒ—ã§å–å¾—
- `env/load-dotenv` - .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿

```qi
;; ç’°å¢ƒå¤‰æ•°å–å¾—
(env/get "HOME")                                 ;; "/Users/username"
(env/get "PORT" "3000")                          ;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä»˜ã

;; ç’°å¢ƒå¤‰æ•°è¨­å®š
(env/set "API_KEY" "secret123")
(env/set "DEBUG" "true")

;; å…¨ç’°å¢ƒå¤‰æ•°å–å¾—
(def all-env (env/all))                          ;; {:PATH "..." :HOME "..." ...}

;; .envãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
(env/load-dotenv)                                ;; ".env"ã‚’èª­ã¿è¾¼ã¿
(env/load-dotenv ".env.production")              ;; ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«

;; .envãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼
;; # ã‚³ãƒ¡ãƒ³ãƒˆ
;; DATABASE_URL=postgresql://localhost:5432/mydb
;; API_KEY=secret123
;; DEBUG=true
;; HOST="0.0.0.0"
;; NAME='My App'

;; APIã‚µãƒ¼ãƒãƒ¼è¨­å®šä¾‹
(env/load-dotenv)
(def config
  {:port (to-int (env/get "PORT" "3000"))
   :host (env/get "HOST" "localhost")
   :db-url (env/get "DATABASE_URL")
   :debug (= (env/get "DEBUG" "false") "true")})
```

##### âœ… log - æ§‹é€ åŒ–ãƒ­ã‚°

ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œã®æ§‹é€ åŒ–ãƒ­ã‚°å‡ºåŠ›ã€‚ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€JSONå½¢å¼å¯¾å¿œã€‚

**ãƒ­ã‚°å‡ºåŠ›**:
- `log/debug` - DEBUGãƒ¬ãƒ™ãƒ«ãƒ­ã‚°
- `log/info` - INFOãƒ¬ãƒ™ãƒ«ãƒ­ã‚°
- `log/warn` - WARNãƒ¬ãƒ™ãƒ«ãƒ­ã‚°
- `log/error` - ERRORãƒ¬ãƒ™ãƒ«ãƒ­ã‚°

**è¨­å®š**:
- `log/set-level` - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®šï¼ˆdebug/info/warn/errorï¼‰
- `log/set-format` - å‡ºåŠ›å½¢å¼è¨­å®šï¼ˆtext/jsonï¼‰

```qi
;; åŸºæœ¬çš„ãªãƒ­ã‚°å‡ºåŠ›
(log/info "ã‚µãƒ¼ãƒãƒ¼èµ·å‹•")
;; => [2025-10-11T21:40:37.312+0900] INFO ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

;; æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ä»˜ããƒ­ã‚°
(log/info "APIå‘¼ã³å‡ºã—" {:method "GET" :path "/users" :status 200})
;; => [2025-10-11T21:40:37.312+0900] INFO APIå‘¼ã³å‡ºã— | method=GET path=/users status=200

;; ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
(log/error "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—" {:error "connection refused" :db "users"})

;; ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: infoï¼‰
(log/set-level "debug")                          ;; DEBUGä»¥ä¸Šã‚’å‡ºåŠ›
(log/set-level "warn")                           ;; WARNä»¥ä¸Šã®ã¿å‡ºåŠ›

;; JSONå½¢å¼ã§å‡ºåŠ›ï¼ˆæ§‹é€ åŒ–ãƒ­ã‚°ï¼‰
(log/set-format "json")
(log/info "APIå‘¼ã³å‡ºã—" {:method "GET" :path "/users" :status 200})
;; => {"timestamp":"2025-10-11T21:40:37.364+0900","level":"INFO","message":"APIå‘¼ã³å‡ºã—","method":"GET","path":"/users","status":"200"}

;; APIã‚µãƒ¼ãƒãƒ¼ã§ã®ä½¿ç”¨ä¾‹
(do
  (log/set-format "json")                        ;; æœ¬ç•ªç’°å¢ƒã¯JSON
  (log/set-level (if (env/get "DEBUG") "debug" "info"))

  (log/info "ã‚µãƒ¼ãƒãƒ¼èµ·å‹•" {:port 3000 :env "production"})

  ;; ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°
  (fn [request]
    (log/info "HTTP Request"
              {:method (get request :method)
               :path (get request :path)
               :ip (get request :ip)})))
```

##### âœ… async - ä¸¦è¡Œå‡¦ç†ï¼ˆé«˜åº¦ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ async/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === ãƒãƒ£ãƒãƒ«æ‹¡å¼µ ===
;; async/try-recv! - ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å—ä¿¡
;; async/select! - è¤‡æ•°ãƒãƒ£ãƒãƒ«ã‹ã‚‰é¸æŠçš„å—ä¿¡

;; === Structured Concurrency ===
;; async/make-scope - ã‚¹ã‚³ãƒ¼ãƒ—ä½œæˆ
;; async/scope-go - ã‚¹ã‚³ãƒ¼ãƒ—å†…ã§goroutineèµ·å‹•
;; async/with-scope - ã‚¹ã‚³ãƒ¼ãƒ—ä»˜ãå®Ÿè¡Œ
;; async/cancel! - ã‚­ãƒ£ãƒ³ã‚»ãƒ«
;; async/cancelled? - ã‚­ãƒ£ãƒ³ã‚»ãƒ«åˆ¤å®š

;; === ä¸¦åˆ—å‡¦ç† ===
;; async/pfilter - ä¸¦åˆ—ãƒ•ã‚£ãƒ«ã‚¿
;; async/preduce - ä¸¦åˆ—reduce
;; async/parallel-do - ä¸¦åˆ—å®Ÿè¡Œ

;; === Promise ===
;; async/await - Promiseå¾…æ©Ÿ
;; async/then - Promiseé€£é–
;; async/catch - Promiseã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
;; async/all - å…¨Promiseå¾…æ©Ÿ
;; async/race - æœ€åˆã®Promiseå¾…æ©Ÿ
```

##### âœ… pipeline - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ pipeline/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; pipeline/pipeline - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½œæˆ
;; pipeline/map - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³map
;; pipeline/filter - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³filter
;; pipeline/fan-out - è¤‡æ•°ã®å‡ºåŠ›ãƒãƒ£ãƒãƒ«ã«åˆ†é…
;; pipeline/fan-in - è¤‡æ•°ã®å…¥åŠ›ãƒãƒ£ãƒãƒ«ã‚’çµ±åˆ
```

##### âœ… stream - ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ stream/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === ã‚¹ãƒˆãƒªãƒ¼ãƒ ç”Ÿæˆ ===
;; stream/stream - ã‚¹ãƒˆãƒªãƒ¼ãƒ ä½œæˆ
;; stream/range - ç¯„å›²ã‚¹ãƒˆãƒªãƒ¼ãƒ 
;; stream/repeat - ç¹°ã‚Šè¿”ã—ã‚¹ãƒˆãƒªãƒ¼ãƒ 
;; stream/cycle - å¾ªç’°ã‚¹ãƒˆãƒªãƒ¼ãƒ 
;; stream/iterate - åå¾©ã‚¹ãƒˆãƒªãƒ¼ãƒ 
;; stream/file - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ 

;; === ã‚¹ãƒˆãƒªãƒ¼ãƒ å¤‰æ› ===
;; stream/take - nè¦ç´ å–å¾—
;; stream/drop - nè¦ç´ ã‚¹ã‚­ãƒƒãƒ—
;; stream/map - ãƒãƒƒãƒ—å¤‰æ›
;; stream/filter - ãƒ•ã‚£ãƒ«ã‚¿
;; stream/realize - ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’å®Ÿä½“åŒ–
```

##### âœ… zip - ZIPåœ§ç¸®ãƒ»è§£å‡

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ zip/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; zip/create - ZIPä½œæˆ
;; zip/extract - ZIPå±•é–‹
;; zip/list - ZIPå†…å®¹ä¸€è¦§
;; zip/add - ZIPã«è¿½åŠ 
;; zip/gzip - gzipåœ§ç¸®
;; zip/gunzip - gzipå±•é–‹
```

##### âœ… args - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ãƒ‘ãƒ¼ã‚¹

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ args/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; args/all - å…¨å¼•æ•°å–å¾—
(args/all)                          ;; => ["arg1" "arg2" "arg3"]

;; args/get - æŒ‡å®šä½ç½®ã®å¼•æ•°å–å¾—
(args/get 0)                        ;; => "arg1"
(args/get 1 "default")              ;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä»˜ã

;; args/count - å¼•æ•°ã®æ•°
(args/count)                        ;; => 3

;; args/parse - å¼•æ•°ã‚’ãƒ‘ãƒ¼ã‚¹
(args/parse)                        ;; => {"_" ["file.qi"] "port" "3000" "debug" true}
;; qi script.qi --port 3000 --debug
```

##### âœ… db - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

**æ¦‚è¦**:
- **çµ±ä¸€API**: è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **æ¨™æº–ã‚µãƒãƒ¼ãƒˆ**: SQLiteï¼ˆçµ„ã¿è¾¼ã¿ã€å¤–éƒ¨ä¾å­˜ãªã—ï¼‰
- **æ‹¡å¼µå¯èƒ½**: PostgreSQLã€MySQLã€DuckDBç­‰ã¯å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æä¾›äºˆå®š
- **ã‚»ã‚­ãƒ¥ã‚¢API**: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ + ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ©Ÿèƒ½

âœ… å®Ÿè£…æ¸ˆã¿:
```qi
db/connect              ;; ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶š
db/query                ;; SQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼ˆè¤‡æ•°è¡Œï¼‰
db/query-one            ;; SQLã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œï¼ˆ1è¡Œã®ã¿ï¼‰
db/exec                 ;; SQLæ–‡ã‚’å®Ÿè¡Œï¼ˆINSERT/UPDATE/DELETEï¼‰
db/close                ;; æ¥ç¶šã‚’é–‰ã˜ã‚‹
db/sanitize             ;; å€¤ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º
db/sanitize-identifier  ;; è­˜åˆ¥å­ã‚’ã‚µãƒ‹ã‚¿ã‚¤ã‚º
db/escape-like          ;; LIKEå¥ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
db/begin                ;; ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
db/commit               ;; ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒŸãƒƒãƒˆ
db/rollback             ;; ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
```

**Phase 2 æ©Ÿèƒ½** (ğŸš§ éƒ¨åˆ†å®Ÿè£…):
- âœ… ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³: `db/begin`, `db/commit`, `db/rollback` - å®Ÿè£…æ¸ˆã¿
- ğŸš§ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿API: `db/tables`, `db/columns`, `db/indexes`, `db/foreign-keys` - æœªå®Ÿè£…
- ğŸš§ ã‚¹ãƒˆã‚¢ãƒ‰å®Ÿè¡Œ: `db/call` (é–¢æ•°ã®RETURNå€¤ã€ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã®OUT/INOUT/çµæœã‚»ãƒƒãƒˆå¯¾å¿œ) - æœªå®Ÿè£…
- ğŸš§ ã‚¯ã‚¨ãƒªæƒ…å ±: `db/query-info` - æœªå®Ÿè£…
- ğŸš§ æ©Ÿèƒ½æ¤œå‡º: `db/supports?`, `db/driver-info` - æœªå®Ÿè£…

**Phase 3 æ©Ÿèƒ½** (ğŸš§ æœªå®Ÿè£…):
- ğŸš§ ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒªãƒ³ã‚° - æœªå®Ÿè£…

**åŸºæœ¬çš„ãªä½¿ã„æ–¹**:
```qi
;; æ¥ç¶šï¼ˆSQLiteï¼‰
(def conn (db/connect "sqlite:app.db"))
(def conn (db/connect "sqlite::memory:"))  ;; ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDB

;; æ¥ç¶šã‚ªãƒ—ã‚·ãƒ§ãƒ³
(def conn (db/connect "sqlite:app.db" {
  "timeout" 30000        ;; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ms)
  "read-only" false      ;; èª­ã¿å–ã‚Šå°‚ç”¨
}))

;; ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
(db/exec conn "CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)" [])

;; ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½¿ç”¨ï¼‰
(db/exec conn "INSERT INTO users (name, age) VALUES (?, ?)" ["Alice" 30])
(db/exec conn "INSERT INTO users (name, age) VALUES (?, ?)" ["Bob" 25])

;; å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—
(def users (db/query conn "SELECT * FROM users" []))
;; => [{"id" 1 "name" "Alice" "age" 30} {"id" 2 "name" "Bob" "age" 25}]

;; æ¡ä»¶ä»˜ãå–å¾—
(def alice (db/query-one conn "SELECT * FROM users WHERE name = ?" ["Alice"]))
;; => {"id" 1 "name" "Alice" "age" 30}

;; æ›´æ–°
(def affected (db/exec conn "UPDATE users SET age = ? WHERE name = ?" [31 "Alice"]))
;; => 1

;; å‰Šé™¤
(def deleted (db/exec conn "DELETE FROM users WHERE id = ?" [2]))
;; => 1

;; æ¥ç¶šã‚’é–‰ã˜ã‚‹
(db/close conn)
```

**ã‚¯ã‚¨ãƒªã‚ªãƒ—ã‚·ãƒ§ãƒ³**:
```qi
;; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€limitã€offsetæŒ‡å®š
(db/query conn "SELECT * FROM users" [] {
  "timeout" 5000    ;; ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ(ms)
  "limit" 10        ;; æœ€å¤§å–å¾—è¡Œæ•°
  "offset" 20       ;; ã‚¹ã‚­ãƒƒãƒ—è¡Œæ•°
})
```

**ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆå‹•çš„SQLç”¨ï¼‰**:
```qi
;; âš ï¸ åŸºæœ¬çš„ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼(?)ã‚’ä½¿ç”¨ã™ã¹ã
;; ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã¯å‹•çš„SQLæ§‹ç¯‰æ™‚ã®ã¿ä½¿ç”¨

;; å€¤ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå¯¾å¿œï¼‰
(db/sanitize conn "O'Reilly")
;; => "O''Reilly"

;; è­˜åˆ¥å­ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«åã€ã‚«ãƒ©ãƒ åï¼‰
(db/sanitize-identifier conn "user_name")
;; => "\"user_name\""

;; LIKEå¥ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
(db/escape-like conn "50%_off")
;; => "50\\%\\_off"
```

**å®‰å…¨ãªã‚¯ã‚¨ãƒªä¾‹**:
```qi
;; âœ… æ¨å¥¨: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ä½¿ç”¨
(db/query conn "SELECT * FROM users WHERE age > ?" [min-age])

;; âš ï¸ å‹•çš„ã‚«ãƒ©ãƒ å: sanitize-identifierä½¿ç”¨
(def col-name (db/sanitize-identifier conn user-input))
(def sql (str "SELECT " col-name " FROM users"))
(db/query conn sql [])

;; âš ï¸ LIKEæ¤œç´¢: escape-likeä½¿ç”¨
(def pattern (db/escape-like conn user-search))
(db/query conn "SELECT * FROM products WHERE name LIKE ? ESCAPE '\\'"
          [(str "%" pattern "%")])
```

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã®çµ„ã¿åˆã‚ã›**:
```qi
;; ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
(db/query conn "SELECT * FROM users WHERE age > ?" [25])
  |> (filter (fn [u] (str/starts-with? (get u "name") "A")))
  |> (map (fn [u] (assoc u "senior" true)))
  |> (take 10)

;; CSV â†’ DB ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
(io/read-file "users.csv")
  |> csv/parse
  |> (map (fn [row]
            (db/exec conn
                     "INSERT INTO users (name, age) VALUES (?, ?)"
                     [(get row "name") (to-int (get row "age"))])))
```

**å°†æ¥ã®æ‹¡å¼µï¼ˆPhase 2+ï¼‰**:
```qi
;; ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPhase 2ï¼‰
(db/transaction conn
  (fn []
    (db/exec conn "INSERT INTO accounts ..." [...])
    (db/exec conn "UPDATE balance ..." [...]))
  {"isolation" "serializable" "timeout" 10000})

;; ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿APIï¼ˆPhase 2ï¼‰
(db/tables conn)
;; => ["users" "products" "orders"]

(db/columns conn "users")
;; => [{"name" "id" "type" "INTEGER" "nullable" false "primary-key" true}
;;     {"name" "name" "type" "TEXT" "nullable" false}]

;; ã‚¹ãƒˆã‚¢ãƒ‰ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£/ãƒ•ã‚¡ãƒ³ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼ˆPhase 2ï¼‰
;; é–¢æ•°ï¼ˆRETURNå€¤ã‚ã‚Šï¼‰
(db/call conn "add" [1 2])
;; => 3

;; ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ï¼ˆçµæœã‚»ãƒƒãƒˆï¼‰
(db/call conn "get_users_by_age" [25])
;; => [{"id" 1 "name" "Alice" "age" 30} ...]

;; ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ï¼ˆOUTãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
(db/call conn "calc" [2 3] {"out" ["sum" "product"]})
;; => {"out" {"sum" 5 "product" 6}}

;; ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ï¼ˆINOUTãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
(db/call conn "increment" [10] {"inout" ["value"]})
;; => {"inout" {"value" 11}}

;; è¤‡æ•°çµæœã‚»ãƒƒãƒˆ + OUTãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
(db/call conn "complex_proc" [arg1] {"out" ["status" "message"]})
;; => {"result-sets" [[rows1...] [rows2...]]
;;     "out" {"status" 0 "message" "Success"}}

;; æ©Ÿèƒ½æ¤œå‡º
(db/supports? conn "stored-procedures")
;; => true (PostgreSQL, MySQL) / false (SQLite)

;; å¤–éƒ¨DBï¼ˆå¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦æä¾›äºˆå®šï¼‰
(db/connect "postgresql://localhost/mydb")
(db/connect "mysql://user:pass@localhost/mydb")
(db/connect "duckdb:analytics.db")
```

**è¨­è¨ˆæ€æƒ³**:
- **çµ±ä¸€API**: Python DBAPI 2.0ã‚„Go database/sqlã®ã‚ˆã†ãªçµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ãƒ‰ãƒ©ã‚¤ãƒãƒ¼åˆ†é›¢**: SQLiteã¯æ¨™æº–ã€ä»–DBã¯å¤–éƒ¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- **å®‰å…¨ç¬¬ä¸€**: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼æ¨å¥¨ã€ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã¯è£œåŠ©çš„
- **ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—è²¬ä»»**: å„ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒDBå›ºæœ‰ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ«ã‚’å®Ÿè£…
- **Phaseåˆ†ã‘**: Phase 1(åŸºæœ¬), Phase 2(ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿), Phase 3(ãƒ—ãƒ¼ãƒªãƒ³ã‚°)

#### âœ… str - æ–‡å­—åˆ—æ“ä½œï¼ˆã»ã¼å®Œå…¨å®Ÿè£…ï¼‰

```qi
;; ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã¯ str/ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å±ã—ã¾ã™

;; === æ¤œç´¢ ===

;; str/contains? - éƒ¨åˆ†æ–‡å­—åˆ—ã‚’å«ã‚€ã‹åˆ¤å®š
(str/contains? "hello world" "world")     ;; => true

;; str/starts-with? - å‰æ–¹ä¸€è‡´åˆ¤å®š
(str/starts-with? "hello" "he")           ;; => true

;; str/ends-with? - å¾Œæ–¹ä¸€è‡´åˆ¤å®š
(str/ends-with? "hello" "lo")             ;; => true

;; str/index-of - æœ€åˆã®å‡ºç¾ä½ç½®
(str/index-of "hello world" "world")      ;; => 6

;; str/last-index-of - æœ€å¾Œã®å‡ºç¾ä½ç½®
(str/last-index-of "hello hello" "hello") ;; => 6

;; === åŸºæœ¬å¤‰æ› ===

;; str/upper - å¤§æ–‡å­—åŒ–
(str/upper "hello")                       ;; => "HELLO"

;; str/lower - å°æ–‡å­—åŒ–
(str/lower "HELLO")                       ;; => "hello"

;; str/capitalize - å…ˆé ­ã®ã¿å¤§æ–‡å­—
(str/capitalize "hello")                  ;; => "Hello"

;; str/title - ã‚¿ã‚¤ãƒˆãƒ«ã‚±ãƒ¼ã‚¹
(str/title "hello world")                 ;; => "Hello World"

;; str/trim - å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
(str/trim "  hello  ")                    ;; => "hello"

;; str/trim-left - å·¦å´ã®ç©ºç™½ã‚’å‰Šé™¤
(str/trim-left "  hello  ")               ;; => "hello  "

;; str/trim-right - å³å´ã®ç©ºç™½ã‚’å‰Šé™¤
(str/trim-right "  hello  ")              ;; => "  hello"

;; str/repeat - æ–‡å­—åˆ—ã‚’ç¹°ã‚Šè¿”ã—
(str/repeat "-" 80)                       ;; => "----..." (80å€‹)
(str/repeat "ab" 3)                       ;; => "ababab"

;; str/reverse - æ–‡å­—åˆ—ã‚’é€†é †ã«
(str/reverse "hello")                     ;; => "olleh"

;; === ã‚±ãƒ¼ã‚¹å¤‰æ› ===

;; str/snake - ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
(str/snake "userName")                    ;; => "user_name"

;; str/camel - ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
(str/camel "user_name")                   ;; => "userName"

;; str/kebab - ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
(str/kebab "userName")                    ;; => "user-name"

;; str/pascal - ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
(str/pascal "user_name")                  ;; => "UserName"

;; str/split-camel - ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ã‚’åˆ†å‰²
(str/split-camel "userName")              ;; => ["user" "Name"]

;; === åˆ†å‰²ãƒ»çµåˆ ===

;; str/split - æ–‡å­—åˆ—ã‚’åˆ†å‰²
(str/split "a,b,c" ",")                   ;; => ["a" "b" "c"]

;; str/lines - è¡Œã«åˆ†å‰²
(str/lines "hello\nworld")                ;; => ["hello" "world"]

;; str/words - å˜èªã«åˆ†å‰²
(str/words "hello world")                 ;; => ["hello" "world"]

;; str/chars - æ–‡å­—ã«åˆ†å‰²
(str/chars "hello")                       ;; => ["h" "e" "l" "l" "o"]

;; === ç½®æ› ===

;; str/replace - å…¨ã¦ç½®æ›
(str/replace "hello world" "world" "qi")  ;; => "hello qi"

;; str/replace-first - æœ€åˆã®1ã¤ã®ã¿ç½®æ›
(str/replace-first "aa bb aa" "aa" "cc")  ;; => "cc bb aa"

;; str/splice - ç¯„å›²ã‚’ç½®æ›
(str/splice "hello world" 6 11 "universe") ;; => "hello universe"

;; === éƒ¨åˆ†æ–‡å­—åˆ— ===

;; str/slice - ç¯„å›²ã‚’å–å¾—
(str/slice "hello world" 0 5)             ;; => "hello"

;; str/take - å…ˆé ­næ–‡å­—ã‚’å–å¾—
(str/take "hello" 3)                      ;; => "hel"

;; str/drop - å…ˆé ­næ–‡å­—ã‚’å‰Šé™¤
(str/drop "hello" 2)                      ;; => "llo"

;; str/sub-before - åŒºåˆ‡ã‚Šæ–‡å­—ã‚ˆã‚Šå‰ã‚’å–å¾—
(str/sub-before "user@example.com" "@")   ;; => "user"

;; str/sub-after - åŒºåˆ‡ã‚Šæ–‡å­—ã‚ˆã‚Šå¾Œã‚’å–å¾—
(str/sub-after "user@example.com" "@")    ;; => "example.com"

;; === æ•´å½¢ãƒ»é…ç½® ===

;; str/pad-left - å·¦è©°ã‚
(str/pad-left "Total" 20)                 ;; => "               Total"

;; str/pad-right - å³è©°ã‚
(str/pad-right "Name" 20)                 ;; => "Name               "

;; str/pad - ä¸­å¤®æƒãˆ
(str/pad "hi" 10)                         ;; => "    hi    "
(str/pad "hi" 10 "*")                     ;; => "****hi****"

;; str/truncate - é•·ã•ã‚’åˆ¶é™
(str/truncate "hello world" 8)            ;; => "hello..."

;; str/trunc-words - å˜èªæ•°ã‚’åˆ¶é™
(str/trunc-words "hello world from qi" 2) ;; => "hello world..."

;; str/indent - ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè¿½åŠ 
(str/indent "hello\nworld" 2)             ;; => "  hello\n  world"

;; str/wrap - æŒ‡å®šå¹…ã§æŠ˜ã‚Šè¿”ã—
(str/wrap "hello world from qi" 10)       ;; => "hello\nworld from\nqi"

;; === æ­£è¦åŒ– ===

;; str/squish - é€£ç¶šç©ºç™½ã‚’1ã¤ã«ï¼ˆå‰å¾Œtrimè¾¼ã¿ï¼‰
(str/squish "  hello   world  \n")        ;; => "hello world"

;; str/expand-tabs - ã‚¿ãƒ–ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›
(str/expand-tabs "\thello\tworld")        ;; => "    hello    world"

;; === åˆ¤å®šï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ ===

;; str/digit? - æ•°å­—ã®ã¿ã‹åˆ¤å®š
(str/digit? "12345")                      ;; => true

;; str/alpha? - ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã®ã¿ã‹åˆ¤å®š
(str/alpha? "hello")                      ;; => true

;; str/alnum? - è‹±æ•°å­—ã®ã¿ã‹åˆ¤å®š
(str/alnum? "hello123")                   ;; => true

;; str/space? - ç©ºç™½æ–‡å­—ã®ã¿ã‹åˆ¤å®š
(str/space? "  \n\t")                     ;; => true

;; str/numeric? - æ•°å€¤è¡¨ç¾ã‹åˆ¤å®š
(str/numeric? "123.45")                   ;; => true

;; str/integer? - æ•´æ•°è¡¨ç¾ã‹åˆ¤å®š
(str/integer? "123")                      ;; => true

;; str/blank? - ç©ºç™½ã¾ãŸã¯ç©ºæ–‡å­—åˆ—ã‹åˆ¤å®š
(str/blank? "  \n")                       ;; => true

;; str/ascii? - ASCIIæ–‡å­—ã®ã¿ã‹åˆ¤å®š
(str/ascii? "hello")                      ;; => true

;; str/lower? - å…¨ã¦å°æ–‡å­—ã‹åˆ¤å®š
(str/lower? "hello")                      ;; => true

;; str/upper? - å…¨ã¦å¤§æ–‡å­—ã‹åˆ¤å®š
(str/upper? "HELLO")                      ;; => true

;; === URL/Web ===

;; str/slugify - URL/ãƒ•ã‚¡ã‚¤ãƒ«åç”¨ã«å¤‰æ›
(str/slugify "Hello World! 2024")         ;; => "hello-world-2024"
(str/slugify "CafÃ© rÃ©sumÃ©")               ;; => "cafe-resume"

;; str/url-encode - URLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
(str/url-encode "hello world")            ;; => "hello%20world"

;; str/url-decode - URLãƒ‡ã‚³ãƒ¼ãƒ‰
(str/url-decode "hello%20world")          ;; => "hello world"

;; str/html-encode - HTMLã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
(str/html-encode "<div>test</div>")       ;; => "&lt;div&gt;test&lt;/div&gt;"

;; str/html-decode - HTMLãƒ‡ã‚³ãƒ¼ãƒ‰
(str/html-decode "&lt;div&gt;test&lt;/div&gt;") ;; => "<div>test</div>"

;; === ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ ===

;; str/to-base64 - Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
(str/to-base64 "hello")                   ;; => "aGVsbG8="

;; str/from-base64 - Base64ãƒ‡ã‚³ãƒ¼ãƒ‰
(str/from-base64 "aGVsbG8=")              ;; => "hello"

;; === ãƒ‘ãƒ¼ã‚¹ ===

;; str/parse-int - æ•´æ•°ã«ãƒ‘ãƒ¼ã‚¹
(str/parse-int "123")                     ;; => 123

;; str/parse-float - æµ®å‹•å°æ•°ç‚¹æ•°ã«ãƒ‘ãƒ¼ã‚¹
(str/parse-float "3.14")                  ;; => 3.14

;; === Unicode ===

;; str/chars-count - Unicodeæ–‡å­—æ•°
(str/chars-count "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦")                ;; => 1

;; str/bytes-count - ãƒã‚¤ãƒˆæ•°
(str/bytes-count "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦")                ;; => 25

;; === ç”Ÿæˆ ===

;; str/hash - ãƒãƒƒã‚·ãƒ¥å€¤ç”Ÿæˆ
(str/hash "hello")                        ;; => "2cf24dba5fb0a30e..."
(str/hash "hello" :sha256)                ;; SHA-256 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)

;; str/uuid - UUIDç”Ÿæˆ
(str/uuid)                                ;; => "550e8400-e29b-41d4-a716-446655440000"

;; === NLP ===

;; str/word-count - å˜èªæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
(str/word-count "hello world")            ;; => 2

;; === ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ===

;; str/format - ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç½®æ›
(str/format "Hello, {}!" "World")         ;; => "Hello, World!"
(str/format "{} + {} = {}" 1 2 3)         ;; => "1 + 2 = 3"

;; str/format-decimal - å°æ•°ç‚¹æ¡æ•°æŒ‡å®š
(str/format-decimal 2 3.14159)            ;; => "3.14"
(3.14159 |> (str/format-decimal 2))       ;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨

;; str/format-comma - 3æ¡ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š
(str/format-comma 1234567)                ;; => "1,234,567"
(1234567 |> str/format-comma)             ;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ç”¨

;; str/format-percent - ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨ç¤º
(str/format-percent 0.1234)               ;; => "12%"
(str/format-percent 2 0.1234)             ;; => "12.34%"
(0.856 |> (str/format-percent 1))         ;; => "85.6%"
```

**ä½¿ç”¨ä¾‹: ä¾¡æ ¼è¡¨ç¤ºãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**
```qi
(defn format-price [price]
  (price
   |> str/format-comma
   |> (fn [s] (str "Â¥" s))))

(format-price 1234567)  ;; => "Â¥1,234,567"
```

**ä½¿ç”¨ä¾‹: ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
```qi
(defn gen-report [data]
  f"""
  Sales Report
  ============
  Total: {(str/format-comma (get data "total"))}
  Growth: {(str/format-percent 1 (get data "growth"))}
  """)

(gen-report {"total" 1234567 "growth" 0.156})
;; =>
;; Sales Report
;; ============
;; Total: 1,234,567
;; Growth: 15.6%
```

#### âœ… markdown - Markdownç”Ÿæˆãƒ»è§£æï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**Pure Rustå®Ÿè£… - å¤–éƒ¨ä¾å­˜ãªã—**

Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆãƒ»åŠ å·¥ãƒ»è§£ææ©Ÿèƒ½ã‚’æä¾›ã€‚ç‰¹ã«LLMã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã€ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆã€**Literate Programming**ã«æœ€é©ã€‚HTML/PDFå¤‰æ›ã¯`pandoc`ãªã©å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã«å§”ä»»ã™ã‚‹è¨­è¨ˆã§ã€è»½é‡ã‹ã¤ä¿å®ˆã—ã‚„ã™ã„å®Ÿè£…ã€‚

**ç”Ÿæˆé–¢æ•°ï¼ˆPhase 1ï¼‰**:
- `markdown/header` - è¦‹å‡ºã—ç”Ÿæˆï¼ˆãƒ¬ãƒ™ãƒ«1-6ï¼‰
- `markdown/list` - ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆ
- `markdown/ordered-list` - ç•ªå·ä»˜ããƒªã‚¹ãƒˆ
- `markdown/table` - ãƒ†ãƒ¼ãƒ–ãƒ«ç”Ÿæˆ
- `markdown/code-block` - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯
- `markdown/link` - ãƒã‚¤ãƒ‘ãƒ¼ãƒªãƒ³ã‚¯
- `markdown/image` - ç”»åƒè¨˜æ³•
- `markdown/join` - è¤‡æ•°è¦ç´ ã®çµåˆ

**è§£æé–¢æ•°ï¼ˆPhase 2 - æ–°æ©Ÿèƒ½ï¼ï¼‰**:
- `markdown/extract-code-blocks` - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯æŠ½å‡ºï¼ˆ**è¶…é‡è¦ï¼**ï¼‰
- `markdown/parse` - Markdown â†’ AST
- `markdown/stringify` - AST â†’ Markdown

```qi
;; åŸºæœ¬çš„ãªç”Ÿæˆ
(markdown/header 1 "Title")
;; => "# Title"

(markdown/list ["Item 1" "Item 2" "Item 3"])
;; => "- Item 1\n- Item 2\n- Item 3"

(markdown/ordered-list ["First" "Second" "Third"])
;; => "1. First\n2. Second\n3. Third"

(markdown/table [["Name" "Score"] ["Alice" "95"] ["Bob" "87"]])
;; => "| Name | Score |\n| --- | --- |\n| Alice | 95 |\n| Bob | 87 |"

(markdown/code-block "qi" "(+ 1 2)")
;; => "```qi\n(+ 1 2)\n```"

(markdown/link "GitHub" "https://github.com")
;; => "[GitHub](https://github.com)"

(markdown/image "Logo" "logo.png")
;; => "![Logo](logo.png)"

;; âœ¨ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®Markdownçµ„ã¿ç«‹ã¦
(markdown/join
  [(markdown/header 1 "Report")
   (markdown/list ["Point 1" "Point 2"])
   "Some content"])
;; => "# Report\n\n- Point 1\n- Point 2\n\nSome content"
```

**å®Ÿç”¨ä¾‹1: LLMã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ**
```qi
;; ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ
(defn create-review-prompt [code questions]
  (markdown/join
    [(markdown/header 1 "Code Review Request")
     (markdown/code-block "qi" code)
     (markdown/header 2 "Questions")
     (markdown/list questions)
     (markdown/header 2 "Context")
     (markdown/table [["Language" "Version"] ["Qi" "0.1.0"]])]))

;; ä½¿ç”¨ä¾‹
(create-review-prompt
  "(def factorial (fn [n]\n  (if (<= n 1) 1 (* n (factorial (dec n))))))"
  ["Is this implementation efficient?"
   "Any improvements?"
   "How to handle large numbers?"])
;; LLMã«ç›´æ¥æ¸¡ã›ã‚‹æ•´å½¢æ¸ˆã¿Markdownã‚’ç”Ÿæˆ
```

**å®Ÿç”¨ä¾‹2: ãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**
```qi
;; CSVãƒ‡ãƒ¼ã‚¿ã‹ã‚‰Markdownãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
(defn generate-sales-report [csv-file]
  (let [data (csv/read-file csv-file)
        header (first data)
        rows (rest data)
        total (rows |> (map (fn [r] (str/parse-int (nth r 2)))) |> sum)]
    (markdown/join
      [(markdown/header 1 "Sales Report")
       (markdown/header 2 "Summary")
       (str "Total Sales: $" total)
       (markdown/header 2 "Details")
       (markdown/table data)
       (markdown/header 2 "Notes")
       (markdown/list
         ["Report generated automatically"
          (str "Date: " (time/today))
          (str "Total records: " (len rows))])])))

;; ä½¿ç”¨ä¾‹
(generate-sales-report "sales.csv"
 |> (io/write-file "report.md"))

;; HTMLå¤‰æ›ï¼ˆå¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æºï¼‰
(cmd/sh "pandoc report.md -o report.html")
```

**å®Ÿç”¨ä¾‹3: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**
```qi
;; APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
(defn document-api [endpoints]
  (let [sections
        (endpoints
         |> (map (fn [ep]
                  (markdown/join
                    [(markdown/header 3 (:name ep))
                     (markdown/code-block "http"
                       (str (:method ep) " " (:path ep)))
                     (:description ep)
                     (markdown/header 4 "Parameters")
                     (markdown/table
                       (cons ["Name" "Type" "Required"]
                             (:params ep)))]))))]
    (markdown/join
      [(markdown/header 1 "API Documentation")
       (markdown/header 2 "Endpoints")
       (markdown/join sections)])))

;; ä½¿ç”¨ä¾‹
(def api-spec
  [{:name "Get User"
    :method "GET"
    :path "/api/users/:id"
    :description "Retrieve user information"
    :params [["id" "integer" "Yes"]
             ["include" "string" "No"]]}
   {:name "Create User"
    :method "POST"
    :path "/api/users"
    :description "Create a new user"
    :params [["name" "string" "Yes"]
             ["email" "string" "Yes"]]}])

(document-api api-spec
 |> (io/write-file "api.md"))
```

**è¨­è¨ˆå“²å­¦**:
- **è»½é‡**: Pure Rustå®Ÿè£…ã€å¤–éƒ¨ä¾å­˜ãªã—
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å¿—å‘**: ãƒ‡ãƒ¼ã‚¿ãŒå·¦ã‹ã‚‰å³ã¸æµã‚Œã‚‹è‡ªç„¶ãªè¨˜è¿°
- **LLMæ™‚ä»£å¯¾å¿œ**: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã«æœ€é©
- **æ‹¡å¼µæ€§**: åŸºæœ¬æ©Ÿèƒ½ã«é›†ä¸­ã€è¤‡é›‘ãªå‡¦ç†ã¯å¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã«å§”ä»»

**å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æº**:
```qi
;; HTMLå¤‰æ›
(cmd/sh "pandoc doc.md -o doc.html")

;; PDFå¤‰æ›
(cmd/sh "pandoc doc.md -o doc.pdf")

;; GitHub Flavored Markdown
(cmd/sh "pandoc doc.md -f gfm -o doc.html")
```

**Phase 2å®Ÿç”¨ä¾‹1: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯æŠ½å‡ºã¨ãƒ•ã‚£ãƒ«ã‚¿**
```qi
;; Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ç‰¹å®šè¨€èªã®ã‚³ãƒ¼ãƒ‰ã ã‘æŠ½å‡º
(defn extract-qi-code [md-file]
  (md-file
   |> io/read-file
   |> markdown/extract-code-blocks
   |> (filter (fn [b] (= (get b "lang") "qi")))
   |> (map (fn [b] (get b "code")))))

;; ä½¿ç”¨ä¾‹
(extract-qi-code "README.md")
;; => ["(def x 42)" "(println x)" ...]

;; è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä¸€æ‹¬æŠ½å‡º
(defn collect-all-examples []
  (io/list-dir "docs"
   |> (filter (fn [f] (str/ends-with? f ".md")))
   |> (map extract-qi-code)
   |> flatten))
```

**Phase 2å®Ÿç”¨ä¾‹2: Literate Programming - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé§†å‹•é–‹ç™º**
```qi
;; Markdownãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰è‡ªå‹•ãƒ†ã‚¹ãƒˆç”Ÿæˆ
(defn run-doc-tests [md-file]
  (let [blocks (md-file
                |> io/read-file
                |> markdown/extract-code-blocks
                |> (filter (fn [b] (= (get b "lang") "qi"))))]
    (map
      (fn [block]
        (let [code (get block "code")]
          (println "Testing:" code)
          (try
            (do (eval code) (println "âœ“ Pass"))
            (async/catch e (println "âœ— Fail:" e)))))
      blocks)))

;; ä½¿ç”¨ä¾‹: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ã®å…¨ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ãƒ†ã‚¹ãƒˆ
(run-doc-tests "TUTORIAL.md")
```

**Phase 2å®Ÿç”¨ä¾‹3: Markdown ASTå¤‰æ›**
```qi
;; Markdownã®è¦‹å‡ºã—ãƒ¬ãƒ™ãƒ«ã‚’ä¸€æ‹¬èª¿æ•´
(defn adjust-header-levels [md-text offset]
  (md-text
   |> markdown/parse
   |> (map (fn [block]
            (if (= (get block "type") "header")
              (assoc block "level" (+ (get block "level") offset))
              block)))
   |> markdown/stringify))

;; ä½¿ç”¨ä¾‹: å…¨ã¦ã®è¦‹å‡ºã—ã‚’1ãƒ¬ãƒ™ãƒ«ä¸‹ã’ã‚‹
(adjust-header-levels "# Title\n## Subtitle" 1)
;; => "## Title\n### Subtitle"

;; Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã ã‘è¨€èªã‚¿ã‚°ã‚’å¤‰æ›´
(defn change-code-lang [md-text from-lang to-lang]
  (md-text
   |> markdown/parse
   |> (map (fn [block]
            (if (and (= (get block "type") "code-block")
                     (= (get block "lang") from-lang))
              (assoc block "lang" to-lang)
              block)))
   |> markdown/stringify))
```

**Phase 2å®Ÿç”¨ä¾‹4: Markdownçµåˆã¨æ•´å½¢**
```qi
;; è¤‡æ•°ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ±åˆã—ã¦ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
(defn generate-combined-report [files]
  (let [sections
        (files
         |> (map (fn [f]
                  (let [ast (f |> io/read-file |> markdown/parse)]
                    ;; ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒºåˆ‡ã‚Šã‚’è¿½åŠ 
                    (cons {:type "header" :level 1 :text f}
                          ast))))
         |> flatten)]
    (markdown/stringify sections)))

;; ä½¿ç”¨ä¾‹
(generate-combined-report ["intro.md" "features.md" "api.md"]
 |> (io/write-file "COMBINED_REPORT.md"))
```

#### âœ… regex - æ­£è¦è¡¨ç¾ï¼ˆåŸºæœ¬å®Ÿè£…ï¼‰

**å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½**:
- `str/re-find` - ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼ˆæœ€åˆã®ä¸€è‡´ã‚’æ¤œç´¢ï¼‰
- `str/re-matches` - å®Œå…¨ãƒãƒƒãƒãƒã‚§ãƒƒã‚¯ï¼ˆæ–‡å­—åˆ—å…¨ä½“ãŒãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã™ã‚‹ã‹ï¼‰
- `str/re-replace` - æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹ç½®æ›

```qi
(use str :as s)

;; ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ - æœ€åˆã®ä¸€è‡´ã‚’æ¤œç´¢
(s/re-find "hello123world" "\\d+")
;; => "123"

;; å®Œå…¨ãƒãƒƒãƒãƒã‚§ãƒƒã‚¯ - æ–‡å­—åˆ—å…¨ä½“ãŒãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã™ã‚‹ã‹
(s/re-matches "hello123" "\\w+")
;; => true

(s/re-matches "hello 123" "\\w+")
;; => false (ã‚¹ãƒšãƒ¼ã‚¹ãŒã‚ã‚‹ãŸã‚)

;; ç½®æ› - ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã™ã‚‹éƒ¨åˆ†ã‚’ç½®æ›
(s/re-replace "hello123world456" "\\d+" "X")
;; => "helloXworldX"

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã®ä½¿ç”¨
("hello123world" |> (s/re-find "\\d+"))
;; => "123"

;; å®Ÿç”¨ä¾‹: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æŠ½å‡º
(defn extract-email [text]
  (s/re-find text "[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}"))

(extract-email "Contact: test@example.com for details")
;; => "test@example.com"

;; å®Ÿç”¨ä¾‹: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
(defn valid-username? [name]
  (s/re-matches name "^[a-zA-Z0-9_]{3,16}$"))

(valid-username? "user_123")  ;; => true
(valid-username? "ab")        ;; => false (çŸ­ã™ãã‚‹)
```

**å°†æ¥ã®æ‹¡å¼µï¼ˆæœªå®Ÿè£…ï¼‰**:
- ã‚°ãƒ«ãƒ¼ãƒ—ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼ˆåå‰ä»˜ããƒ»ç•ªå·ä»˜ãï¼‰
- `match-all` - å…¨ãƒãƒƒãƒã®å–å¾—
- `split` - æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹åˆ†å‰²
- `compile` - ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
- ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç½®æ›
```

#### ğŸ”œ math - æ•°å­¦é–¢æ•°ï¼ˆè¨ˆç”»ä¸­ï¼‰

**è¨­è¨ˆæ–¹é‡**: Flow-orientedã«åˆã‚ã›ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ã„ã‚„ã™ãã€‚

```qi
(use math :only [
  ;; ğŸ”¥ æœ€å„ªå…ˆï¼ˆcoreã«å«ã‚ã¦ã‚‚è‰¯ã„ï¼‰
  pow sqrt                    ;; ã¹ãä¹—ãƒ»å¹³æ–¹æ ¹
  round floor ceil            ;; ä¸¸ã‚
  clamp                       ;; ç¯„å›²åˆ¶é™

  ;; âš¡ é«˜å„ªå…ˆï¼ˆæ•°å€¤è¨ˆç®—ã®åŸºæœ¬ï¼‰
  abs                         ;; çµ¶å¯¾å€¤ï¼ˆcoreã«ã‚‚ã‚ã‚‹ï¼‰
  sign                        ;; ç¬¦å·ï¼ˆ-1, 0, 1ï¼‰
  mod                         ;; å‰°ä½™ï¼ˆ%ã¨ã®é•ã„ã¯è² æ•°ã®æ‰±ã„ï¼‰
  gcd lcm                     ;; æœ€å¤§å…¬ç´„æ•°ãƒ»æœ€å°å…¬å€æ•°

  ;; ä¸‰è§’é–¢æ•°
  sin cos tan
  asin acos atan atan2
  sinh cosh tanh

  ;; æŒ‡æ•°ãƒ»å¯¾æ•°
  exp log log10 log2

  ;; ä¹±æ•°
  random                      ;; [0, 1)ã®ä¹±æ•°
  random-int                  ;; æ•´æ•°ä¹±æ•°
  random-range                ;; ç¯„å›²æŒ‡å®šä¹±æ•°
  choice                      ;; ãƒªã‚¹ãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ é¸æŠ
  shuffle                     ;; ã‚·ãƒ£ãƒƒãƒ•ãƒ«

  ;; ãã®ä»–
  factorial
  prime?

  ;; å®šæ•°
  pi e tau
])

;; ä½¿ç”¨ä¾‹ - Flow-orientedè¨­è¨ˆ
;; 1. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ãˆã‚‹
([1 2 3 4 5]
 |> (map (fn [x] (math/pow x 2)))
 |> math/mean)  ;; å¹³æ–¹ã®å¹³å‡: 11.0

;; 2. ç¯„å›²åˆ¶é™ï¼ˆWeb APIã§é »å‡ºï¼‰
(user-input
 |> parse-int
 |> (fn [n] (math/clamp n 1 100)))  ;; 1-100ã«åˆ¶é™

;; 3. çµ±è¨ˆå‡¦ç†
(defn analyze [data]
  {:mean (math/mean data)
   :median (math/median data)
   :stddev (math/stddev data)
   :p95 (math/percentile data 95)})

(analyze [10 20 30 40 50])
;; {:mean 30 :median 30 :stddev 14.14 :p95 48}

;; 4. ä¹±æ•°ï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã§ä¾¿åˆ©ï¼‰
(math/random-int 1 100)  ;; 1-100ã®æ•´æ•°
(math/choice [:red :green :blue])
(math/shuffle [1 2 3 4 5])

;; 5. ä¸¸ã‚å‡¦ç†ï¼ˆé‡‘é¡è¨ˆç®—ãªã©ï¼‰
(price
 |> (* 1.08)              ;; æ¶ˆè²»ç¨
 |> math/round)           ;; å°æ•°ç‚¹ä»¥ä¸‹å››æ¨äº”å…¥

;; 6. ä¸‰è§’é–¢æ•°ï¼ˆã‚²ãƒ¼ãƒ ãƒ»ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
(defn rotate-point [x y angle]
  (let [rad (* angle (/ math/pi 180))]
    {:x (- (* x (math/cos rad)) (* y (math/sin rad)))
     :y (+ (* x (math/sin rad)) (* y (math/cos rad)))}))
```

**å®Ÿè£…å„ªå…ˆåº¦**:
- âœ… pow, sqrt, round, floor, ceil, clampï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… randomç³»ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… statsãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆç‹¬ç«‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦å®Ÿè£…æ¸ˆã¿ï¼‰
- Phase 4: ä¸‰è§’é–¢æ•°ãƒ»å¯¾æ•°ï¼ˆå¿…è¦ã«ãªã£ãŸã‚‰ï¼‰

#### âœ… stats - çµ±è¨ˆé–¢æ•°ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãŸã‚ã®çµ±è¨ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**

```qi
(use stats :only [
  mean              ;; å¹³å‡å€¤
  median            ;; ä¸­å¤®å€¤
  mode              ;; æœ€é »å€¤
  variance          ;; åˆ†æ•£
  stddev            ;; æ¨™æº–åå·®
  percentile        ;; ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«ï¼ˆ0-100ï¼‰
])

;; ä½¿ç”¨ä¾‹
(def data [1 2 3 4 5 5 6 7 8 9 10])

;; åŸºæœ¬çµ±è¨ˆé‡
(stats/mean data)       ; => 5.454545...
(stats/median data)     ; => 5
(stats/mode data)       ; => 5

;; åˆ†æ•£ãƒ»æ¨™æº–åå·®
(stats/variance data)   ; => 7.272727...
(stats/stddev data)     ; => 2.697...

;; ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«
(stats/percentile data 50)   ; => 5.0 (ä¸­å¤®å€¤ã¨åŒã˜)
(stats/percentile data 95)   ; => 9.5

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ä½¿ãˆã‚‹
(test-scores
 |> (filter passing?)
 |> stats/mean
 |> (fn [avg] (println f"Average: {avg}")))
```

**è¨­è¨ˆæ–¹é‡**:
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒªã‚¹ãƒˆã¾ãŸã¯ãƒ™ã‚¯ã‚¿ï¼‰ã‚’å¼•æ•°ã«å–ã‚‹
- ã™ã¹ã¦ã®è¦ç´ ãŒæ•°å€¤ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹
- ç©ºã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚¨ãƒ©ãƒ¼
- Flow-orientedè¨­è¨ˆã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ„ã¿è¾¼ã‚ã‚‹

#### âœ… zip - ZIPåœ§ç¸®ãƒ»è§£å‡ã¨gzipï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**ZIPåœ§ç¸®ãƒ»è§£å‡ã®ãŸã‚ã®æ±ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**

```qi
(use zip :only [
  create            ;; ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
  extract           ;; ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡
  list              ;; ZIPå†…å®¹ã‚’ä¸€è¦§è¡¨ç¤º
  add               ;; æ—¢å­˜ZIPã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
  gzip              ;; gzipåœ§ç¸®ï¼ˆå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
  gunzip            ;; gzipè§£å‡ï¼ˆå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
])

;; ============================================
;; ZIPåœ§ç¸®
;; ============================================

;; å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPåŒ–
(zip/create "archive.zip" "document.txt")

;; è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPåŒ–
(zip/create "archive.zip" ["file1.txt" "file2.txt" "data.csv"])

;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’ZIPåŒ–ï¼ˆå†å¸°çš„ï¼‰
(zip/create "backup.zip" "myproject/")

;; ============================================
;; ZIPè§£å‡
;; ============================================

;; ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è§£å‡
(zip/extract "archive.zip")

;; æŒ‡å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è§£å‡
(zip/extract "archive.zip" "extracted/")

;; ============================================
;; ZIPå†…å®¹ã®ç¢ºèª
;; ============================================

;; ZIPå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
(zip/list "archive.zip")
;; => [{:name "file1.txt" :size 1024 :compressed-size 512 :is-dir false}
;;     {:name "dir/" :size 0 :compressed-size 0 :is-dir true}
;;     {:name "dir/file2.txt" :size 2048 :compressed-size 1024 :is-dir false}]

;; ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‡¦ç†
("archive.zip"
 |> zip/list
 |> (filter (fn [entry] (not (:is-dir entry))))
 |> (map :name))
;; => ["file1.txt" "dir/file2.txt"]

;; ============================================
;; æ—¢å­˜ZIPã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
;; ============================================

;; å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
(zip/add "archive.zip" "newfile.txt")

;; è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
(zip/add "archive.zip" ["file3.txt" "file4.txt"])

;; ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ 
(zip/add "archive.zip" "newdir/")

;; ============================================
;; gzipåœ§ç¸®ï¼ˆå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
;; ============================================

;; ãƒ•ã‚¡ã‚¤ãƒ«ã‚’gzipåœ§ç¸®ï¼ˆ.gzæ‹¡å¼µå­ã‚’è‡ªå‹•ä»˜ä¸ï¼‰
(zip/gzip "largefile.txt")
;; => "largefile.txt.gz"ã‚’ä½œæˆ

;; å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®š
(zip/gzip "largefile.txt" "output.gz")

;; ============================================
;; gzipè§£å‡
;; ============================================

;; gzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ï¼ˆ.gzæ‹¡å¼µå­ã‚’è‡ªå‹•é™¤å»ï¼‰
(zip/gunzip "largefile.txt.gz")
;; => "largefile.txt"ã‚’ä½œæˆ

;; å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®š
(zip/gunzip "data.gz" "data.txt")

;; ============================================
;; å®Ÿç”¨ä¾‹: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
;; ============================================

;; å¤ã„ãƒ­ã‚°ã‚’gzipåœ§ç¸®ã—ã¦ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
(defn archive-logs [log-dir archive-name]
  (let [logs (io/list-dir log-dir :pattern "*.log")]
    ;; å„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’gzipåœ§ç¸®
    (logs |> (map zip/gzip))
    ;; åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPã«ã¾ã¨ã‚ã‚‹
    (let [gz-files (io/list-dir log-dir :pattern "*.gz")]
      (zip/create archive-name gz-files)
      ;; å…ƒã®.gzãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
      (gz-files |> (map io/delete-file)))))

(archive-logs "logs/" "logs-2025-01.zip")

;; ============================================
;; å®Ÿç”¨ä¾‹: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¾©å…ƒ
;; ============================================

;; ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
(defn backup-project [project-dir backup-file]
  (zip/create backup-file project-dir)
  (println f"Backup created: {backup-file}"))

(backup-project "myapp/" "backups/myapp-2025-01-11.zip")

;; ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
(defn restore-project [backup-file restore-dir]
  (zip/extract backup-file restore-dir)
  (println f"Restored to: {restore-dir}"))

(restore-project "backups/myapp-2025-01-11.zip" "restored/")
```

**è¨­è¨ˆæ–¹é‡**:
- ZIPåœ§ç¸®ã«ã¯Deflateã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ä½¿ç”¨ï¼ˆä¸€èˆ¬çš„ãªZIPå½¢å¼ï¼‰
- ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä¿æŒã—ãŸã¾ã¾åœ§ç¸®ãƒ»è§£å‡
- gzipã¯å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«å‘ã‘ã®é«˜é€Ÿåœ§ç¸®
- Pure Rustã‚¯ãƒ¬ãƒ¼ãƒˆï¼ˆzip, flate2ï¼‰ã‚’ä½¿ç”¨

#### âœ… args - ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ãƒ‘ãƒ¼ã‚¹ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**CLI/ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®å¼•æ•°ãƒ‘ãƒ¼ã‚¹**

```qi
(use args :only [
  all               ;; å…¨ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚’å–å¾—
  get               ;; æŒ‡å®šä½ç½®ã®å¼•æ•°ã‚’å–å¾—
  parse             ;; å¼•æ•°ã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆãƒ•ãƒ©ã‚°ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ä½ç½®å¼•æ•°ï¼‰
  count             ;; å¼•æ•°ã®æ•°ã‚’å–å¾—
])

;; ============================================
;; åŸºæœ¬çš„ãªå¼•æ•°ã‚¢ã‚¯ã‚»ã‚¹
;; ============================================

;; å…¨å¼•æ•°ã‚’å–å¾—
(args/all)
;; ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œ: ./qi script.qi arg1 arg2
;; => ["./qi" "script.qi" "arg1" "arg2"]

;; å¼•æ•°ã®æ•°ã‚’å–å¾—
(args/count)
;; => 4

;; æŒ‡å®šä½ç½®ã®å¼•æ•°ã‚’å–å¾—
(args/get 0)           ;; => "./qi" (ãƒ—ãƒ­ã‚°ãƒ©ãƒ å)
(args/get 1)           ;; => "script.qi" (ç¬¬1å¼•æ•°)
(args/get 2)           ;; => "arg1" (ç¬¬2å¼•æ•°)

;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®š
(args/get 5 "default") ;; => "default" (å­˜åœ¨ã—ãªã„å ´åˆ)
(args/get 10)          ;; => nil (å­˜åœ¨ã›ãšãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚‚ãªã„å ´åˆ)

;; ============================================
;; é«˜åº¦ãªå¼•æ•°ãƒ‘ãƒ¼ã‚¹ï¼ˆGNUå½¢å¼ï¼‰
;; ============================================

;; ãƒ•ãƒ©ã‚°ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ»ä½ç½®å¼•æ•°ã‚’è‡ªå‹•è§£æ
(args/parse)
;; ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œ: ./qi script.qi --verbose --port 3000 -df input.txt
;; => {:flags ["verbose" "d" "f"]
;;     :options {"port" "3000"}
;;     :args ["./qi" "script.qi" "input.txt"]}

;; è§£æãƒ«ãƒ¼ãƒ«:
;; - "--flag"               â†’ ãƒ•ãƒ©ã‚°ï¼ˆçœŸå½å€¤ï¼‰
;; - "--key=value"          â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚­ãƒ¼ãƒ»å€¤ãƒšã‚¢ï¼‰
;; - "--key value"          â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆã‚­ãƒ¼ãƒ»å€¤ãƒšã‚¢ï¼‰
;; - "-abc"                 â†’ çŸ­ç¸®ãƒ•ãƒ©ã‚°ï¼ˆa, b, c ã®3ã¤ï¼‰
;; - ãã®ä»–                 â†’ ä½ç½®å¼•æ•°

;; ============================================
;; å®Ÿç”¨ä¾‹: CLIãƒ„ãƒ¼ãƒ«
;; ============================================

;; ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãƒ„ãƒ¼ãƒ«
(defn main []
  (let [parsed (args/parse)
        flags (:flags parsed)
        options (:options parsed)
        files (:args parsed)]

    ;; ãƒ•ãƒ©ã‚°ã®ãƒã‚§ãƒƒã‚¯
    (let [verbose? (str/contains? flags "verbose")
          help? (str/contains? flags "help")]

      (if help?
        (print-help)
        (do
          ;; ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®å–å¾—
          (let [output (map/get options "output" "output.txt")
                format (map/get options "format" "json")]

            ;; ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
            (when verbose?
              (println f"Processing {(count files)} files..."))

            (files
             |> (drop 2)  ;; ãƒ—ãƒ­ã‚°ãƒ©ãƒ åã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆåã‚’ã‚¹ã‚­ãƒƒãƒ—
             |> (map process-file)
             |> (fn [results] (save-results results output format)))

            (when verbose?
              (println "Done!")))))))))

;; ä½¿ç”¨ä¾‹:
;; ./qi tool.qi --verbose --output results.json --format json data1.txt data2.txt

;; ============================================
;; å®Ÿç”¨ä¾‹: è¨­å®šã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
;; ============================================

(defn load-config []
  (let [parsed (args/parse)
        options (:options parsed)

        ;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        default-config {:host "localhost"
                       :port 3000
                       :debug false}

        ;; ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
        config (default-config
                |> (fn [c] (if (map/has-key? options "host")
                             (assoc c :host (map/get options "host"))
                             c))
                |> (fn [c] (if (map/has-key? options "port")
                             (assoc c :port (str/parse-int (map/get options "port")))
                             c))
                |> (fn [c] (if (str/contains? (:flags parsed) "debug")
                             (assoc c :debug true)
                             c)))]
    config))

;; ä½¿ç”¨ä¾‹:
;; ./qi server.qi --host 0.0.0.0 --port 8080 --debug
;; => {:host "0.0.0.0" :port 8080 :debug true}

;; ============================================
;; å®Ÿç”¨ä¾‹: ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
;; ============================================

(defn main []
  (let [subcommand (args/get 2)  ;; ç¬¬2å¼•æ•°ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ åã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆåã®æ¬¡ï¼‰
        rest-args (args/all |> (drop 3))]

    (match subcommand
      "init"    -> (cmd-init rest-args)
      "build"   -> (cmd-build rest-args)
      "test"    -> (cmd-test rest-args)
      "deploy"  -> (cmd-deploy rest-args)
      _         -> (println "Unknown command. Use: init, build, test, or deploy"))))

;; ä½¿ç”¨ä¾‹:
;; ./qi cli.qi init myproject
;; ./qi cli.qi build --release
;; ./qi cli.qi test --verbose
```

**è¨­è¨ˆæ–¹é‡**:
- GNUå½¢å¼ã®å¼•æ•°è§£æã‚’ã‚µãƒãƒ¼ãƒˆï¼ˆ--long, -shortï¼‰
- ã‚·ãƒ³ãƒ—ãƒ«ãªä½ç½®å¼•æ•°ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰é«˜åº¦ãªãƒ‘ãƒ¼ã‚¹ã¾ã§å¯¾å¿œ
- Flow-orientedè¨­è¨ˆã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨çµ„ã¿åˆã‚ã›å¯èƒ½
- CLIãƒ„ãƒ¼ãƒ«ã¨ã‚µãƒ¼ãƒãƒ¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸¡æ–¹ã§ä½¿ç”¨å¯èƒ½

#### âœ… time - æ—¥ä»˜ãƒ»æ™‚åˆ»ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

**è¨­è¨ˆæ–¹é‡**: ISO 8601æº–æ‹ ã€‚Flow-orientedãªå¤‰æ›ãƒ»æ“ä½œã€‚

```qi
(use time :only [
  ;; ğŸ”¥ æœ€å„ªå…ˆï¼ˆç¾åœ¨æ™‚åˆ»å–å¾—ï¼‰
  now                         ;; ç¾åœ¨æ™‚åˆ»ï¼ˆUnixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
  now-iso                     ;; ç¾åœ¨æ™‚åˆ»ï¼ˆISO 8601æ–‡å­—åˆ—ï¼‰
  today                       ;; ä»Šæ—¥ã®æ—¥ä»˜ï¼ˆYYYY-MM-DDï¼‰

  ;; ç”Ÿæˆãƒ»ãƒ‘ãƒ¼ã‚¹
  from-unix                   ;; Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰
  from-iso                    ;; ISOæ–‡å­—åˆ—ã‹ã‚‰
  parse                       ;; æ–‡å­—åˆ—ã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡å®šï¼‰

  ;; ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  format                      ;; ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  to-iso                      ;; ISO 8601æ–‡å­—åˆ—ã«
  to-unix                     ;; Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã«

  ;; è¦ç´ ã‚¢ã‚¯ã‚»ã‚¹
  year month day              ;; å¹´æœˆæ—¥
  hour minute second          ;; æ™‚åˆ†ç§’
  weekday                     ;; æ›œæ—¥ï¼ˆ0=æ—¥æ›œï¼‰

  ;; æ¼”ç®—
  add-days add-hours add-minutes
  sub-days sub-hours sub-minutes
  diff-days diff-hours diff-minutes

  ;; æ¯”è¼ƒ
  before? after? between?

  ;; ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  start-of-day end-of-day
  start-of-month end-of-month
  weekend? leap-year?

  ;; ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
  to-utc to-local
  timezone
])

;; ä½¿ç”¨ä¾‹ - Flow-orientedè¨­è¨ˆ
;; 1. ç¾åœ¨æ™‚åˆ»ã®å–å¾—
(time/now)       ;; 1736553600 (Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—)
(time/now-iso)   ;; "2025-01-11T03:00:00Z"
(time/today)     ;; "2025-01-11"

;; 2. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å¤‰æ›
(time/now
 |> time/from-unix
 |> (fn [t] (time/add-days t 7))    ;; 7æ—¥å¾Œ
 |> time/to-iso)
;; "2025-01-18T03:00:00Z"

;; 3. ãƒ‘ãƒ¼ã‚¹ã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
(defn format-date [date-str]
  (date-str
   |> (fn [s] (time/parse s "%Y-%m-%d"))
   |> (fn [t] (time/format t "%B %d, %Y"))))

(format-date "2025-01-11")  ;; "January 11, 2025"

;; 4. å®Ÿç”¨ä¾‹ï¼šæœŸé™ãƒã‚§ãƒƒã‚¯
(defn is-expired? [expires-at]
  (time/before? expires-at (time/now)))

(def session {:created-at (time/now)
              :expires-at (time/add-hours (time/now) 24)})

(is-expired? (:expires-at session))  ;; false

;; 5. ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
(logs
 |> (filter (fn [log]
      (time/between? (:timestamp log)
                     (time/today)
                     (time/now))))
 |> (map (fn [log] {:date (time/format (:timestamp log) "%Y-%m-%d")
                    :level (:level log)}))
 |> (list/group-by :date))

;; 6. å–¶æ¥­æ—¥è¨ˆç®—ï¼ˆã‚«ã‚¹ã‚¿ãƒ é–¢æ•°ï¼‰
(defn add-business-days [date n]
  (loop [current date remaining n]
    (if (<= remaining 0)
      current
      (let [next-day (time/add-days current 1)]
        (if (time/weekend? next-day)
          (recur next-day remaining)
          (recur next-day (dec remaining)))))))

;; 7. ç›¸å¯¾æ™‚é–“è¡¨ç¤ºï¼ˆSNSçš„ï¼‰
(defn relative-time [timestamp]
  (let [diff (time/diff-minutes timestamp (time/now))]
    (match diff
      n when (< n 60) -> f"{n}åˆ†å‰"
      n when (< n 1440) -> f"{(/ n 60)}æ™‚é–“å‰"
      n -> f"{(/ n 1440)}æ—¥å‰")))
```

**å®Ÿè£…å„ªå…ˆåº¦**:
- Phase 1: now, now-iso, from-unix, to-iso, formatï¼ˆåŸºæœ¬çš„ãªå–å¾—ã¨å¤‰æ›ï¼‰
- Phase 2: add-*, diff-*ï¼ˆæ¼”ç®—ï¼‰
- Phase 3: parse, before?, after?ï¼ˆãƒ‘ãƒ¼ã‚¹ã¨æ¯”è¼ƒï¼‰
- Phase 4: ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å¯¾å¿œ

**è¨­è¨ˆãƒ¡ãƒ¢**:
- å†…éƒ¨è¡¨ç¾ã¯Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆi64ï¼‰
- ISO 8601æ–‡å­—åˆ—ã¨ã®ç›¸äº’å¤‰æ›ã‚’é‡è¦–
- Flow-orientedãªã®ã§ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å¤‰æ›ã—ã‚„ã™ã
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆUTCã€å¿…è¦ã«å¿œã˜ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«å¤‰æ›

#### ğŸš§ ãã®ä»–ï¼ˆå…¨ã¦æœªå®Ÿè£…ï¼‰
```qi
http      ;; HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
json      ;; JSONãƒ‘ãƒ¼ã‚¹
db        ;; ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
io        ;; ãƒ•ã‚¡ã‚¤ãƒ«IOæ‹¡å¼µ
test      ;; ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
```

## 11. æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«

### âœ… åŸºæœ¬ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
```qi
"hello"
"hello\nworld"
"say \"hello\""
```

### âœ… è¤‡æ•°è¡Œï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

Pythoné¢¨ã®`"""`ã‚’ä½¿ã£ãŸè¤‡æ•°è¡Œæ–‡å­—åˆ—ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

```qi
;; åŸºæœ¬çš„ãªè¤‡æ•°è¡Œæ–‡å­—åˆ—
"""
This is a
multi-line
string
"""

;; ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚‚åˆ©ç”¨å¯èƒ½
"""Line 1\nLine 2\nLine 3"""

;; SQLã‚¯ã‚¨ãƒªãªã©ã«ä¾¿åˆ©
(def query """
  SELECT name, age
  FROM users
  WHERE age >= 18
  ORDER BY name
""")

;; JSONã‚„HTMLã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®åŸ‹ã‚è¾¼ã¿ã«ä¾¿åˆ©
(def html """
<!DOCTYPE html>
<html>
  <body>
    <h1>Hello, World!</h1>
  </body>
</html>
""")
```

### âœ… è¤‡æ•°è¡Œf-stringï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

f-stringã§ã‚‚è¤‡æ•°è¡ŒãŒä½¿ãˆã¾ã™ã€‚`f"""..."""`ã®å½¢å¼ã§ã™ã€‚

```qi
;; å¤‰æ•°ã‚’å«ã‚€è¤‡æ•°è¡Œæ–‡å­—åˆ—
(def name "Alice")
(def age 30)

f"""
Name: {name}
Age: {age}
Status: Active
"""

;; ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ã‚ˆã†ã«ä½¿ãˆã‚‹
(defn gen-email [user]
  f"""
  Dear {(:name user)},

  Your order #{(:order-id user)} has been confirmed.
  Total: ${(:total user)}

  Thank you for your purchase!
  """
)

(gen-email {:name "Bob" :order-id 12345 :total 99.99})
;; => ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ãŒç”Ÿæˆã•ã‚Œã‚‹
```

### âœ… è£œé–“ï¼ˆf-stringï¼‰ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

f-stringã¯`f"...{expr}..."`ã®å½¢å¼ã§ã€`{}`å†…ã«å¤‰æ•°ã‚„å¼ã‚’åŸ‹ã‚è¾¼ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

```qi
;; åŸºæœ¬çš„ãªä½¿ã„æ–¹
f"Hello, World!"  ;; => "Hello, World!"

;; å¤‰æ•°ã®è£œé–“
(def name "Alice")
f"Hello, {name}!"  ;; => "Hello, Alice!"

;; å¼ã‚‚ä½¿ãˆã‚‹
f"Result: {(+ 1 2)}"  ;; => "Result: 3"

;; ãƒªã‚¹ãƒˆã‚„ãƒ™ã‚¯ã‚¿ã®è£œé–“
f"List: {[1 2 3]}"  ;; => "List: [1 2 3]"

;; ãƒãƒƒãƒ—ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆgetã¾ãŸã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é–¢æ•°ï¼‰
(def user {:name "Bob" :age 30})
f"Name: {(get user :name)}, Age: {(get user :age)}"
;; => "Name: Bob, Age: 30"

;; ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é–¢æ•°ã¨ã—ã¦ä½¿ã†ï¼ˆã‚ˆã‚Šç°¡æ½”ï¼‰
f"Name: {(:name user)}, Age: {(:age user)}"
;; => "Name: Bob, Age: 30"

;; ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
f"Escaped: \{not interpolated\}"  ;; => "Escaped: {not interpolated}"

;; ãƒã‚¹ãƒˆå¯èƒ½ï¼ˆæ–‡å­—åˆ—é–¢æ•°ã¨çµ„ã¿åˆã‚ã›ï¼‰
(def items ["apple" "banana" "cherry"])
f"Items: {(join \", \" items)}"  ;; => "Items: apple, banana, cherry"

;; å®Ÿç”¨ä¾‹ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰é–¢æ•°ã‚’ä½¿ã£ãŸç°¡æ½”ãªè¨˜è¿°ï¼‰
(defn greet [user]
  f"Welcome, {(:name user)}! You have {(:messages user)} new messages.")

(greet {:name "Alice" :messages 3})
;; => "Welcome, Alice! You have 3 new messages."
```

**å¯¾å¿œã™ã‚‹å€¤ã®å‹**:
- æ–‡å­—åˆ—: ãã®ã¾ã¾åŸ‹ã‚è¾¼ã¿
- æ•°å€¤ï¼ˆæ•´æ•°ãƒ»æµ®å‹•å°æ•°ç‚¹ï¼‰: æ–‡å­—åˆ—ã«å¤‰æ›
- bool/nil: "true"/"false"/"nil"ã«å¤‰æ›
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: `:keyword`å½¢å¼ã§åŸ‹ã‚è¾¼ã¿
- ãƒªã‚¹ãƒˆ/ãƒ™ã‚¯ã‚¿/ãƒãƒƒãƒ—: è¡¨ç¤ºå½¢å¼ã§åŸ‹ã‚è¾¼ã¿
- é–¢æ•°: `<function>`ã¾ãŸã¯`<native-fn:name>`ã«å¤‰æ›
```

## 12. å®Ÿç”¨ä¾‹

### Webã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
```qi
(use http :only [get])

(defn scrape-prices [url]
  (match (try
    (url
     |> get
     |> parse-html
     |> (select ".price")
     |> (pmap extract-number)))
    {:ok prices} -> prices
    {:error e} -> (do (log e) [])))

(def all-prices
  (["https://shop1.com" "https://shop2.com"]
   |> (pmap scrape-prices)
   |> flatten
   |> (filter (fn [p] (> p 0)))))

(log f"Average: {(/ (sum all-prices) (len all-prices))}")
```

### å®‰å…¨ãªãƒã‚¯ãƒ­ï¼ˆuvarsä½¿ç”¨ï¼‰
```qi
;; è¡çªã—ãªã„aif
(mac aif (test then & else)
  (let [it (uvar)]
    `(let [,it ,test]
       (if ,it ,then ,@else))))

;; å®‰å…¨ãªwhen
(mac when (test & body)
  (let [g (uvar)]
    `(let [,g ,test]
       (if ,g (do ,@body)))))

;; å®‰å…¨ãªor
(mac or (& args)
  (if (no args)
      nil
      (if (no (cdr args))
          (car args)
          (let [g (uvar)]
            `(let [,g ,(car args)]
               (if ,g ,g (or ,@(cdr args))))))))
```

### CSVå‡¦ç†
```qi
(use csv)
(use str :as s)

(defn clean-csv [file]
  (file
   |> csv/parse-file
   |> (map (fn [row]
            {:name (s/trim (:name row))
             :email (s/lower (:email row))
             :age (str/parse-int (:age row))}))
   |> (filter (fn [row]
               (match (:age row)
                 {:ok n} -> (> n 0)
                 _ -> false)))
   |> (csv/write-file "cleaned.csv")))
```

### ãƒ­ã‚°è§£æ
```qi
(use regex :as re)
(use str :as s)

(defn parse-log [line]
  (match (re/match line #"^\[(?<level>\w+)\] (?<time>[\d:]+) - (?<msg>.+)$")
    {:groups {:level l :time t :msg m}} -> {:level l :time t :msg m}
    _ -> nil))

(defn analyze-logs [file]
  (file
   |> slurp
   |> s/lines
   |> (map parse-log)
   |> (filter (fn [x] (not (= x nil))))
   |> (filter (fn [x] (= (:level x) "ERROR")))
   |> (list/group-by :msg)
   |> (map (fn [[msg entries]] {:msg msg :count (len entries)}))
   |> (list/sort-by :count)
   |> reverse))
```

### ãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼
```qi
(def clients (atom #{}))

(defn broadcast [msg]
  (pmap (fn [c] (send c msg)) @clients))

(defn handle-client [conn]
  (do
    (swap! clients conj conn)
    (defer (swap! clients dissoc conn))
    (go
      (loop [running true]
        (if running
          (match (recv conn)
            {:msg m} -> (do (broadcast m) (recur true))
            :close -> (recur false))
          nil)))))

(listen 8080 |> (map handle-client))
```

### ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```qi
(use str :as s)
(use csv)

(defn process-logs [file]
  (match (try
    (file
     |> csv/parse-file
     |> (filter (fn [e] (= (:level e) "ERROR")))
     |> (list/group-by :service)
     |> (map (fn [[k v]] {:service k :count (len v)}))
     |> (list/sort-by :count)
     |> reverse))
    {:ok data} -> data
    {:error e} -> []))

(def results
  (dir-files "logs/*.csv")
  |> (pmap process-logs)
  |> flatten)

(csv/write-file "report.csv" results)
```

### URLæ§‹ç¯‰
```qi
(use str :as s)

(defn build-url [base path params]
  (let [query (params
               |> (map (fn [[k v]] f"{k}={(s/url-encode v)}"))
               |> (s/join "&"))]
    f"{base}/{path}?{query}"))

(build-url "https://api.example.com" "search"
           {:q "hello world" :limit 10})
;; "https://api.example.com/search?q=hello%20world&limit=10"
```

### ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†
```qi
(use str :as s)
(use regex :as re)

(defn clean-text [text]
  (text
   |> (re/replace-all #"\s+" " ")
   |> s/trim
   |> (s/truncate 1000)))

(defn extract-emails [text]
  (re/match-all text #"[^@\s]+@[^@\s]+\.[^@\s]+")
  |> (map :matched))

(defn word-frequency [text]
  (text
   |> s/lower
   |> s/words
   |> (list/group-by identity)
   |> (map (fn [[word instances]] {:word word :count (len instances)}))
   |> (list/sort-by :count)
   |> reverse))
```

## 13. è¨€èªæ–‡åŒ–

### å‘½åè¦å‰‡
- **é–¢æ•°å**: çŸ­ãç›´æ„Ÿçš„ï¼ˆ`len`, `trim`, `split`ï¼‰
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å**: çŸ­ãæ˜ç¢ºï¼ˆ`http`, `json`, `csv`, `regex`ï¼‰
- **è¿°èªé–¢æ•°**: `?` ã§çµ‚ã‚ã‚‹ï¼ˆ`empty?`, `valid?`ï¼‰
- **ç ´å£Šçš„æ“ä½œ**: `!` ã§çµ‚ã‚ã‚‹ï¼ˆ`swap!`, `reset!`ï¼‰

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ«

#### ç°¡æ½”æ€§ã¨å¯èª­æ€§
Qiã¯ã€ŒçŸ­ãã€ã‚ã‹ã‚Šã‚„ã™ãã€ç¾ã—ã„ã‚³ãƒ¼ãƒ‰ã€ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

**åŸºæœ¬åŸå‰‡**:
- **ç°¡æ½”ã«æ›¸ã**: å†—é•·ãªã‚³ãƒ¼ãƒ‰ã‚’é¿ã‘ã€å¿…è¦æœ€å°é™ã®è¨˜è¿°ã§ç›®çš„ã‚’é”æˆ
- **ã‚ã‹ã‚Šã‚„ã™ãæ›¸ã**: ä»–äººãŒèª­ã‚“ã§ã‚‚ç†è§£ã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰
- **çŸ­ã„åå‰ã‚’ä½¿ã†**: å¿…è¦ä»¥ä¸Šã«é•·ã„é–¢æ•°åãƒ»å¤‰æ•°åã¯é¿ã‘ã‚‹ï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ãŒçŸ­ã‘ã‚Œã°çŸ­ã„åå‰ã§OKï¼‰
- **defnã‚’å„ªå…ˆ**: é–¢æ•°å®šç¾©ã«ã¯ `defn` ã‚’ä½¿ã†ï¼ˆ`def` + `fn` ã‚ˆã‚Šç°¡æ½”ï¼‰

**ä¾‹**:
```qi
;; âŒ å†—é•·
(def calculate-sum-of-numbers (fn [list-of-numbers]
  (let [result (reduce (fn [accumulator current-value]
    (+ accumulator current-value)) 0 list-of-numbers)]
    result)))

;; âœ… ç°¡æ½”
(defn sum [nums]
  (reduce + 0 nums))
```

#### Flow First - ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ç¬¬ä¸€ã«

**ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ç¬¬ä¸€ã«è€ƒãˆã‚‹**:
- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ `|>` / `||>` / `tap>` ã‚’ç©æ¥µçš„ã«ä½¿ã†
- å·¦ã‹ã‚‰å³ã€ä¸Šã‹ã‚‰ä¸‹ã«èª­ã‚ã‚‹æµã‚Œã‚’ä½œã‚‹
- å°ã•ãªå¤‰æ›ã‚’çµ„ã¿åˆã‚ã›ã¦å¤§ããªå‡¦ç†ã‚’æ§‹æˆ

**é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’é¸ã¶**:
- å˜ç´”ãªåˆ†å²ã¯ `if`ã€è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ `match`
- `match` ã§æ§‹é€ ã‚’åˆ†è§£ã—ã€`:as` ã§å…¨ä½“ã‚’ä¿æŒã€`=> å¤‰æ›` ã§æµã‚Œã‚’ç¶™ç¶š
- `loop`/`recur` ã§æœ«å°¾å†å¸°æœ€é©åŒ–
- `defer` ã§ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
- å›å¾©å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã¯ `{:ok/:error}`ã€è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼ã¯ `error`

**ãƒ¢ãƒ€ãƒ³ãªæ©Ÿèƒ½ã‚’æ´»ç”¨**:
- âœ… f-string `f"..."` ã§æ–‡å­—åˆ—è£œé–“ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- ãƒã‚¯ãƒ­ã§ã¯ `uvar` ã§å¤‰æ•°è¡çªã‚’å›é¿
- âœ… `match` ã® `:as` ã¨ `=> å¤‰æ›` ã§matchå†…ã«æµã‚Œã‚’åŸ‹ã‚è¾¼ã‚€ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- âœ… `tap>` ã§ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
- ğŸš§ `flow` ã§è¤‡é›‘ãªæµã‚Œã‚’æ§‹é€ åŒ–ï¼ˆæœªå®Ÿè£…ï¼‰

**ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¤**:
- çŸ­ã„å¤‰æ•°åOKï¼ˆã‚¹ã‚³ãƒ¼ãƒ—ãŒçŸ­ã‘ã‚Œã°ï¼‰
- å†åˆ©ç”¨å¯èƒ½ãªã€Œå°ãƒ‘ã‚¤ãƒ—ã€ã‚’å®šç¾©
- ä¸€ã¤ã®é–¢æ•°ã¯ä¸€ã¤ã®è²¬ä»»

#### ä¸¦è¡Œå‡¦ç†ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ

Qiã¯**ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ã‚’ç¬¬ä¸€ç´šå¸‚æ°‘**ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

**è¨­è¨ˆå“²å­¦**:
- ãƒãƒ£ãƒãƒ«ï¼ˆ`chan`ï¼‰ã¨ã‚´ãƒ«ãƒ¼ãƒãƒ³ï¼ˆ`go`ï¼‰ãŒãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µãƒãƒ¼ãƒˆ
- éåŒæœŸå‡¦ç†ï¼ˆ`async`/`await`ï¼‰ãŒçµ„ã¿è¾¼ã¿
- ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªAtomï¼ˆ`@value`ï¼‰
- å…¨ã¦ã®ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«

**ä¾‹**:
```qi
;; ãƒãƒ£ãƒãƒ«ã‚’ä½¿ã£ãŸä¸¦è¡Œå‡¦ç†
(defn worker [ch]
  (loop []
    (let [data (<! ch)]
      (when data
        (process data)
        (recur)))))

;; è¤‡æ•°ãƒ¯ãƒ¼ã‚«ãƒ¼ã®èµ·å‹•
(let [ch (chan)]
  (dotimes [i 5]
    (go (worker ch)))
  (>! ch data))
```

#### ãƒ†ã‚¹ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

**ãƒ†ã‚¹ãƒˆã¯å¿…é ˆ**:
- å…¨ã¦ã®æ©Ÿèƒ½ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- `test/assert`, `test/assert-eq` ã‚’ä½¿ç”¨
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚‚ãƒ†ã‚¹ãƒˆ

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›¸ã**:
- é–¢æ•°ã«ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹
- ä½¿ç”¨ä¾‹ã‚’ç¤ºã™
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

**ä¾‹**:
```qi
(defn factorial [n]
  "nã®éšä¹—ã‚’è¨ˆç®—ã™ã‚‹
   ä¾‹: (factorial 5) => 120"
  (if (<= n 1)
    1
    (* n (factorial (dec n)))))

;; ãƒ†ã‚¹ãƒˆ
(test/assert-eq (factorial 5) 120)
(test/assert-eq (factorial 0) 1)
```

### é¿ã‘ã‚‹ã¹ãã“ã¨

**ã‚³ãƒ¼ãƒ‰ã®å“è³ª**:
- âŒ é•·ã„é–¢æ•°åãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å
- âŒ å†—é•·ãªè¨˜è¿°ï¼ˆ`def` + `fn` ã‚ˆã‚Š `defn`ï¼‰
- âŒ æ·±ã„ãƒã‚¹ãƒˆï¼ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ã†ï¼‰
- âŒ ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ã‚ãªã„å†—é•·ãªä¸­é–“å¤‰æ•°
- âŒ ãƒ†ã‚¹ãƒˆãªã—ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

**è¨­è¨ˆã®å•é¡Œ**:
- âŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®ä¹±ç”¨
- âŒ coreé–¢æ•°ã¨ã®åå‰è¡çª
- âŒ ãƒã‚¯ãƒ­ã§å›ºå®šã®å¤‰æ•°åã‚’ä½¿ã†ï¼ˆ`uvar`ã‚’ä½¿ã†ï¼‰
- âŒ æ‹¡å¼µã—ã¥ã‚‰ã„è¨­è¨ˆ

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**:
- âŒ éåº¦ãªæœ€é©åŒ–ï¼ˆã¾ãšå‹•ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãï¼‰
- âŒ æ—©ã™ãã‚‹æœ€é©åŒ–ï¼ˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å‰ã®æœ€é©åŒ–ï¼‰

**ä¸¦è¡Œå‡¦ç†**:
- âŒ ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã§ãªã„å…±æœ‰çŠ¶æ…‹ï¼ˆAtomã‚’ä½¿ã†ï¼‰
- âŒ ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã®å…±æœ‰

## 14. ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«

```bash
# REPLèµ·å‹•
$ qi

# ãƒ•ã‚¡ã‚¤ãƒ«å®Ÿè¡Œ
$ qi run hello.qi

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
$ qi new myapp

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
$ qi test

# ãƒ“ãƒ«ãƒ‰
$ qi build myapp.qi

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†
$ qi install http json
$ qi update
```

## 15. ãƒ¡ãƒ¢ãƒªç®¡ç†ã¨å®Ÿè¡Œãƒ¢ãƒ‡ãƒ« âœ…

### ãƒ¡ãƒ¢ãƒªç®¡ç†

Qiã¯**GCï¼ˆã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ä¸è¦**ã®è¨­è¨ˆã§ã™ã€‚Rustã®æ‰€æœ‰æ¨©ã‚·ã‚¹ãƒ†ãƒ ã¨å‚ç…§ã‚«ã‚¦ãƒ³ãƒˆã§è‡ªå‹•çš„ã«ãƒ¡ãƒ¢ãƒªç®¡ç†ã•ã‚Œã¾ã™ã€‚

#### ãƒ¡ãƒ¢ãƒªç®¡ç†ã®ä»•çµ„ã¿

**åŸºæœ¬åŸå‰‡:**
- **Arcï¼ˆAtomic Reference Countingï¼‰**: ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªå‚ç…§ã‚«ã‚¦ãƒ³ãƒˆ
  - `Function`, `Macro`, `Atom`, `Channel`, `Scope`, `Stream` ã«ä½¿ç”¨
  - å‚ç…§ã‚«ã‚¦ãƒ³ãƒˆãŒ0ã«ãªã‚‹ã¨è‡ªå‹•çš„ã«ãƒ¡ãƒ¢ãƒªè§£æ”¾
- **RwLock**: èª­ã¿æ›¸ããƒ­ãƒƒã‚¯ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªå¯å¤‰æ€§ã‚’å®Ÿç¾
- **å€¤ã®ã‚³ãƒ”ãƒ¼**: ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ãªå€¤ã¯å¿…è¦ã«å¿œã˜ã¦ã‚¯ãƒ­ãƒ¼ãƒ³

**å¾ªç’°å‚ç…§ã®é˜²æ­¢:**
```rust
// é–¢æ•°ä½œæˆæ™‚ã«ç’°å¢ƒã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã“ã¨ã§å¾ªç’°å‚ç…§ã‚’é˜²ã
(fn [x] (+ x 1))  ; ç’°å¢ƒå…¨ä½“ãŒã‚¯ãƒ­ãƒ¼ãƒ³ã•ã‚Œã‚‹
```

é–¢æ•°ã‚„ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ä½œæˆæ™‚ã«ç’°å¢ƒå…¨ä½“ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ãŸã‚ã€å¾ªç’°å‚ç…§ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚

#### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡

**åˆ©ç‚¹:**
- âœ… ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãªã—ï¼ˆå¾ªç’°å‚ç…§ãŒãªã„ï¼‰
- âœ… ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼ˆArc + RwLockï¼‰
- âœ… äºˆæ¸¬å¯èƒ½ãªãƒ¡ãƒ¢ãƒªè§£æ”¾ï¼ˆå‚ç…§ã‚«ã‚¦ãƒ³ãƒˆï¼‰
- âœ… GCã®åœæ­¢æ™‚é–“ãªã—

**ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•:**
- ç’°å¢ƒã‚¯ãƒ­ãƒ¼ãƒ³ã®ã‚³ã‚¹ãƒˆï¼ˆé–¢æ•°ä½œæˆæ™‚ï¼‰
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¯ãƒ­ãƒ¼ãƒ³ã‚³ã‚¹ãƒˆï¼ˆãƒªã‚¹ãƒˆã€ãƒ™ã‚¯ã‚¿ã€ãƒãƒƒãƒ—ï¼‰
- é–¢æ•°å‹è¨€èªã¨ã—ã¦ã¯ä¸€èˆ¬çš„ãªãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•

#### é•·æ™‚é–“å®Ÿè¡Œã‚µãƒ¼ãƒ“ã‚¹ã§ã®æ³¨æ„ç‚¹

APIã‚µãƒ¼ãƒãƒ¼ã‚„HTTPã‚µãƒ¼ãƒãƒ¼ãªã©ã€é•·æ™‚é–“å®Ÿè¡Œã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆã®æ¨å¥¨äº‹é …:

**ãƒ¡ãƒ¢ãƒªç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
```qi
; âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã‚’ä½¿ã†
(defn handle-request [req]
  (let [session (new-session req)]
    ;; å‡¦ç†å¾Œã€ç’°å¢ƒã¯è‡ªå‹•çš„ã«è§£æ”¾ã•ã‚Œã‚‹
    (process session)))

; âœ… å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã¯Atomã§ç®¡ç†
(def cache (atom {}))

; âœ… é•·æ™‚é–“ä¿æŒã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯Arcã§å…±æœ‰ã•ã‚Œã‚‹
(def config (load-config))  ; è‡ªå‹•çš„ã«Arcã§ãƒ©ãƒƒãƒ—

; âš ï¸ ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªçŠ¶æ…‹ã®è“„ç©ã«æ³¨æ„
(def global-log (atom []))  ; ç„¡é™ã«å¢—ãˆã‚‹å¯èƒ½æ€§
```

**æ¨å¥¨è¨­è¨ˆ:**
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã‚’ä½¿ç”¨
- ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¯æœ€å°é™ã«æŠ‘ãˆã‚‹
- å®šæœŸçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆTTLã€ãƒ¡ãƒ¢ãƒªä¸Šé™ãªã©ï¼‰
- ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãªã„

#### å°†æ¥ã®æœ€é©åŒ–æ¡ˆ

ç¾åœ¨ã®å®Ÿè£…ã¯å°ã€œä¸­è¦æ¨¡ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚å¤§è¦æ¨¡ãƒ»é«˜è² è·ãªã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®æœ€é©åŒ–ã‚’æ¤œè¨ã§ãã¾ã™:

**1. Copy-on-Write (CoW):**
```qi
; ãƒ‡ãƒ¼ã‚¿ã‚’Arcã§å…±æœ‰ã—ã€å¤‰æ›´æ™‚ã®ã¿ã‚³ãƒ”ãƒ¼
```

**2. æ§‹é€ å…±æœ‰ï¼ˆPersistent Data Structuresï¼‰:**
```qi
; Clojureã‚¹ã‚¿ã‚¤ãƒ«ã®æ°¸ç¶šãƒ‡ãƒ¼ã‚¿æ§‹é€ 
; å¤‰æ›´æ™‚ã‚‚æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰
```

**3. ç’°å¢ƒã®æœ€é©åŒ–:**
```qi
; ç’°å¢ƒå…¨ä½“ã§ã¯ãªãã€ä½¿ç”¨ã™ã‚‹å¤‰æ•°ã®ã¿ã‚­ãƒ£ãƒ—ãƒãƒ£
```

### ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•æ€§

Qiã®ä¸¦åˆ—ãƒ»ä¸¦è¡Œå‡¦ç†ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™:

**ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªè¦ç´ :**
- âœ… Evaluator: è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰å®‰å…¨ã«ä½¿ç”¨å¯èƒ½
- âœ… ç’°å¢ƒï¼ˆEnvï¼‰: RwLockã§ä¿è­·
- âœ… Atom: ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªå¯å¤‰çŠ¶æ…‹
- âœ… Channel: crossbeam-channelã«ã‚ˆã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•é€šä¿¡

**ä¸¦åˆ—å‡¦ç†ã®ä¾‹:**
```qi
; pmapã¯è‡ªå‹•çš„ã«ä¸¦åˆ—å®Ÿè¡Œï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼‰
(pmap expensive-computation large-dataset)

; go/chanã‚‚å®Œå…¨ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•
(let [ch (chan)]
  (go (send ch 42))
  (recv ch))
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§

**èµ·å‹•æ™‚é–“**: é«˜é€Ÿï¼ˆRustãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚¤ãƒŠãƒªï¼‰
**å®Ÿè¡Œé€Ÿåº¦**: ä¸­é€Ÿã€œé«˜é€Ÿï¼ˆå°†æ¥çš„ã«JITã‚³ãƒ³ãƒ‘ã‚¤ãƒ«äºˆå®šï¼‰
**ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: åŠ¹ç‡çš„ï¼ˆå‚ç…§ã‚«ã‚¦ãƒ³ãƒˆã€ç„¡é§„ãªã‚³ãƒ”ãƒ¼ãªã—ï¼‰
**ä¸¦åˆ—æ€§èƒ½**: å„ªç§€ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•è¨­è¨ˆã€Rustä¸¦è¡Œå‡¦ç†åŸºç›¤ï¼‰

## 16. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆã¨ãƒ“ãƒ«ãƒ‰æˆ¦ç•¥ âœ…

### åŸºæœ¬ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

Qiã¯ **ã€Œå…¨éƒ¨å…¥ã‚Š + Lazy Init + ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰å¯èƒ½ã€** ã®æ–¹é‡ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

**è¨­è¨ˆæ€æƒ³**:
- âœ… **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å…¨æ©Ÿèƒ½æœ‰åŠ¹ï¼ˆPure Rustã®ã¿ï¼‰** - ã€Œã“ã®ç’°å¢ƒã§ã¯å‹•ã‹ãªã„ã€ã‚’é˜²ã
- âœ… **Lazy Initialization** - æœªä½¿ç”¨æ©Ÿèƒ½ã¯ãƒ¡ãƒ¢ãƒªæ¶ˆè²»ã‚¼ãƒ­
- âœ… **ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰å¯èƒ½** - ç”¨é€”ã«å¿œã˜ã¦ã‚µã‚¤ã‚ºæœ€é©åŒ–
- âœ… **Pure Rustå„ªå…ˆ** - Cä¾å­˜ã‚’é¿ã‘ã€ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å®¹æ˜“ã«

### ãªãœã€Œå…¨éƒ¨å…¥ã‚Šã€ã‹ï¼Ÿ

Qiã¯**ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªãè¨€èªå‡¦ç†ç³»**ã§ã™ï¼š

| ç¨®åˆ¥ | featureæˆ¦ç•¥ | ç†ç”± |
|------|-------------|------|
| **ãƒ©ã‚¤ãƒ–ãƒ©ãƒª** | ç´°ã‹ãåˆ†å‰² | ä¾å­˜ã™ã‚‹å´ãŒå¿…è¦ãªæ©Ÿèƒ½ã ã‘é¸ã¶ |
| **è¨€èªå‡¦ç†ç³»** | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå…¨æ©Ÿèƒ½ | ã€Œå‹•ã‹ãªã„ã€ã¯æœ€æ‚ªã®UX |

å‚è€ƒ: Python, Ruby, Node.js, Denoç­‰ã¯å…¨éƒ¨å…¥ã‚Šå˜ä¸€ãƒã‚¤ãƒŠãƒªã‚’é…å¸ƒã€‚

### Featureéšå±¤æ§‹é€ 

#### Tier 1: Coreï¼ˆã‚ªãƒ•ä¸å¯ï¼‰

```rust
// è¨€èªæ©Ÿèƒ½
parser, evaluator, value
def, defn, let, do, if, match, try

// åŸºæœ¬æ¼”ç®—ãƒ»ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
+, -, *, /, =, <, >
list, vector, map

// ä¸¦è¡Œå‡¦ç†åŸºç›¤ï¼ˆQiã®æ ¸å¿ƒï¼‰
go, chan, send!, recv!, close!
```

**ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆï¼ˆå¿…é ˆï¼‰**:
- `parking_lot` - é«˜é€ŸMutex/RwLock
- `crossbeam-channel` - go/chanå®Ÿè£…
- `rayon` - pmapä¸¦åˆ—å‡¦ç†
- `regex` - è¨€èªæ©Ÿèƒ½ï¼ˆæ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- `once_cell` - Lazy InitåŸºç›¤

#### Tier 2: Default ONï¼ˆPure Rustã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§OFFå¯èƒ½ï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆLazy Initï¼‰**:
```toml
db-sqlite    = ["rusqlite"]        # çµ„ã¿è¾¼ã¿DBã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨å¥¨
db-postgres  = ["tokio-postgres"]  # Pure Rust PostgreSQL
db-mysql     = ["mysql_async"]     # Pure Rust MySQL
```

**Webé€šä¿¡ï¼ˆLazy Initï¼‰**:
```toml
http-client  = ["reqwest"]         # HTTP clientï¼ˆrustlsä½¿ç”¨ï¼‰
http-server  = ["hyper", "tokio"]  # HTTP serverï¼ˆasync runtimeï¼‰
```

**ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**:
```toml
format-json  = ["serde_json"]      # JSONï¼ˆå¿…é ˆç´šï¼‰
format-csv   = []                   # CSVï¼ˆè‡ªå‰å®Ÿè£…ã€Pure Rustï¼‰
```

**æ–‡å­—åˆ—å‡¦ç†**:
```toml
string-encoding = ["base64", "urlencoding", "html-escape"]  # Webé »å‡º
string-crypto   = ["sha2", "uuid"]                          # ãƒãƒƒã‚·ãƒ¥ãƒ»UUID
encoding-extended = ["encoding_rs"]  # Shift_JISç­‰ï¼ˆã‚µã‚¤ã‚ºä¸­ï¼‰
```

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»I/O**:
```toml
io-glob      = ["glob"]            # ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
io-temp      = ["tempfile"]        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
util-zip     = ["zip", "flate2"]   # åœ§ç¸®ãƒ»è§£å‡
```

**æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µ**:
```toml
std-time     = ["chrono"]          # æ—¥æ™‚å‡¦ç†ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å«ã‚€ï¼‰
std-math     = ["rand"]            # ä¹±æ•°ç”Ÿæˆ
std-stats    = []                   # çµ±è¨ˆé–¢æ•°ï¼ˆè‡ªå‰å®Ÿè£…ï¼‰
std-set      = []                   # é›†åˆæ¼”ç®—ï¼ˆè‡ªå‰å®Ÿè£…ï¼‰
```

**é–‹ç™ºæ”¯æ´**:
```toml
repl         = ["rustyline", "dirs"]  # å¯¾è©±ç’°å¢ƒ
dev-tools    = []                      # profile, test, dbgï¼ˆè‡ªå‰å®Ÿè£…ï¼‰
```

#### Tier 3: Optionalï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆOFFã€Cä¾å­˜ç­‰ï¼‰

```toml
db-odbc      = ["odbc-api"]        # ã‚·ã‚¹ãƒ†ãƒ ODBCãƒ‰ãƒ©ã‚¤ãƒä¾å­˜
db-duckdb    = ["duckdb"]          # C++ä¾å­˜ã€ã‚µã‚¤ã‚ºå·¨å¤§ï¼ˆ~50MBï¼‰
```

### Cargo.tomlæ§‹æˆä¾‹

```toml
[features]
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: Pure Rustå…¨éƒ¨å…¥ã‚Š
default = [
    "db-sqlite", "db-postgres", "db-mysql",
    "http-client", "http-server",
    "format-json", "format-csv",
    "string-encoding", "string-crypto", "encoding-extended",
    "io-glob", "io-temp", "util-zip",
    "std-time", "std-math", "std-stats", "std-set",
    "repl", "dev-tools",
]

# ãƒ—ãƒªã‚»ãƒƒãƒˆæ§‹æˆ
minimal       = []                    # æœ€å°æ§‹æˆï¼ˆçµ„ã¿è¾¼ã¿ãƒ»WASMç”¨ï¼‰
web-server    = ["http-server", "format-json", "db-sqlite"]
cli-tool      = ["repl", "format-json", "io-glob", "util-zip"]
data-processing = ["db-sqlite", "db-postgres", "format-json", "format-csv"]

# Cä¾å­˜å«ã‚€ãƒ•ãƒ«æ©Ÿèƒ½
full = ["default", "db-odbc", "db-duckdb"]

# å€‹åˆ¥æ©Ÿèƒ½
db-sqlite = ["dep:rusqlite"]
db-postgres = ["dep:tokio-postgres", "dep:postgres-types"]
# ... ä»¥ä¸‹ç•¥
```

### ãƒ“ãƒ«ãƒ‰ä¾‹

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆPure Rustå…¨éƒ¨å…¥ã‚Šï¼‰
cargo build --release
# ã‚µã‚¤ã‚º: 15-20MB

# æœ€å°æ§‹æˆ
cargo build --release --no-default-features --features minimal
# ã‚µã‚¤ã‚º: 3-5MB

# Webã‚µãƒ¼ãƒãƒ¼å°‚ç”¨
cargo build --release --no-default-features --features web-server
# ã‚µã‚¤ã‚º: 8-10MB

# ãƒ‡ãƒ¼ã‚¿å‡¦ç†å°‚ç”¨
cargo build --release --no-default-features --features data-processing
# ã‚µã‚¤ã‚º: 10-12MB

# ãƒ•ãƒ«æ©Ÿèƒ½ï¼ˆCä¾å­˜å«ã‚€ï¼‰
cargo build --release --features full
# ã‚µã‚¤ã‚º: 70-100MBï¼ˆDuckDBå«ã‚€ï¼‰
```

### Lazy Initializationæˆ¦ç•¥

**ã‚³ãƒ³ã‚»ãƒ—ãƒˆ**: ã€Œã‚³ãƒ¼ãƒ‰ã¯æŒã£ã¦ã„ã‚‹ãŒã€å¿…è¦ã«ãªã‚‹ã¾ã§èµ·å‹•ã—ãªã„ã€

#### å³æ™‚åˆæœŸåŒ–ï¼ˆè»½é‡ï¼‰
- Coreè¨€èªæ©Ÿèƒ½
- åŸºæœ¬æ•°å­¦é–¢æ•°ï¼ˆmath/*ï¼‰
- é›†åˆæ¼”ç®—ï¼ˆset/*ï¼‰
- çµ±è¨ˆé–¢æ•°ï¼ˆstats/*ï¼‰

#### Lazy Initå¿…é ˆï¼ˆé‡é‡ï¼‰
- **DBã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«**: åˆå› `db/connect` æ™‚ã«åˆæœŸåŒ–
- **HTTP client**: åˆå›ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ§‹ç¯‰
- **HTTP server runtime**: `server/serve` å‘¼ã³å‡ºã—æ™‚ã«tokioèµ·å‹•
- **æ­£è¦è¡¨ç¾ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: åˆå›ä½¿ç”¨æ™‚ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

#### å®Ÿè£…ä¾‹

```rust
// HTTP client ã®Lazy Init
use once_cell::sync::Lazy;

static HTTP_CLIENT: Lazy<reqwest::blocking::Client> = Lazy::new(|| {
    reqwest::blocking::Client::builder()
        .user_agent("qi-lang/0.1.0")
        .build()
        .expect("Failed to create HTTP client")
});

// åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ã¿åˆæœŸåŒ–ã€ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä½¿ç”¨
pub fn http_get(url: &str) -> Result<Value> {
    HTTP_CLIENT.get(url).send()  // åˆå›ã“ã“ã§åˆæœŸåŒ–
}
```

```rust
// Server runtime ã®Lazy Init
use once_cell::sync::OnceCell;

static SERVER_RUNTIME: OnceCell<tokio::runtime::Runtime> = OnceCell::new();

pub fn serve(...) -> Result<Value> {
    // server/serve ãŒåˆã‚ã¦å‘¼ã°ã‚ŒãŸæ™‚ã ã‘ãƒ©ãƒ³ã‚¿ã‚¤ãƒ èµ·å‹•
    let rt = SERVER_RUNTIME.get_or_init(|| {
        tokio::runtime::Builder::new_multi_thread()
            .enable_all()
            .build()
            .unwrap()
    });
    // ã‚µãƒ¼ãƒãƒ¼èµ·å‹•...
}
```

### ãƒ¡ãƒ¢ãƒªãƒ•ãƒƒãƒˆãƒ—ãƒªãƒ³ãƒˆ

| çŠ¶æ…‹ | ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | èª¬æ˜ |
|------|--------------|------|
| èµ·å‹•ç›´å¾Œ | 5-10MB | Core + åŸºæœ¬é–¢æ•°ã®ã¿ |
| DBä½¿ç”¨æ™‚ | +10-20MB | ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«ç¢ºä¿ |
| Serverèµ·å‹•æ™‚ | +5-10MB | tokioãƒ©ãƒ³ã‚¿ã‚¤ãƒ èµ·å‹• |
| HTTP clientä½¿ç”¨æ™‚ | +2-5MB | reqwestã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |
| æœªä½¿ç”¨æ©Ÿèƒ½ | 0MB | ã‚³ãƒ¼ãƒ‰ã¯ã‚ã‚‹ãŒãƒ¡ãƒ¢ãƒªå–ã‚‰ãªã„ |

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆfeatureç„¡åŠ¹æ™‚ï¼‰

featureç„¡åŠ¹åŒ–ã§ãƒ“ãƒ«ãƒ‰ã—ãŸå ´åˆã€å®Ÿè¡Œæ™‚ã«åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºï¼š

```qi
(db/connect "postgres://localhost/db")
; ã‚¨ãƒ©ãƒ¼: PostgreSQL ã‚µãƒãƒ¼ãƒˆã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚
; feature 'db-postgres' ã‚’æœ‰åŠ¹ã«ã—ã¦ãƒ“ãƒ«ãƒ‰ã—ã¦ãã ã•ã„:
; cargo build --features db-postgres
```

### é…å¸ƒæˆ¦ç•¥

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | ã‚µã‚¤ã‚º | ãƒ“ãƒ«ãƒ‰æ–¹æ³• |
|------------|------|--------|------------|
| **Qi Standard** | é€šå¸¸é…å¸ƒç‰ˆ | 15-20MB | `cargo build --release` |
| **Qi Minimal** | çµ„ã¿è¾¼ã¿ãƒ»WASM | 3-5MB | `--no-default-features --features minimal` |
| **Qi Full** | å…¨æ©Ÿèƒ½ï¼ˆCä¾å­˜å«ã‚€ï¼‰ | 70-100MB | `--features full` |

### å®Ÿè£…çŠ¶æ³

| é …ç›® | çŠ¶æ…‹ |
|------|------|
| Featureæ§‹é€ è¨­è¨ˆ | âœ… å®Œäº† |
| Coreå®Ÿè£… | âœ… å®Œäº† |
| Lazy InitåŸºç›¤ | ğŸš§ å®Ÿè£…äºˆå®š |
| PostgreSQL driver | ğŸš§ å®Ÿè£…äºˆå®š |
| MySQL driver | ğŸš§ å®Ÿè£…äºˆå®š |
| Feature-gated modules | ğŸš§ å®Ÿè£…äºˆå®š |

### å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°è¨­è¨ˆã¯ `BUILD-IDEA.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ã¾ã¨ã‚

**åå‰**: Qi - A Lisp that flows

**å“²å­¦**: Flow-Oriented Programming - ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’è¨­è¨ˆã™ã‚‹è¨€èª

---

### ã‚³ã‚¢é–¢æ•°ã®å®Ÿè£…å„ªå…ˆåº¦

Qiã®**Flow-oriented**å“²å­¦ã¨å®Ÿç”¨æ€§ã‚’è€ƒæ…®ã—ãŸå®Ÿè£…å„ªå…ˆé †ä½ï¼š

#### ğŸ”¥ ãƒ•ã‚§ãƒ¼ã‚º1å®Œäº† - æ¬¡ã¯ãƒ•ã‚§ãƒ¼ã‚º2ã¸

**âœ… å®Œäº†ã—ãŸæ©Ÿèƒ½**:

**1. ãƒã‚¹ãƒˆæ“ä½œ** - JSON/Webå‡¦ç†ã®æ ¸å¿ƒ
```qi
update update-in get-in assoc-in dissoc-in
```

**2. é–¢æ•°å‹åŸºç¤** - é«˜éšé–¢æ•°ã‚’æ›¸ããŸã‚ã®æ¨™æº–ãƒ„ãƒ¼ãƒ«
```qi
identity constantly comp apply partial
```

**3. é›†åˆæ¼”ç®—** - ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
```qi
union intersect difference subset?
```

**4. æ•°å€¤åŸºæœ¬** - è¨ˆç®—ã®åŸºç¤
```qi
pow sqrt round floor ceil clamp rand rand-int
```

#### âš¡ é«˜å„ªå…ˆï¼ˆã‚³ã‚¢ã‚’å……å®Ÿã•ã›ã‚‹ï¼‰

**5. ã‚½ãƒ¼ãƒˆãƒ»é›†ç´„æ‹¡å¼µ**
```qi
list/sort-by frequencies list/count-by
```
ç†ç”±: ãƒ‡ãƒ¼ã‚¿åˆ†æã§é »å‡ºã€‚`list/group-by`ã¨ã®ç›¸æ€§è‰¯ã„ã€‚

**6. ãƒªã‚¹ãƒˆåˆ†å‰²**
```qi
list/chunk take-while drop-while
```
ç†ç”±: ãƒãƒƒãƒå‡¦ç†ãƒ»ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã§ä¾¿åˆ©ã€‚

**7. I/Oæ‹¡å¼µ**
```qi
println read-lines file-exists?
```
ç†ç”±: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã€‚

#### ğŸ¯ ä¸­å„ªå…ˆï¼ˆå¿…è¦ã«ãªã£ãŸã‚‰ï¼‰

**8. é›†ç´„é–¢æ•°**
```qi
list/max-by list/min-by list/sum-by
```

**9. é«˜éšé–¢æ•°æ‹¡å¼µ**
```qi
partial complement juxt
```

**10. çµ±è¨ˆ**
```qi
mean median stddev
```

---

### ã‚³ã‚¢å®Ÿè£…çŠ¶æ³

**âœ… å®Œå…¨å®Ÿè£…**:
- **ç‰¹æ®Šå½¢å¼**: `def` `fn` `let` `do` `if` `match` `try` `defer`ï¼ˆ8ã¤ï¼‰
- **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: `|>` é€æ¬¡ãƒ‘ã‚¤ãƒ—ã€`||>` ä¸¦åˆ—ãƒ‘ã‚¤ãƒ—
- **Flowåˆ¶å¾¡**: `tap>` å‰¯ä½œç”¨ã‚¿ãƒƒãƒ—ï¼ˆé–¢æ•°ã¨ã—ã¦ï¼‰
- **ãƒ«ãƒ¼ãƒ—**: `loop` `recur` æœ«å°¾å†å¸°æœ€é©åŒ–
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†**: `try` `error` `defer`
- **ãƒã‚¯ãƒ­ã‚·ã‚¹ãƒ†ãƒ **: `mac` `quasiquote` `unquote` `unquote-splice` `uvar` `variable` `macro?` `eval`
- **çŠ¶æ…‹ç®¡ç†**: `atom` `@` `deref` `swap!` `reset!`ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ï¼‰
- **ä¸¦åˆ—å‡¦ç†**: `pmap` `async/pfilter` `async/preduce` `async/parallel-do`ï¼ˆrayonä½¿ç”¨ã€å®Œå…¨ä¸¦åˆ—åŒ–æ¸ˆã¿ï¼‰
- **ã‚¹ãƒ¬ãƒƒãƒ‰å®‰å…¨**: Evaluatorå®Œå…¨ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•åŒ–ï¼ˆArc<RwLock<_>>ï¼‰
- **ä¸¦è¡Œå‡¦ç† Layer 1**: `go` `chan` `send!` `recv!` `recv!:timeout` `try-recv!` `close!` `select!` `make-scope` `async/scope-go` `cancel!` `cancelled?` `async/with-scope`
- **ä¸¦è¡Œå‡¦ç† Layer 2**: `pmap` `async/pfilter` `async/preduce` `async/parallel-do` `pipeline` `pipeline/map` `pipeline/filter` `fan-out` `fan-in`
- **ä¸¦è¡Œå‡¦ç† Layer 3**: `await` `then` `catch` `all` `race`
- **é…å»¶è©•ä¾¡ï¼ˆStreamï¼‰**: `stream` `stream/range` `repeat` `cycle` `iterate` `stream/map` `stream/filter` `stream/take` `stream/drop` `realize` `stream/file` `http/get-stream` `http/post-stream` `http/request-stream`
- **ãƒ‡ãƒ¼ã‚¿å‹**: nil, bool, æ•´æ•°, æµ®å‹•å°æ•°ç‚¹, æ–‡å­—åˆ—, ã‚·ãƒ³ãƒœãƒ«, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰, ãƒªã‚¹ãƒˆ, ãƒ™ã‚¯ã‚¿, ãƒãƒƒãƒ—, é–¢æ•°, ã‚¢ãƒˆãƒ , ãƒãƒ£ãƒãƒ«, ã‚¹ã‚³ãƒ¼ãƒ—, Stream, Uvar
- **æ–‡å­—åˆ—**: f-stringè£œé–“
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**: åŸºæœ¬æ©Ÿèƒ½ï¼ˆ`module`/`export`/`use :only`/`:all`ï¼‰
- **åå‰ç©ºé–“**: Lisp-1ã€coreãŒå„ªå…ˆ
- **ãƒã‚¹ãƒˆæ“ä½œ**: `update` `update-in` `get-in` `assoc-in` `dissoc-in`
- **é–¢æ•°å‹åŸºç¤**: `identity` `constantly` `comp` `apply` `partial`
- **é›†åˆæ¼”ç®—**: `union` `intersect` `difference` `subset?`
- **æ•°å­¦é–¢æ•°**: `pow` `sqrt` `round` `floor` `ceil` `clamp` `rand` `rand-int`

**âœ… matchæ‹¡å¼µ** â­ **Qiç‹¬è‡ªã®å·®åˆ¥åŒ–æ©Ÿèƒ½** - **å®Ÿè£…æ¸ˆã¿**:
- `:as` æŸç¸›ï¼ˆéƒ¨åˆ†ã¨å…¨ä½“ã‚’ä¸¡æ–¹ä½¿ãˆã‚‹ï¼‰
- `=> å¤‰æ›`ï¼ˆãƒãƒƒãƒæ™‚ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çš„å¤‰æ›ï¼‰ - **ä»–ã®Lispã«ãªã„ç‹¬è‡ªæ©Ÿèƒ½**

**ğŸ”œ è¿‘æœªæ¥ï¼ˆFlowå¼·åŒ–ï¼‰**:

*ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ‹¡å¼µ*:
- `flow` DSLï¼ˆåˆ†å²ãƒ»åˆæµã‚’å«ã‚€æ§‹é€ åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰

*matchæ‹¡å¼µï¼ˆè¿½åŠ äºˆå®šï¼‰*:
- `or` ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆè¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã§åŒã˜å‡¦ç†ï¼‰
- é…åˆ—ã®è¤‡æ•°æŸç¸›ï¼ˆ`[x y]` ã§åŒæ™‚æŸç¸›ï¼‰

*Stream I/Oæ‹¡å¼µ*:
- âœ… `stream/file`ï¼ˆio.rsï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° **å®Ÿè£…æ¸ˆã¿**
- âœ… `http/get-stream` `http/post-stream` `http/request-stream`ï¼ˆhttp.rsï¼‰HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° **å®Ÿè£…æ¸ˆã¿**
- ğŸš§ `tail-stream`ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–ï¼‰**å°†æ¥å®Ÿè£…**

**ğŸš§ å°†æ¥**:
- æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤ï¼ˆstr/csv/regex/http/jsonï¼‰

### å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

#### âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆv0.1.0ï¼‰

**ç‰¹æ®Šå½¢å¼ï¼ˆ8ã¤ï¼‰**: `def` `fn` `let` `do` `if` `match` `try` `defer`

**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­**: `|>` é€æ¬¡ã€`||>` ä¸¦åˆ—ã€`tap>` ã‚¿ãƒƒãƒ—

**çµ„ã¿è¾¼ã¿é–¢æ•°ï¼ˆ150å€‹ä»¥ä¸Šï¼‰**:
- **ãƒªã‚¹ãƒˆæ“ä½œï¼ˆ26ï¼‰**: map, filter, reduce, first, rest, last, take, drop, concat, flatten, range, reverse, nth, zip, sort, list/sort-by, distinct, list/partition, list/group-by, frequencies, list/count-by, list/chunk, take-while, drop-while, list/max-by, list/min-by, list/sum-by
- **æ•°å€¤æ¼”ç®—ï¼ˆ11ï¼‰**: +, -, *, /, %, abs, min, max, inc, dec, sum
- **æ¯”è¼ƒï¼ˆ6ï¼‰**: =, !=, <, >, <=, >=
- **ãƒãƒƒãƒ—æ“ä½œï¼ˆ12ï¼‰**: get, keys, vals, assoc, dissoc, merge, select-keys, update, update-in, get-in, assoc-in, dissoc-in
- **æ–‡å­—åˆ—ï¼ˆ6 core + 60+ strï¼‰**: str, split, join, upper, lower, trim, map-lines ï¼‹ strãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§60ä»¥ä¸Š
- **è¿°èªï¼ˆ9ï¼‰**: nil?, list?, vector?, map?, string?, keyword?, integer?, float?, empty?
- **é«˜éšé–¢æ•°ï¼ˆ13ï¼‰**: map, filter, reduce, pmap, list/partition, list/group-by, map-lines, identity, constantly, comp, apply, partial, list/count-by, complement, juxt
- **é›†åˆæ¼”ç®—ï¼ˆ4ï¼‰**: union, intersect, difference, subset?
- **æ•°å­¦é–¢æ•°ï¼ˆ8ï¼‰**: pow, sqrt, round, floor, ceil, clamp, rand, rand-int
- **çŠ¶æ…‹ç®¡ç†ï¼ˆ5ï¼‰**: atom, @, deref, swap!, reset!
- **ä¸¦è¡Œå‡¦ç† Layer 1ï¼ˆ13ï¼‰**: go, chan, send!, recv!, recv!:timeout, try-recv!, close!, select!, make-scope, async/scope-go, cancel!, cancelled?, async/with-scope
- **ä¸¦è¡Œå‡¦ç† Layer 2ï¼ˆ9ï¼‰**: pmap, async/pfilter, async/preduce, async/parallel-do, pipeline, pipeline/map, pipeline/filter, fan-out, fan-in
- **ä¸¦è¡Œå‡¦ç† Layer 3ï¼ˆ5ï¼‰**: await, then, catch, all, race
- **é…å»¶è©•ä¾¡ Streamï¼ˆ14ï¼‰**: stream, stream/range, repeat, cycle, iterate, stream/map, stream/filter, stream/take, stream/drop, realize, stream/file, http/get-stream, http/post-stream, http/request-stream
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†ï¼ˆ2ï¼‰**: try, error
- **ãƒ¡ã‚¿ï¼ˆ7ï¼‰**: mac, uvar, variable, macro?, eval, quasiquote, unquote
- **è«–ç†ï¼ˆ3ï¼‰**: and, or, not
- **I/Oï¼ˆ7ï¼‰**: print, println, read-file, read-lines, write-file, append-file, file-exists?

**ãƒ‡ãƒ¼ã‚¿å‹**: nil, bool, æ•´æ•°, æµ®å‹•å°æ•°ç‚¹, æ–‡å­—åˆ—, ã‚·ãƒ³ãƒœãƒ«, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰, ãƒªã‚¹ãƒˆ, ãƒ™ã‚¯ã‚¿, ãƒãƒƒãƒ—, é–¢æ•°, ã‚¢ãƒˆãƒ , ãƒãƒ£ãƒãƒ«, ã‚¹ã‚³ãƒ¼ãƒ—, Stream, Uvar

**å…ˆé€²æ©Ÿèƒ½**:
- f-stringè£œé–“
- matchæ‹¡å¼µï¼ˆ:asæŸç¸›ã€=> å¤‰æ›ï¼‰ â­ Qiç‹¬è‡ª
- ãƒã‚¯ãƒ­ã®è¡›ç”Ÿæ€§ï¼ˆuvarï¼‰
- æœ«å°¾å†å¸°æœ€é©åŒ–ï¼ˆloop/recurï¼‰
- deferï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã‚‚å®Ÿè¡Œä¿è¨¼ï¼‰
- **é…å»¶è©•ä¾¡Stream**ï¼ˆç„¡é™ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã€ãƒ¡ãƒ¢ãƒªåŠ¹ç‡çš„å‡¦ç†ï¼‰
- **3å±¤ä¸¦è¡Œå‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** â­ Qiç‹¬è‡ª
  - Layer 1: go/chanï¼ˆGoé¢¨åŸºç›¤ï¼‰
  - Layer 2: pipelineï¼ˆæ§‹é€ åŒ–ä¸¦è¡Œå‡¦ç†ï¼‰
  - Layer 3: async/awaitï¼ˆãƒ¢ãƒ€ãƒ³APIï¼‰

#### ğŸ”œ æ¬¡æœŸå®Ÿè£…äºˆå®šï¼ˆå„ªå…ˆåº¦é †ï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º1: ã‚³ã‚¢å¼·åŒ–ï¼ˆâœ… å®Œäº†ï¼‰**
1. âœ… ãƒã‚¹ãƒˆæ“ä½œ: update, update-in, get-in, assoc-in, dissoc-in
2. âœ… é–¢æ•°å‹åŸºç¤: identity, constantly, comp, apply, partial
3. âœ… é›†åˆæ¼”ç®—: union, intersect, difference
4. âœ… æ•°å€¤åŸºæœ¬: pow, sqrt, round, floor, ceil, clamp, rand, rand-int

**ãƒ•ã‚§ãƒ¼ã‚º2: åˆ†æãƒ»é›†ç´„ï¼ˆâœ… å®Œäº†ï¼‰**
5. âœ… list/sort-by, frequencies, list/count-by
6. âœ… list/chunk, take-while, drop-while
7. âœ… println, read-lines, file-exists?

**ãƒ•ã‚§ãƒ¼ã‚º3: é«˜åº¦æ©Ÿèƒ½ï¼ˆâœ… å®Œäº†ï¼‰**
8. âœ… list/max-by, list/min-by, list/sum-by
9. âœ… complement, juxtï¼ˆpartialã¯ãƒ•ã‚§ãƒ¼ã‚º1ã§å®Œäº†ï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º4: ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ï¼ˆâœ… å®Œäº†ï¼‰**
10. âœ… å®Œå…¨ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•åŒ–ï¼ˆArc<RwLock<_>>ï¼‰
11. âœ… pmapã®å®Œå…¨ä¸¦åˆ—åŒ–ï¼ˆrayonï¼‰
12. âœ… Layer 1: go/chanå®Ÿè£…
13. âœ… Layer 2: pipelineå®Ÿè£…
14. âœ… Layer 3: async/awaitå®Ÿè£…

**ãƒ•ã‚§ãƒ¼ã‚º4.5: Webé–‹ç™ºæ©Ÿèƒ½ï¼ˆâœ… å®Œäº†ï¼‰**
15. âœ… Railway Pipeline (`|>?`)
16. âœ… JSON/HTTPå®Œå…¨å®Ÿè£…
17. âœ… ãƒ‡ãƒãƒƒã‚°é–¢æ•°ï¼ˆinspect, timeï¼‰
18. âœ… ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ‹¡å¼µï¼ˆfind, every?, some?, zipmap, map/update-keys, update-valsç­‰ï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º5: ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†ã®å®Œæˆï¼ˆâœ… å®Œäº†ï¼‰**
19. âœ… ä¸¦åˆ—ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å®Œæˆï¼ˆasync/pfilter, async/preduceï¼‰
20. âœ… select!ã¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆrecv! :timeout, select!ï¼‰
21. âœ… Structured Concurrencyï¼ˆmake-scope, async/scope-go, cancel!, cancelled?, async/with-scopeï¼‰
22. âœ… async/parallel-doï¼ˆè¤‡æ•°å¼ã®ä¸¦åˆ—å®Ÿè¡Œï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º5.5: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ©Ÿèƒ½ï¼ˆâœ… å®Œäº†ï¼‰**
23. âœ… ZIPåœ§ç¸®ãƒ»è§£å‡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆzip/create, zip/extract, zip/list, zip/add, zip/gzip, zip/gunzipï¼‰
24. âœ… ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ãƒ‘ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆargs/all, args/get, args/parse, args/countï¼‰

**ãƒ•ã‚§ãƒ¼ã‚º6: çµ±è¨ˆãƒ»é«˜åº¦ãªå‡¦ç†**
25. mean, median, stddev

#### ğŸš§ å°†æ¥ã®è¨ˆç”»

**APIã‚µãƒ¼ãƒãƒ¼ãƒ»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºæ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦é«˜ï¼‰**:

1. **HTTPã‚µãƒ¼ãƒãƒ¼** ğŸ”¥
   - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆGET, POST, PUT, DELETE, PATCHï¼‰
   - ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã‚·ã‚¹ãƒ†ãƒ ï¼ˆèªè¨¼ã€CORSã€ãƒ­ã‚®ãƒ³ã‚°ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼‰
   - é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡
   - WebSocketå¯¾å¿œ
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹

2. **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** âš¡
   - `test/deftest` - ãƒ†ã‚¹ãƒˆå®šç¾©
   - `test/assert`, `test/assert-eq`, `test/assert-throws` - ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
   - `test/run-tests` - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   - ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š** ğŸ¯
   - PostgreSQL, MySQL, SQLiteå¯¾å¿œ
   - ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ¼ãƒ«
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
   - ORMæ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

4. **èªè¨¼ãƒ»èªå¯** ğŸ¯
   - JWTï¼ˆJSON Web Tokenï¼‰
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - OAuth2å¯¾å¿œ
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ï¼ˆbcrypt, argon2ï¼‰

5. **ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–** ğŸ“
   - `fs/watch` - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›£è¦–
   - å¤‰æ›´æ¤œçŸ¥ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä½œæˆã€æ›´æ–°ã€å‰Šé™¤ã€ãƒªãƒãƒ¼ãƒ ï¼‰
   - ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

6. **ãƒ­ã‚°é«˜åº¦æ©Ÿèƒ½** ğŸ“Š
   - ãƒ­ã‚°å‡ºåŠ›å…ˆæŒ‡å®šï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã€æ¨™æº–å‡ºåŠ›ã€syslogï¼‰
   - ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚µã‚¤ã‚ºã€æ—¥ä»˜ãƒ™ãƒ¼ã‚¹ï¼‰
   - ãƒ­ã‚°åœ§ç¸®ï¼ˆgzipï¼‰
   - éåŒæœŸãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰

7. **åœ§ç¸®ãƒ»è§£å‡** ğŸ—œï¸
   - `zip/create` - ZIPä½œæˆ
   - `zip/extract` - ZIPè§£å‡
   - `zip/list` - ZIPå†…å®¹ä¸€è¦§
   - `zip/add` - ZIPã«ãƒ•ã‚¡ã‚¤ãƒ«è¿½åŠ 
   - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°åœ§ç¸®ãƒ»è§£å‡

8. **ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°** ğŸ“ˆ
   - ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã€ã‚²ãƒ¼ã‚¸ã€ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ 
   - Prometheuså½¢å¼ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - APMï¼ˆApplication Performance Monitoringï¼‰é€£æº

**ãã®ä»–ã®è¨ˆç”»**:
- æ¨™æº–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤ã®å®Œå…¨ç‰ˆï¼ˆâœ… strå®Œå…¨ç‰ˆ, âœ… csv, âœ… http client, âœ… json, ğŸš§ regexï¼‰
- âœ… éåŒæœŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­ï¼ˆ~>ï¼‰
- âœ… ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ï¼ˆstreamï¼‰
- âœ… é…å»¶ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆstreamï¼‰
- flow DSLï¼ˆæ§‹é€ åŒ–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰

### å®Ÿè£…ã®æ–¹é‡

**Qiã®å¼·ã¿ = Flow + Match + Nest**
1. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆ|>, ||>, tap>ï¼‰ã§ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’è¡¨ç¾
2. matchæ‹¡å¼µï¼ˆ:as, =>ï¼‰ã§è¤‡é›‘ãªæ§‹é€ ã‚’æ‰±ã†
3. ãƒã‚¹ãƒˆæ“ä½œï¼ˆ*-inç³»ï¼‰ã§JSON/Webã‚’ç›´æ„Ÿçš„ã«

**å®Ÿè£…å„ªå…ˆåº¦ã®åŸºæº–**:
- Flowå“²å­¦ã¨ã®è¦ªå’Œæ€§
- Web/JSONå‡¦ç†ã§ã®å®Ÿç”¨æ€§
- å®Ÿè£…ã‚³ã‚¹ãƒˆã¨åŠ¹æœã®ãƒãƒ©ãƒ³ã‚¹

---

## ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¿å®ˆ

ã“ã®SPEC.mdã¯ã€Qiè¨€èªã®**ç”ŸããŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**ã§ã™ã€‚å®Ÿè£…ã®å¤‰æ›´ã«åˆã‚ã›ã¦å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚

**æ›´æ–°ãƒ«ãƒ¼ãƒ«**:
- âœ… **å®Ÿè£…ãŒå¤‰ã‚ã£ãŸã‚‰æ›´æ–°**: æ–°æ©Ÿèƒ½è¿½åŠ ã€æ—¢å­˜æ©Ÿèƒ½ã®å¤‰æ›´æ™‚ã¯å¿…ãšSPEC.mdã‚’æ›´æ–°
- âœ… **å®Ÿè£…çŠ¶æ³ã‚’æ­£ç¢ºã«**: âœ…ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰ã€ğŸš§ï¼ˆæœªå®Ÿè£…ï¼‰ã€ğŸ”œï¼ˆè¨ˆç”»ä¸­ï¼‰ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’æ­£ç¢ºã«è¨˜è¼‰
- âœ… **ä¾‹ã‚‚æœ€æ–°ã«**: ã‚³ãƒ¼ãƒ‰ä¾‹ã¯ç¾åœ¨ã®å®Ÿè£…ã§å‹•ä½œã™ã‚‹ã‚‚ã®ã‚’è¨˜è¼‰
- âœ… **defnã‚’å„ªå…ˆ**: é–¢æ•°å®šç¾©ã®ä¾‹ã¯ `defn` ã‚’ä½¿ç”¨ï¼ˆdef, defnã®èª¬æ˜ä»¥å¤–ï¼‰

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- `README.md`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
- `TUTORIAL.md`: Qiè¨€èªã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªå®Ÿè£…ã®å­¦ç¿’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `CLAUDE.md`: é–‹ç™ºè€…å‘ã‘ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒ«ã¨ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ§‹æˆ

1. **è¨€èªæ¦‚è¦**: Qiã®å“²å­¦ã¨ç‰¹å¾´
2. **åŸºæœ¬è¨­è¨ˆãƒ»ç‰¹æ®Šå½¢å¼**: è¨€èªã®åŸºç¤æ–‡æ³•
3. **ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»ã‚³ã‚¢é–¢æ•°**: çµ„ã¿è¾¼ã¿æ©Ÿèƒ½
4. **å®Ÿç”¨ä¾‹ãƒ»è¨€èªæ–‡åŒ–**: ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
5. **å®Ÿè£…è¨ˆç”»**: ä»Šå¾Œã®æ–¹å‘æ€§

---

## å°†æ¥ã®æ”¹å–„è¨ˆç”»

### âœ… åå‰è¡çªã®è­¦å‘Šã‚·ã‚¹ãƒ†ãƒ ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰

#### æ©Ÿèƒ½æ¦‚è¦
`def` ã§æ—¢å­˜ã®å¤‰æ•°ã€é–¢æ•°ã€ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°ã‚’å†å®šç¾©ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€è­¦å‘Šã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
ã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ãŸã‚ã€å‡¦ç†ã¯ç¶™ç¶šã•ã‚Œã¾ã™ã€‚

```qi
;; ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°ã®å†å®šç¾©
(def inc (fn [x] (* x 2)))
;; è­¦å‘Š: ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°ã‚’å†å®šç¾©ã—ã¦ã„ã¾ã™: 'inc' (inc)

;; é–¢æ•°ã®å†å®šç¾©
(def my-fn (fn [x] x))
(def my-fn (fn [x] (* x 2)))
;; è­¦å‘Š: é–¢æ•°ã‚’å†å®šç¾©ã—ã¦ã„ã¾ã™: 'my-fn'

;; å¤‰æ•°ã®å†å®šç¾©
(def x 10)
(def x 20)
;; è­¦å‘Š: å¤‰æ•°ã‚’å†å®šç¾©ã—ã¦ã„ã¾ã™: 'x'
```

#### å®Ÿè£…è©³ç´°
- `def` è©•ä¾¡æ™‚ã«æ—¢å­˜ã®æŸç¸›ã‚’ãƒã‚§ãƒƒã‚¯
- ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ã€å¤‰æ•°ã‚’åŒºåˆ¥ã—ã¦è­¦å‘Š
- è‹±èªãƒ»æ—¥æœ¬èªã®å¤šè¨€èªå¯¾å¿œ
- ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãè­¦å‘Šã®ãŸã‚ã€å‡¦ç†ã¯ç¶™ç¶šï¼ˆLispçš„è‡ªç”±ã‚’å°Šé‡ï¼‰

---

### åå‰ç©ºé–“ã‚·ã‚¹ãƒ†ãƒ  ğŸš§ **Phase 6ä»¥é™ï¼ˆä½å„ªå…ˆåº¦ï¼‰**

ç¾åœ¨ã®Qiã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«åå‰ç©ºé–“ã®ã¿ã€‚å¤§è¦æ¨¡é–‹ç™ºã§ã¯åå‰è¡çªãŒå•é¡Œã«ãªã‚‹å¯èƒ½æ€§ã€‚

**æ¤œè¨äº‹é …**:
```qi
;; æ¡ˆ1: Clojureé¢¨
(ns myapp.core)
(def map {...})  ;; myapp.core/map

(myapp.core/map ...)  ;; è‡ªåˆ†ã®map
(core/map ...)        ;; çµ„ã¿è¾¼ã¿map

;; æ¡ˆ2: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ‹¡å¼µ
(module myapp
  (def map {...}))

(myapp/map ...)
```

**æ±ºå®š**: Phase 1ã§ã¯**ã‚„ã‚‰ãªã„**
- è¨­è¨ˆæ€æƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ã«åã™ã‚‹
- å°ã€œä¸­è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ä¸è¦
- å¿…è¦ã«ãªã£ãŸã‚‰æ¤œè¨

---

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 

Qiã¯æŸ”è»Ÿãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’æä¾›ã—ã¾ã™ï¼š
- **å¤šè¨€èªå¯¾å¿œ**ï¼ˆi18nï¼‰ï¼šç¾åœ¨ã¯æ—¥æœ¬èªï¼ˆjaï¼‰ã¨è‹±èªï¼ˆenï¼‰
- **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‹**ï¼šã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…è¨˜è¿°ã¨å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸¡æ–¹ã«å¯¾å¿œ
- **3ã¤ã®è¨˜è¿°ãƒ¬ãƒ™ãƒ«**ï¼šã‚·ãƒ³ãƒ—ãƒ«ãªæ–‡å­—åˆ—ã‹ã‚‰è©³ç´°ãªæ§‹é€ åŒ–ã¾ã§
- **é…å»¶èª­ã¿è¾¼ã¿**ï¼šãƒ¡ãƒ¢ãƒªåŠ¹ç‡ã‚’é‡è¦–ã—ã€å¿…è¦æ™‚ã®ã¿ãƒ­ãƒ¼ãƒ‰

### è¨˜è¿°æ–¹æ³•

#### 1. æ–‡å­—åˆ—å½¢å¼ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰

æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªå½¢å¼ã€‚é–¢æ•°ã®ç°¡å˜ãªèª¬æ˜ã®ã¿ã€‚

**defnä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰ï¼š**
```qi
(defn greet
  "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
  [name]
  (str "Hello, " name "!"))
```

**defä½¿ç”¨ï¼ˆæ‰‹å‹•è¨­å®šï¼‰ï¼š**
```qi
(def __doc__greet "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹")
(def greet
  (fn [name]
    (str "Hello, " name "!")))
```

å¤šè¨€èªå¯¾å¿œï¼š
```qi
;; defnã§å¤šè¨€èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
(defn greet
  {:en "Greets with the given name"
   :ja "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"}
  [name]
  (str "Hello, " name "!"))

;; ã¾ãŸã¯æ‰‹å‹•ã§è¨€èªåˆ¥ã«è¨­å®š
(def __doc__greet_en "Greets with the given name")
(def __doc__greet_ja "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹")
(def greet
  (fn [name]
    (str "Hello, " name "!")))

#### 2. æ§‹é€ åŒ–å½¢å¼ï¼ˆè©³ç´°ï¼‰

è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¨˜è¿°ã™ã‚‹å ´åˆã€‚

**defnä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰ï¼š**
```qi
(defn greet
  {:desc "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
   :params [{:name "name" :type "string" :desc "æŒ¨æ‹¶ã™ã‚‹ç›¸æ‰‹ã®åå‰"}]
   :returns {:type "string" :desc "æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"}
   :examples [
     "(greet \"Alice\") ;=> \"Hello, Alice!\""
     "(greet \"Bob\")   ;=> \"Hello, Bob!\""
   ]}
  [name]
  (str "Hello, " name "!"))
```

**defä½¿ç”¨ï¼ˆæ‰‹å‹•è¨­å®šï¼‰ï¼š**
```qi
(def __doc__greet
  {:desc "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
   :params [{:name "name" :type "string" :desc "æŒ¨æ‹¶ã™ã‚‹ç›¸æ‰‹ã®åå‰"}]
   :returns {:type "string" :desc "æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"}
   :examples [
     "(greet \"Alice\") ;=> \"Hello, Alice!\""
     "(greet \"Bob\")   ;=> \"Hello, Bob!\""
   ]})
(def greet
  (fn [name]
    (str "Hello, " name "!")))
```

å¤šè¨€èªå¯¾å¿œï¼š
```qi
;; defnã§å¤šè¨€èªæ§‹é€ åŒ–ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
(defn greet
  {:en {:desc "Greets with the given name"
        :params [{:name "name" :type "string" :desc "Name to greet"}]
        :returns {:type "string" :desc "Greeting message"}
        :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]}
   :ja {:desc "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
        :params [{:name "name" :type "string" :desc "æŒ¨æ‹¶ã™ã‚‹ç›¸æ‰‹ã®åå‰"}]
        :returns {:type "string" :desc "æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"}
        :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]}}
  [name]
  (str "Hello, " name "!"))

;; ã¾ãŸã¯æ‰‹å‹•ã§è¨€èªåˆ¥ã«è¨­å®š
(def __doc__greet_en
  {:desc "Greets with the given name"
   :params [{:name "name" :type "string" :desc "Name to greet"}]
   :returns {:type "string" :desc "Greeting message"}
   :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]})
(def __doc__greet_ja
  {:desc "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
   :params [{:name "name" :type "string" :desc "æŒ¨æ‹¶ã™ã‚‹ç›¸æ‰‹ã®åå‰"}]
   :returns {:type "string" :desc "æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"}
   :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]})
(def greet
  (fn [name]
    (str "Hello, " name "!")))
```

### æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®é–¢æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã•ã‚Œã¾ã™ã€‚

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
qi-lang/
  std/
    docs/
      ja/
        core.qi      # åŸºæœ¬é–¢æ•°ï¼ˆmap, filter, reduceç­‰ï¼‰
        string.qi    # æ–‡å­—åˆ—é–¢æ•°
        list.qi      # ãƒªã‚¹ãƒˆæ“ä½œ
        io.qi        # ãƒ•ã‚¡ã‚¤ãƒ«IO
      en/
        core.qi
        string.qi
        list.qi
        io.qi
```

#### ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

æ¨™æº–çš„ãªQiæ§‹æ–‡ã§è¨˜è¿°ã—ã¾ã™ï¼š

```qi
;; std/docs/ja/core.qi

(def __doc__map
  {:desc "å„è¦ç´ ã«é–¢æ•°ã‚’é©ç”¨ã—ã¦ãƒªã‚¹ãƒˆã‚’è¿”ã™"
   :params [{:name "f" :type "function" :desc "é©ç”¨ã™ã‚‹é–¢æ•°"}
            {:name "coll" :type "collection" :desc "å¯¾è±¡ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³"}]
   :returns {:type "list" :desc "å¤‰æ›å¾Œã®ãƒªã‚¹ãƒˆ"}
   :examples [
     "(map inc [1 2 3]) ;=> (2 3 4)"
     "(map str [1 2 3]) ;=> (\"1\" \"2\" \"3\")"
   ]})

(def __doc__filter
  {:desc "æ¡ä»¶ã«åˆã†è¦ç´ ã ã‘ã‚’æ®‹ã™"
   :params [{:name "pred" :type "function" :desc "è¿°èªé–¢æ•°"}
            {:name "coll" :type "collection" :desc "å¯¾è±¡ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³"}]
   :returns {:type "list" :desc "ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®ãƒªã‚¹ãƒˆ"}
   :examples [
     "(filter odd? [1 2 3 4]) ;=> (1 3)"
   ]})
```

#### è‡ªå‹•ãƒ­ãƒ¼ãƒ‰

`:doc`ã‚³ãƒãƒ³ãƒ‰åˆå›å®Ÿè¡Œæ™‚ã«è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ï¼š

1. `std/docs/en/*.qi` ã‚’èª­ã¿è¾¼ã¿ï¼ˆè‹±èªç‰ˆï¼‰
2. `std/docs/{QI_LANG}/*.qi` ã‚’èª­ã¿è¾¼ã¿ï¼ˆè¨€èªç‰ˆã§ä¸Šæ›¸ãï¼‰

ã“ã‚Œã«ã‚ˆã‚Šã€è¨€èªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒè‡ªå‹•çš„ã«å®Ÿç¾ã•ã‚Œã¾ã™ã€‚

### è¨€èªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºæ™‚ã®å„ªå…ˆé †ä½ã¯è¨€èªè¨­å®šã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ï¼š

#### æ—¥æœ¬èªç’°å¢ƒ (`QI_LANG=ja`)
1. `__doc__<name>_ja` - æ—¥æœ¬èªç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
2. `__doc__<name>` - è¨€èªæŒ‡å®šãªã—ï¼ˆå…±é€šç‰ˆï¼‰
3. `__doc__<name>_en` - è‹±èªç‰ˆï¼ˆæœ€å¾Œã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
4. è¡¨ç¤ºãªã—

#### è‹±èªç’°å¢ƒ (`QI_LANG=en`)
1. `__doc__<name>_en` - è‹±èªç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
2. `__doc__<name>` - è¨€èªæŒ‡å®šãªã—ï¼ˆå…±é€šç‰ˆï¼‰
3. è¡¨ç¤ºãªã—

#### ãã®ä»–ã®è¨€èª (`QI_LANG=fr`ç­‰)
1. `__doc__<name>_<lang>` - è©²å½“è¨€èªç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
2. `__doc__<name>` - è¨€èªæŒ‡å®šãªã—ï¼ˆå…±é€šç‰ˆï¼‰
3. `__doc__<name>_en` - è‹±èªç‰ˆï¼ˆæœ€å¾Œã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
4. è¡¨ç¤ºãªã—

#### è¨­è¨ˆæ€æƒ³
- **è¨€èªæŒ‡å®šãªã—** (`__doc__<name>`): å…¨è¨€èªå…±é€šã®ç‰¹åˆ¥æ ã€‚ç°¡å˜ãªä¸€è¨€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‘ã‘
- **en**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªã¨ã—ã¦æœ€å¾Œã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ–‡åŒ–ã«åˆè‡´ï¼‰
- **ä»–è¨€èªã®æ··åœ¨é˜²æ­¢**: frãƒ¦ãƒ¼ã‚¶ãƒ¼ã«jaãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯è¡¨ç¤ºã—ãªã„ï¼ˆèª­ã‚ãªã„è¨€èªã‚ˆã‚Šã€Œãªã—ã€ã®æ–¹ãŒãƒã‚·ï¼‰

ä¾‹ï¼š
```bash
# æ—¥æœ¬èªç’°å¢ƒ
export QI_LANG=ja
qi repl
> :doc greet   # __doc__greet_ja â†’ __doc__greet â†’ __doc__greet_en ã®é †ã§æ¢ç´¢

# è‹±èªç’°å¢ƒ
export QI_LANG=en
qi repl
> :doc greet   # __doc__greet_en â†’ __doc__greet ã®é †ã§æ¢ç´¢ï¼ˆä»–è¨€èªã¯æ¢ã•ãªã„ï¼‰

# ãƒ•ãƒ©ãƒ³ã‚¹èªç’°å¢ƒ
export QI_LANG=fr
qi repl
> :doc greet   # __doc__greet_fr â†’ __doc__greet â†’ __doc__greet_en ã®é †ã§æ¢ç´¢
```

### ä¸€èˆ¬çš„ãªä½¿ã„æ–¹

ã»ã¨ã‚“ã©ã®é–‹ç™ºè€…ã¯**è¨€èªæŒ‡å®šãªã—**ï¼ˆ`__doc__<name>`ï¼‰ã§æ›¸ãã ã‘ã§ååˆ†ã§ã™ã€‚

#### å˜ä¸€è¨€èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæ¨å¥¨ï¼‰

å¤šè¨€èªå¯¾å¿œãŒä¸è¦ãªå ´åˆã¯ã€`_ja`ã‚„`_en`ãªã©ã®è¨€èªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ãšã«è¨˜è¿°ã—ã¦ãã ã•ã„ï¼š

```qi
;; æ—¥æœ¬èªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆ
(defn greet
  "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
  [name]
  (str "Hello, " name "!"))

;; ã¾ãŸã¯æ§‹é€ åŒ–å½¢å¼
(def __doc__add
  {:desc "2ã¤ã®æ•°å€¤ã‚’åŠ ç®—ã™ã‚‹"
   :params [{:name "a" :type "number"}
            {:name "b" :type "number"}]
   :returns {:type "number"}
   :examples ["(add 1 2) ;=> 3"]})
(defn add [a b] (+ a b))
```

**å‹•ä½œï¼š**
- ã©ã®è¨€èªç’°å¢ƒï¼ˆ`QI_LANG=ja`ã€`QI_LANG=en`ã€`QI_LANG=fr`ç­‰ï¼‰ã§ã‚‚ã€åŒã˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™
- è¨€èªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ãŒãªã„ãŸã‚ã€è‡ªåˆ†ãŸã¡ã®æ¯èªã§è‡ªç”±ã«æ›¸ã‘ã¾ã™
- å°è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚„å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã™

#### å¤šè¨€èªå¯¾å¿œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

å›½éš›çš„ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ„ãƒ¼ãƒ«ã§å¤šè¨€èªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå¿…è¦ãªå ´åˆã®ã¿ã€è¨€èªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ã„ã¾ã™ï¼š

```qi
;; è‹±èªç‰ˆ
(def __doc__greet_en
  {:desc "Greets with the given name"
   :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]})

;; æ—¥æœ¬èªç‰ˆ
(def __doc__greet_ja
  {:desc "æŒ‡å®šã•ã‚ŒãŸåå‰ã§æŒ¨æ‹¶ã™ã‚‹"
   :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]})

;; ãƒ•ãƒ©ãƒ³ã‚¹èªç‰ˆ
(def __doc__greet_fr
  {:desc "Salue avec le nom donnÃ©"
   :examples ["(greet \"Alice\") ;=> \"Hello, Alice!\""]})

(defn greet [name]
  (str "Hello, " name "!"))
```

**å‹•ä½œï¼š**
- `QI_LANG=en` â†’ è‹±èªç‰ˆã‚’è¡¨ç¤º
- `QI_LANG=ja` â†’ æ—¥æœ¬èªç‰ˆã‚’è¡¨ç¤º
- `QI_LANG=fr` â†’ ãƒ•ãƒ©ãƒ³ã‚¹èªç‰ˆã‚’è¡¨ç¤º
- `QI_LANG=de` â†’ è¨€èªæŒ‡å®šãªã—ç‰ˆï¼ˆ`__doc__greet`ï¼‰ãŒã‚ã‚Œã°ãã‚Œã‚’è¡¨ç¤ºã€ãªã‘ã‚Œã°è‹±èªç‰ˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### è¨€èªæŒ‡å®šãªã—ã¨ã®ä½µç”¨

è¨€èªæŒ‡å®šãªã—ç‰ˆã¨è¨€èªç‰ˆã‚’ä½µç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š

```qi
;; ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆè¨€èªæŒ‡å®šãªã—ï¼‰- æ—¥æœ¬èªã§è¨˜è¿°
(def __doc__count
  {:desc "ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®è¦ç´ æ•°ã‚’æ•°ãˆã‚‹"
   :examples ["(count [1 2 3]) ;=> 3"]})

;; è‹±èªç‰ˆã®ã¿è¿½åŠ 
(def __doc__count_en
  {:desc "Count elements in a collection"
   :examples ["(count [1 2 3]) ;=> 3"]})
```

**å‹•ä½œï¼š**
- `QI_LANG=ja` â†’ `__doc__count`ï¼ˆæ—¥æœ¬èªï¼‰ã‚’è¡¨ç¤º
- `QI_LANG=en` â†’ `__doc__count_en`ï¼ˆè‹±èªï¼‰ã‚’è¡¨ç¤º
- `QI_LANG=fr` â†’ `__doc__count`ï¼ˆæ—¥æœ¬èªï¼‰ã‚’è¡¨ç¤º â† ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ã“ã®å ´åˆã€ãƒ•ãƒ©ãƒ³ã‚¹èªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯æ—¥æœ¬èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã‚Šã¯æœ‰ç›Šã§ã™ã€‚

#### ã¾ã¨ã‚

| ã‚±ãƒ¼ã‚¹ | æ¨å¥¨æ–¹æ³• | ç†ç”± |
|--------|----------|------|
| å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | è¨€èªæŒ‡å®šãªã— | ã‚·ãƒ³ãƒ—ãƒ«ã§ååˆ† |
| ç¤¾å†…ãƒ„ãƒ¼ãƒ« | è¨€èªæŒ‡å®šãªã— | çµ„ç¹”å†…ã§çµ±ä¸€è¨€èªãŒã‚ã‚‹ã¯ãš |
| OSSãƒ©ã‚¤ãƒ–ãƒ©ãƒª | è¨€èªæŒ‡å®šã‚ã‚Š | å›½éš›çš„ãªãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ |
| æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | è¨€èªæŒ‡å®šã‚ã‚Š | å¤šè¨€èªã‚µãƒãƒ¼ãƒˆå¿…é ˆ |

**åŸå‰‡ï¼šå¿…è¦ãªã‘ã‚Œã°è¨€èªã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä»˜ã‘ãªã„ã§ãã ã•ã„ã€‚**


### å®Ÿè£…æ–¹é‡

#### ãƒ¡ãƒ¢ãƒªåŠ¹ç‡

- **é…å»¶èª­ã¿è¾¼ã¿**ï¼š`:doc` ã‚³ãƒãƒ³ãƒ‰åˆå›å®Ÿè¡Œæ™‚ã®ã¿ãƒ­ãƒ¼ãƒ‰
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒ™ãƒ¼ã‚¹**ï¼šãƒã‚¤ãƒŠãƒªã«åŸ‹ã‚è¾¼ã¾ãªã„
- **ä¸€æ‹¬ãƒ­ãƒ¼ãƒ‰**ï¼šåˆå›ãƒ­ãƒ¼ãƒ‰å¾Œã¯ãƒ¡ãƒ¢ãƒªä¸Šã«ä¿æŒï¼ˆé«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹ï¼‰

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- åˆå›`:doc`æ™‚ã«æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å…¨ã¦ãƒ­ãƒ¼ãƒ‰
- 2å›ç›®ä»¥é™ã¯å³åº§ã«è¡¨ç¤º
- ãƒ¡ãƒ¢ãƒªä¸Šã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‹ã‚‰ç›´æ¥æ¤œç´¢ï¼ˆé«˜é€Ÿï¼‰

### è¨­è¨ˆæ€æƒ³

#### ãƒ‡ãƒ¼ã‚¿é§†å‹•

- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚Qiã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆæ–‡å­—åˆ—ã€ãƒãƒƒãƒ—ï¼‰ã§è¨˜è¿°
- ãƒã‚¯ãƒ­ã§ã¯ãªãã€ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†

#### ãƒ•ãƒ­ãƒ¼æŒ‡å‘

- ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å‡¦ç†ã¨ã®è¦ªå’Œæ€§ã‚’ä¿ã¤
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå–å¾—ã‚‚ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®ä¸€éƒ¨ã¨ã—ã¦è¨­è¨ˆå¯èƒ½

#### æ®µéšçš„è©³ç´°åŒ–

- ã‚·ãƒ³ãƒ—ãƒ«ãªæ–‡å­—åˆ—ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹
- å¿…è¦ã«å¿œã˜ã¦æ§‹é€ åŒ–ã¸ã¨æ‹¡å¼µ
- å¼·åˆ¶ã—ãªã„ã€é¸æŠè‚¢ã‚’æä¾›ã™ã‚‹

#### æ˜ç¢ºãªåˆ†é›¢

- **Rustãƒ¬ã‚¤ãƒ¤ãƒ¼**ï¼š`i18n.rs`ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å†…éƒ¨i18nï¼‰
- **Qiãƒ¬ã‚¤ãƒ¤ãƒ¼**ï¼šæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘i18nï¼‰

ã“ã‚Œã‚‰ã¯ç•°ãªã‚‹ç›®çš„ã‚’æŒã¡ã€æ··åŒã—ãªã„ã“ã¨ã€‚

### ä»Šå¾Œã®æ‹¡å¼µ

- `:doc` ã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ¤œç´¢å®Ÿè£…
- `qi --gen-doc` ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…
- ã‚ˆã‚Šå¤šãã®è¨€èªã‚µãƒãƒ¼ãƒˆï¼ˆä¸­å›½èªã€éŸ“å›½èªãªã©ï¼‰
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- å‹æƒ…å ±ã¨ã®çµ±åˆ

---

## REPLï¼ˆRead-Eval-Print Loopï¼‰

Qiã®REPLã¯å¼·åŠ›ãªå¯¾è©±çš„é–‹ç™ºç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚

### âœ… åŸºæœ¬æ©Ÿèƒ½

**èµ·å‹•**:
```bash
qi              # REPLèµ·å‹•
qi -l file.qi   # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦REPLèµ·å‹•
```

**ç‰¹å¾´**:
- **å±¥æ­´**: ä¸Šä¸‹ã‚­ãƒ¼ã§éå»ã®ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ï¼ˆ`~/.qi_history`ã«ä¿å­˜ï¼‰
- **è¡Œç·¨é›†**: Emacsé¢¨ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ï¼ˆCtrl+A/E/Wç­‰ï¼‰
- **è¤‡æ•°è¡Œå…¥åŠ›**: æ‹¬å¼§ãŒé–‰ã˜ã‚‹ã¾ã§è‡ªå‹•ç¶™ç¶š
- **ã‚¿ãƒ–è£œå®Œ**: é–¢æ•°åãƒ»å¤‰æ•°åãƒ»REPLã‚³ãƒãƒ³ãƒ‰ã‚’è£œå®Œ

### âœ… REPLã‚³ãƒãƒ³ãƒ‰

ã™ã¹ã¦ã®ã‚³ãƒãƒ³ãƒ‰ã¯ `:` ã§å§‹ã¾ã‚Šã¾ã™ï¼š

```qi
:help           ; ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§è¡¨ç¤º
:vars           ; å®šç¾©æ¸ˆã¿å¤‰æ•°ä¸€è¦§
:funcs          ; ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©é–¢æ•°ä¸€è¦§
:builtins       ; ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
:clear          ; ç’°å¢ƒã‚’ã‚¯ãƒªã‚¢
:load <file>    ; ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
:reload         ; æœ€å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†èª­ã¿è¾¼ã¿
:quit           ; çµ‚äº†
```

### ä½¿ç”¨ä¾‹

```qi
qi:1> (defn double [x] (* x 2))
#<function>

qi:2> (double 21)
42

qi:3> :vars
No variables defined

qi:4> :funcs
User-defined functions:
  double

qi:5> :load utils.qi
Loading: utils.qi
Loaded!

qi:6> (double
     ...  21)
42

qi:7> :quit
```

### è¤‡æ•°è¡Œå…¥åŠ›

æ‹¬å¼§ãŒé–‰ã˜ã¦ã„ãªã„å ´åˆã€è‡ªå‹•çš„ã«è¤‡æ•°è¡Œãƒ¢ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ï¼š

```qi
qi:1> (defn sum [& nums]
     ...   (reduce + 0 nums))
#<function>

qi:2> (sum 1 2 3 4 5)
15
```

### ã‚¿ãƒ–è£œå®Œ

é–¢æ•°åã€å¤‰æ•°åã€REPLã‚³ãƒãƒ³ãƒ‰ã‚’è£œå®Œã§ãã¾ã™ï¼š

```qi
qi:1> :h<TAB>
:help

qi:2> dou<TAB>
double

qi:3> (defn triple [x] (* x 3))
#<function>

qi:4> tri<TAB>
triple
```

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

- **Ctrl+C**: å…¥åŠ›ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆREPLç¶™ç¶šï¼‰
- **Ctrl+D**: çµ‚äº†
- **â†‘/â†“**: å±¥æ­´ç§»å‹•
- **Ctrl+A**: è¡Œé ­
- **Ctrl+E**: è¡Œæœ«
- **Ctrl+W**: å˜èªå‰Šé™¤
- **TAB**: è£œå®Œ

---

## ãƒ“ãƒ«ãƒ‰æ§‹æˆ - Feature Flags

Qiã¯**æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆFeature Flagsï¼‰**ã«ã‚ˆã‚Šã€ç”¨é€”ã«å¿œã˜ã¦å¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’å«ã‚ãŸãƒ“ãƒ«ãƒ‰ãŒå¯èƒ½ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€çµ„ã¿è¾¼ã¿ç’°å¢ƒã‚„WASMãªã©åˆ¶ç´„ã®å³ã—ã„ç’°å¢ƒã§ã‚‚å‹•ä½œã—ã¾ã™ã€‚

### ãƒ“ãƒ«ãƒ‰ãƒ—ãƒªã‚»ãƒƒãƒˆ

#### `default` - ãƒ•ãƒ«æ©Ÿèƒ½ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

å…¨æ©Ÿèƒ½ã‚’å«ã‚€ãƒ“ãƒ«ãƒ‰ã€‚é–‹ç™ºã‚„ä¸€èˆ¬çš„ãªç”¨é€”ã«æœ€é©ã€‚

```bash
cargo build
# ã¾ãŸã¯
cargo build --features default
```

**å«ã¾ã‚Œã‚‹æ©Ÿèƒ½**:
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteï¼‰
- âœ… Webé€šä¿¡ï¼ˆHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆJSONã€CSVï¼‰
- âœ… æ–‡å­—åˆ—å‡¦ç†ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€æš—å·åŒ–ï¼‰
- âœ… ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»I/Oï¼ˆglobã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã€ZIPï¼‰
- âœ… æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µï¼ˆæ™‚åˆ»ã€æ•°å­¦ã€çµ±è¨ˆã€é›†åˆï¼‰
- âœ… REPLãƒ»é–‹ç™ºãƒ„ãƒ¼ãƒ«

#### `minimal` - æœ€å°æ§‹æˆ

æœ€å°é™ã®ä¾å­˜é–¢ä¿‚ã§ãƒ“ãƒ«ãƒ‰ã€‚çµ„ã¿è¾¼ã¿ç’°å¢ƒã‚„WASMå‘ã‘ã€‚

```bash
cargo build --no-default-features --features minimal
```

**å«ã¾ã‚Œã‚‹æ©Ÿèƒ½**:
- âœ… åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼ˆglobï¼‰
- âœ… ã‚³ã‚¢é–¢æ•°ï¼ˆãƒªã‚¹ãƒˆã€ãƒãƒƒãƒ—ã€æ–‡å­—åˆ—åŸºæœ¬ï¼‰
- âœ… ä¸¦è¡Œãƒ»ä¸¦åˆ—å‡¦ç†
- âœ… ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°

**é™¤å¤–ã•ã‚Œã‚‹æ©Ÿèƒ½**:
- âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆSQLiteç­‰ï¼‰
- âŒ HTTPé€šä¿¡
- âŒ JSONï¼ˆ`parse-json`, `to-json`ï¼‰
- âŒ å¤šé‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ï¼ˆUTF-8ã®ã¿ï¼‰
- âŒ æ™‚åˆ»å‡¦ç†ï¼ˆ`time/*`ï¼‰
- âŒ ä¹±æ•°ç”Ÿæˆï¼ˆ`math/rand*`ã€`math/shuffle`ï¼‰
- âŒ çµ±è¨ˆãƒ»é›†åˆé–¢æ•°
- âŒ ZIPåœ§ç¸®ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«
- âŒ REPL

#### ãƒ—ãƒªã‚»ãƒƒãƒˆæ§‹æˆ

ç‰¹å®šç”¨é€”ã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆï¼š

```bash
# Webã‚µãƒ¼ãƒãƒ¼æ§‹æˆ
cargo build --no-default-features --features web-server

# CLIãƒ„ãƒ¼ãƒ«æ§‹æˆ
cargo build --no-default-features --features cli-tool

# ãƒ‡ãƒ¼ã‚¿å‡¦ç†æ§‹æˆ
cargo build --no-default-features --features data-processing
```

| ãƒ—ãƒªã‚»ãƒƒãƒˆ | å«ã¾ã‚Œã‚‹æ©Ÿèƒ½ |
|-----------|-------------|
| `web-server` | HTTPã‚µãƒ¼ãƒãƒ¼ã€JSONã€SQLite |
| `cli-tool` | REPLã€JSONã€globã€ZIP |
| `data-processing` | SQLiteã€JSONã€CSV |

### å€‹åˆ¥æ©Ÿèƒ½ãƒ•ãƒ©ã‚°

ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰ã«ã¯å€‹åˆ¥ã®featureãƒ•ãƒ©ã‚°ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ï¼š

```bash
# HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨JSONã®ã¿
cargo build --no-default-features --features http-client,format-json

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨çµ±è¨ˆã®ã¿
cargo build --no-default-features --features db-sqlite,std-stats
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `db-sqlite` | `db/connect`, `db/query`, `db/exec`, `db/close` ç­‰ï¼ˆ17é–¢æ•°ï¼‰ | rusqlite |

#### Webé€šä¿¡

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `http-client` | `http-get`, `http-post`, `http-put`, `http-delete` | reqwest |
| `http-server` | `server/start`, `server/stop`, `server/on` ç­‰ï¼ˆ15é–¢æ•°ï¼‰ | hyper, tokio |

#### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `format-json` | `parse-json`, `to-json` | serde_json |
| `format-csv` | `csv/read`, `csv/write` | Pure Rustå®Ÿè£… |

#### æ–‡å­—åˆ—å‡¦ç†

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `string-encoding` | `to-base64`, `from-base64`, `url-encode`, `url-decode`, `html-escape`, `html-unescape` | base64, urlencoding, html-escape |
| `string-crypto` | `hash`, `uuid` | sha2, uuid |
| `encoding-extended` | å¤šé‡ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œï¼ˆ`read-file`/`write-file`ã§Shift_JISã€EUC-JPç­‰ï¼‰ | encoding_rs |

**æ³¨**: `encoding-extended`ã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€`read-file`/`write-file`ã¯UTF-8ã®ã¿å¯¾å¿œã«ãªã‚Šã¾ã™ã€‚

#### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»I/O

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `io-glob` | `list-dir`ã§globãƒ‘ã‚¿ãƒ¼ãƒ³ | glob |
| `io-temp` | `temp/file`, `temp/dir` | tempfile |
| `util-zip` | `zip/create`, `zip/extract`, `gzip`, `gunzip` | zip, flate2 |

#### æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¡å¼µ

| Feature | é–¢æ•° | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `std-time` | `time/now`, `time/parse`, `time/format` ç­‰ï¼ˆ17é–¢æ•°ï¼‰ | chrono |
| `std-math` | `math/rand`, `math/rand-int`, `math/random-range`, `math/shuffle` | rand |
| `std-stats` | `stats/mean`, `stats/median`, `stats/stddev` ç­‰ï¼ˆ6é–¢æ•°ï¼‰ | Pure Rustå®Ÿè£… |
| `std-set` | `set/union`, `set/intersect`, `set/diff` ç­‰ï¼ˆ7é–¢æ•°ï¼‰ | Pure Rustå®Ÿè£… |

#### é–‹ç™ºæ”¯æ´

| Feature | å†…å®¹ | ä¾å­˜ã‚¯ãƒ¬ãƒ¼ãƒˆ |
|---------|------|-------------|
| `repl` | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–REPL | rustyline, dirs |
| `dev-tools` | ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ï¼ˆ`profile/start`, `profile/stop`, `profile/report`ï¼‰ | Pure Rustå®Ÿè£… |

### ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºæ¯”è¼ƒ

å‚è€ƒå€¤ï¼ˆRelease ãƒ“ãƒ«ãƒ‰ã€macOS arm64ï¼‰:

| æ§‹æˆ | ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚º | å‚™è€ƒ |
|------|--------------|------|
| `default` | ã€œ15MB | å…¨æ©Ÿèƒ½å«ã‚€ |
| `minimal` | ã€œ3MB | çµ„ã¿è¾¼ã¿ãƒ»WASMå‘ã‘ |
| `web-server` | ã€œ8MB | Webã‚¢ãƒ—ãƒªå‘ã‘ |
| `cli-tool` | ã€œ5MB | CLIãƒ„ãƒ¼ãƒ«å‘ã‘ |

### æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯

ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§æ©Ÿèƒ½ã®æœ‰ç„¡ã‚’ç¢ºèªã—ãŸã„å ´åˆï¼š

```qi
;; å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ã§åˆ¤æ–­
(try
  (parse-json "{\"key\": \"value\"}")
  (fn [err] (println "JSON feature not available")))

;; é–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
(if (fn? parse-json)
  (parse-json data)
  (println "JSON not supported"))
```

### è¨­è¨ˆæ€æƒ³

Qiã®æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ï¼š

1. **Pure Rustå„ªå…ˆ** - C/C++ä¾å­˜ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¯é¿ã‘ã€ã‚¯ãƒ­ã‚¹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®¹æ˜“ã«
2. **æ®µéšçš„å°å…¥** - å¿…è¦ãªæ©Ÿèƒ½ã‹ã‚‰é †ã«æœ‰åŠ¹åŒ–
3. **æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼** - ç„¡åŠ¹ãªæ©Ÿèƒ½ã‚’å‘¼ã¶ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
4. **ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•** - å…¨ã¦ã®ãƒ“ãƒ«ãƒ‰æ§‹æˆã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ã‚’ä¿è¨¼

---
